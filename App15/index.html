<!DOCTYPE html><html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>API 資料即時呈現｜純前端</title>
  <style>
    :root { --bg:#0f172a; --card:#111827; --muted:#94a3b8; --text:#e5e7eb; --accent:#38bdf8; }
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans TC",Arial; background:linear-gradient(135deg,#111827,#0b1022); color:var(--text);}
    .container{max-width:1100px;margin:0 auto;padding:24px}
    h1{font-size:1.6rem;margin:0 0 8px}
    .sub{color:var(--muted);font-size:.95rem;margin-bottom:18px}
    .card{background:rgba(17,24,39,.75);backdrop-filter:blur(6px);border:1px solid rgba(148,163,184,.15);border-radius:18px;padding:16px;margin-bottom:16px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    label{font-size:.85rem;color:var(--muted)}
    input[type=text], input[type=number]{flex:1;min-width:260px;padding:10px 12px;border-radius:12px;border:1px solid rgba(148,163,184,.2);background:#0b1220;color:var(--text)}
    select{padding:10px 12px;border-radius:12px;border:1px solid rgba(148,163,184,.2);background:#0b1220;color:var(--text)}
    button{padding:10px 14px;border-radius:12px;border:1px solid rgba(148,163,184,.25);background:#0b1220;color:var(--text);cursor:pointer}
    button.primary{background:linear-gradient(135deg,#22d3ee,#3b82f6);border:none;color:#001018;font-weight:700}
    button:disabled{opacity:.6;cursor:not-allowed}
    .hint{font-size:.85rem;color:var(--muted)}
    .status{display:flex;align-items:center;gap:8px}
    .dot{width:10px;height:10px;border-radius:50%}
    .dot.ok{background:#22c55e}.dot.err{background:#ef4444}.dot.idle{background:#64748b}
    .flex-1{flex:1}
    .table-wrap{overflow:auto;max-height:55vh;border-radius:12px;border:1px solid rgba(148,163,184,.15)}
    table{width:100%;border-collapse:collapse;font-size:.92rem}
    th,td{padding:10px 12px;border-bottom:1px solid rgba(148,163,184,.15);white-space:nowrap}
    th{position:sticky;top:0;background:#0d162b;text-align:left}
    tr:hover td{background:rgba(56,189,248,.06)}
    .json{white-space:pre-wrap;background:#0b1220;border:1px solid rgba(148,163,184,.15);border-radius:12px;padding:12px;max-height:55vh;overflow:auto}
    .controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .badge{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px dashed rgba(148,163,184,.35);color:var(--muted);font-size:.8rem}
    .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,monospace;background:#0b1220;border:1px solid rgba(148,163,184,.2);padding:2px 6px;border-radius:6px}
    .footer{color:var(--muted);font-size:.82rem;margin-top:8px}
  </style>
</head>
<body>
  <div class="container">
    <h1>API 資料即時呈現</h1>
    <div class="sub">純前端（無伺服器）以 <span class="kbd">fetch()</span> 抓取 API，智慧判斷 Array → 表格、Object → JSON。支援自動更新、查詢、分頁。</div><div class="card">
  <div class="row" style="margin-bottom:10px">
    <label for="apiUrl" class="badge">步驟 1｜輸入 API URL</label>
    <div class="flex-1"></div>
    <div class="badge">提示：若遇到 CORS，被拒可改用「代理」範例（見頁面底部）。</div>
  </div>
  <div class="row controls">
    <input id="apiUrl" type="text" placeholder="例如：https://jsonplaceholder.typicode.com/users" value="https://jsonplaceholder.typicode.com/users" />
    <select id="method">
      <option>GET</option>
      <option>POST</option>
    </select>
    <button id="btnFetch" class="primary">取得資料</button>
    <div class="status" id="status"><span class="dot idle"></span><span>Idle</span></div>
  </div>
  <div class="row" style="margin-top:8px">
    <label for="body" class="badge">Request Body（POST 時可填）</label>
  </div>
  <textarea id="body" rows="3" style="width:100%;margin-top:6px;border-radius:12px;border:1px solid rgba(148,163,184,.2);background:#0b1220;color:var(--text);padding:10px"></textarea>
</div>

<div class="card">
  <div class="row controls">
    <label class="badge">自動更新</label>
    <input id="auto" type="checkbox" />
    <label for="interval">每（秒）：</label>
    <input id="interval" type="number" min="5" value="30" style="width:90px"/>
    <div class="flex-1"></div>
    <label>快速篩選：</label>
    <input id="q" type="text" placeholder="輸入關鍵字過濾表格資料" />
    <label>每頁</label>
    <select id="pageSize">
      <option>10</option>
      <option>20</option>
      <option selected>50</option>
      <option>100</option>
    </select>
  </div>
</div>

<div id="outTable" class="card" style="display:none">
  <div class="table-wrap">
    <table id="table"></table>
  </div>
  <div class="row" style="justify-content:space-between;margin-top:8px">
    <div id="summary" class="hint"></div>
    <div class="row">
      <button id="prev">上一頁</button>
      <div id="pageInfo" class="hint" style="min-width:120px;text-align:center"></div>
      <button id="next">下一頁</button>
    </div>
  </div>
</div>

<div id="outJson" class="card" style="display:none">
  <div class="json" id="json"></div>
</div>

<div class="card">
  <div class="badge">CORS 小抄</div>
  <div class="footer">
    多數官方 API 會開 CORS（瀏覽器可直呼）。若被擋：
    <ol>
      <li>改走官方提供的 <em>browser-friendly</em> 端點或加上 <span class="kbd">?callback=</span>（極少數仍支援 JSONP）。</li>
      <li>自己架一個極簡代理（下方附 Cloudflare Worker 範例）。</li>
      <li>若部署於 GitHub Pages，代理可放在 Cloudflare Worker / Vercel。前端維持不變。</li>
    </ol>
  </div>
  <details>
    <summary>Cloudflare Worker 代理（複製即用）</summary>
    <pre class="json">export default {

async fetch(req) { const url = new URL(req.url) const target = url.searchParams.get('url') if (!target) return new Response('missing ?url=', { status: 400 }) const resp = await fetch(target, { headers: { 'User-Agent': 'Mozilla/5.0' } }) const newHdr = new Headers(resp.headers) newHdr.set('Access-Control-Allow-Origin', '*') return new Response(await resp.arrayBuffer(), { status: resp.status, headers: newHdr }) } } // 前端改用： https://你的worker域名/?url=<原API編碼後的URL></pre> </details> </div>

  </div>  <script>
    const $ = (sel)=>document.querySelector(sel)
    const apiUrl = $('#apiUrl')
    const method = $('#method')
    const bodyEl = $('#body')
    const btnFetch = $('#btnFetch')
    const statusEl = $('#status')
    const auto = $('#auto')
    const intervalEl = $('#interval')
    const q = $('#q')
    const pageSizeEl = $('#pageSize')
    const tableWrap = $('#outTable')
    const tableEl = $('#table')
    const jsonWrap = $('#outJson')
    const jsonEl = $('#json')
    const prevBtn = $('#prev')
    const nextBtn = $('#next')
    const pageInfo = $('#pageInfo')
    const summary = $('#summary')

    let rawData = null
    let filtered = []
    let page = 1

    function setStatus(kind, text){
      const dot = statusEl.querySelector('.dot')
      const label = statusEl.querySelector('span:last-child')
      dot.className = 'dot ' + (kind || 'idle')
      label.textContent = text || 'Idle'
    }

    async function fetchData(){
      try {
        setStatus('idle','連線中…')
        btnFetch.disabled = true
        const opts = { method: method.value }
        if (method.value === 'POST' && bodyEl.value.trim()) {
          opts.headers = { 'Content-Type': 'application/json' }
          opts.body = bodyEl.value
        }
        const resp = await fetch(apiUrl.value, opts)
        if (!resp.ok) throw new Error(`HTTP ${resp.status}`)
        const ct = resp.headers.get('content-type')||''
        const data = ct.includes('application/json') ? await resp.json() : await resp.text()
        rawData = data
        render(data)
        setStatus('ok','成功')
      } catch (err) {
        console.error(err)
        setStatus('err', '錯誤：'+ err.message)
        tableWrap.style.display = 'none'
        jsonWrap.style.display = 'block'
        jsonEl.textContent = JSON.stringify({ error: err.message, hint: '若為 CORS，請使用下方代理方式。' }, null, 2)
      } finally { btnFetch.disabled = false }
    }

    function render(data){
      page = 1
      // Array → 表格；Object/String → JSON
      if (Array.isArray(data)) {
        filtered = [...data]
        q.value = ''
        jsonWrap.style.display = 'none'
        tableWrap.style.display = 'block'
        drawTable()
      } else if (typeof data === 'object') {
        tableWrap.style.display = 'none'
        jsonWrap.style.display = 'block'
        jsonEl.textContent = JSON.stringify(data, null, 2)
      } else {
        tableWrap.style.display = 'none'
        jsonWrap.style.display = 'block'
        jsonEl.textContent = String(data)
      }
    }

    function drawTable(){
      const term = q.value.trim().toLowerCase()
      const ps = parseInt(pageSizeEl.value,10)
      const src = term ? filtered.filter(row =>
        typeof row === 'object' && row !== null &&
        Object.values(row).some(v => String(v).toLowerCase().includes(term))
      ) : filtered

      const total = src.length
      const pages = Math.max(1, Math.ceil(total / ps))
      if (page > pages) page = pages
      const start = (page-1)*ps
      const slice = src.slice(start, start+ps)

      // 動態欄位：合併所有鍵
      const cols = Array.from(slice.reduce((set,row)=>{
        Object.keys(row||{}).forEach(k=>set.add(k))
        return set
      }, new Set()))

      const thead = `<thead><tr>${cols.map(c=>`<th>${escapeHtml(c)}</th>`).join('')}</tr></thead>`
      const tbody = `<tbody>${slice.map(r=>`<tr>${cols.map(c=>`<td>${escapeHtml(flatCell(r?.[c]))}</td>`).join('')}</tr>`).join('')}</tbody>`
      tableEl.innerHTML = thead + tbody

      pageInfo.textContent = `${page} / ${pages}`
      summary.textContent = `總筆數：${total}，本頁：${slice.length} 筆`
      prevBtn.disabled = page<=1
      nextBtn.disabled = page>=pages
    }

    function flatCell(v){
      if (v == null) return ''
      if (typeof v === 'object') return JSON.stringify(v)
      return String(v)
    }

    function escapeHtml(s){
      return String(s)
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'",'&#39;')
    }

    // 事件
    btnFetch.addEventListener('click', fetchData)
    q.addEventListener('input', ()=>{ if(Array.isArray(rawData)){ drawTable() } })
    pageSizeEl.addEventListener('change', ()=>{ if(Array.isArray(rawData)){ page=1; drawTable() } })
    prevBtn.addEventListener('click', ()=>{ page=Math.max(1,page-1); drawTable() })
    nextBtn.addEventListener('click', ()=>{ page=page+1; drawTable() })

    let timer = null
    auto.addEventListener('change', ()=>{
      clearInterval(timer)
      if (auto.checked) {
        const sec = Math.max(5, parseInt(intervalEl.value||'30',10))
        timer = setInterval(fetchData, sec*1000)
      }
    })
    intervalEl.addEventListener('change', ()=>{
      if (auto.checked) { auto.dispatchEvent(new Event('change')) }
    })

    // 首次自動載入示範 API
    fetchData()
  </script></body>
</html>
