<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>午餐點餐系統</title>
    <link rel="manifest" href="#" id="manifest-placeholder">
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="點餐系統">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft JhengHei', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden; }
        .header { background: linear-gradient(45deg, #2563eb, #3b82f6); color: white; padding: 30px; text-align: center; position: relative; }
        .header h1 { font-size: 2rem; margin-bottom: 10px; }
        .date-display { font-size: 1rem; opacity: 0.9; }
        .install-btn {
            position: absolute; top: 20px; right: 20px;
            background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3);
            color: white; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-size: 0.9rem; display: none;
        }
        .install-btn:hover { background: rgba(255,255,255,0.3); }
        .content { padding: 30px; }
        .tabs { display: flex; margin-bottom: 30px; background: #f8fafc; border-radius: 12px; padding: 4px; }
        .tab { flex: 1; background: none; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 1rem; transition: all 0.3s; }
        .tab.active { background: #2563eb; color: white; box-shadow: 0 2px 4px rgba(37, 99, 235, 0.3); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #374151; }
        input, select, textarea {
            width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem; transition: border-color 0.3s;
        }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #2563eb; }
        .menu-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .menu-item {
            background: #f8fafc; border: 2px solid #e5e7eb; border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.3s; text-align: center;
        }
        .menu-item:hover { border-color: #2563eb; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(37, 99, 235, 0.15); }
        .menu-item.selected { border-color: #2563eb; background: #eff6ff; }
        .menu-item h3 { color: #1f2937; margin-bottom: 8px; font-size: 1.2rem; }
        .menu-item .price { color: #ef4444; font-weight: 600; font-size: 1.1rem; }
        .btn {
            background: #2563eb; color: white; border: none; padding: 14px 28px; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: all 0.3s; width: 100%;
        }
        .btn:hover { background: #1d4ed8; transform: translateY(-1px); }
        .btn:disabled { background: #9ca3af; cursor: not-allowed; transform: none; }
        .orders-table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .orders-table th, .orders-table td { padding: 12px 16px; text-align: left; border-bottom: 1px solid #e5e7eb; }
        .orders-table th { background: #f8fafc; font-weight: 600; color: #374151; }
        .orders-table tr:hover { background: #f9fafb; }
        .qr-section { background: #f8fafc; padding: 20px; border-radius: 12px; text-align: center; margin-bottom: 20px; }
        .qr-code { background: white; padding: 20px; border-radius: 8px; display: inline-block; margin: 10px 0; }
        .employee-login { background: #fef3c7; border: 1px solid #f59e0b; padding: 20px; border-radius: 12px; margin-bottom: 20px; }
        .status { padding: 10px; border-radius: 8px; margin-bottom: 20px; text-align: center; }
        .status.success { background: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }
        .status.error { background: #fee2e2; color: #dc2626; border: 1px solid #fecaca; }
        .admin-controls { display: flex; gap: 10px; flex-wrap: wrap; }
        .btn-secondary { background: #6b7280; color: white; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-secondary:hover { background: #4b5563; }
        .btn-danger:hover { background: #dc2626; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="install-btn" onclick="installApp()">安裝 APP</button>
            <h1>🍱 午餐點餐系統</h1>
            <div class="date-display" id="dateDisplay"></div>
        </div>

        <div class="content">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('order')">點餐</button>
                <button class="tab" onclick="switchTab('view')">查看訂單</button>
                <button class="tab" onclick="switchTab('qr')">QR登入</button>
                <button class="tab" onclick="switchTab('admin')">管理</button>
            </div>

            <div id="status" class="status" style="display: none;"></div>

            <!-- 點餐頁面 -->
            <div id="order-tab" class="tab-content active">
                <div class="employee-login">
                    <div class="form-group">
                        <label for="employeeId">工號</label>
                        <input type="text" id="employeeId" placeholder="請輸入工號">
                    </div>
                    <div class="form-group">
                        <label for="employeeName">姓名</label>
                        <input type="text" id="employeeName" placeholder="請輸入姓名">
                    </div>
                </div>

                <h3 style="margin-bottom: 20px; color: #1f2937;">選擇餐點</h3>
                <div class="menu-grid" id="menuGrid"></div>

                <div class="form-group">
                    <label for="specialRequest">特殊需求（選填）</label>
                    <textarea id="specialRequest" rows="3" placeholder="例如：不要香菜、飯少一點..."></textarea>
                </div>

                <button class="btn" onclick="submitOrder()">提交訂單</button>
            </div>

            <!-- 查看訂單頁面 -->
            <div id="view-tab" class="tab-content">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="color: #1f2937;">今日訂單</h3>
                    <button class="btn-secondary btn" style="width: auto;" onclick="loadOrders()">刷新</button>
                </div>
                <div id="ordersContainer">
                    <table class="orders-table">
                        <thead>
                            <tr>
                                <th>時間</th>
                                <th>工號</th>
                                <th>姓名</th>
                                <th>餐點</th>
                                <th>價格</th>
                                <th>特殊需求</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTableBody"></tbody>
                    </table>
                </div>
                <div id="ordersSummary" style="margin-top: 20px; padding: 20px; background: #f8fafc; border-radius: 8px;"></div>
            </div>

            <!-- QR登入頁面 -->
            <div id="qr-tab" class="tab-content">
                <div class="qr-section">
                    <h3 style="margin-bottom: 15px; color: #1f2937;">QR Code 快速登入</h3>
                    <p style="margin-bottom: 20px; color: #6b7280;">掃描 QR Code 快速填入工號</p>
                    <div class="qr-code">
                        <!-- 這裡改成 canvas（原本是 div） -->
                        <canvas id="qrcode" width="200" height="200" style="display:block"></canvas>
                    </div>
                    <div class="form-group">
                        <label for="qrEmployeeId">產生工號 QR Code</label>
                        <input type="text" id="qrEmployeeId" placeholder="輸入工號產生 QR Code">
                        <button class="btn" style="margin-top: 10px;" onclick="generateQR()">產生 QR Code</button>
                    </div>
                </div>
            </div>

            <!-- 管理頁面 -->
            <div id="admin-tab" class="tab-content">
                <h3 style="margin-bottom: 20px; color: #1f2937;">系統管理</h3>
                
                <div style="background: #f8fafc; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h4 style="margin-bottom: 15px;">資料管理</h4>
                    <div class="admin-controls">
                        <button class="btn btn-secondary" onclick="exportData()">匯出資料</button>
                        <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">匯入資料</button>
                        <button class="btn btn-danger" onclick="clearTodayOrders()">清空今日訂單</button>
                        <button class="btn btn-danger" onclick="clearAllOrders()">清空所有訂單</button>
                    </div>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
                </div>

                <div style="background: #f0f9ff; padding: 20px; border-radius: 12px; border: 1px solid #0ea5e9;">
                    <h4 style="margin-bottom: 15px;">自動清空設定</h4>
                    <label>
                        <input type="checkbox" id="autoCleanEnabled" onchange="toggleAutoClean()"> 
                        每日自動清空前一天的訂單
                    </label>
                    <p style="margin-top: 10px; font-size: 0.9rem; color: #6b7280;">
                        啟用後，系統會在每天第一次使用時自動清空前一天的訂單記錄
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- QR Code Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.3/qrcode.min.js"></script>

    <script>
        // PWA 相關配置
        const manifest = {
            name: "午餐點餐系統",
            short_name: "點餐系統",
            description: "內網午餐點餐系統",
            start_url: "./",
            display: "standalone",
            background_color: "#ffffff",
            theme_color: "#2563eb",
            icons: [
                {
                    src: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiBmaWxsPSIjMjU2M2ViIiByeD0iMzIiLz4KPHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgeD0iMzIiIHk9IjMyIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9IndoaXRlIj4KICA8cGF0aCBkPSJNMTggN2wtMS40MS0xLjQxLTYuMzQgNi4zNGMtLjM5LjM5LS4zOS4xLS4zOS0uNDlzMC0uODguMzkxLTEuMjdsMi44My0yLjgzTDEyIDZsLTEuNDEgMS40MSAyLjEzIDIuMTNjLS4zOS4zOS0uMzkgMS4wMyAwIDEuNDJsLjcxLjcxYy4zOS4zOSAxLjAzLjM5IDEuNDIgMGwyLjEzLTIuMTNMMTggN3oiLz4KICA8cGF0aCBkPSJNMiAxOWgxNXYySDJ6Ii8+CiAgPHBhdGggZD0iTTIgMTFoMTB2MkgyeiIvPgo8L3N2Zz4KPC9zdmc+",
                    sizes: "192x192",
                    type: "image/svg+xml"
                }
            ]
        };

        // 建立 manifest
        const manifestBlob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
        const manifestURL = URL.createObjectURL(manifestBlob);
        document.getElementById('manifest-placeholder').href = manifestURL;

        // Service Worker 註冊
        if ('serviceWorker' in navigator) {
            const swCode = `
                const CACHE_NAME = 'lunch-order-v1';
                const urlsToCache = [
                    './',
                    'https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.3/qrcode.min.js'
                ];

                self.addEventListener('install', event => {
                    event.waitUntil(
                        caches.open(CACHE_NAME)
                            .then(cache => cache.addAll(urlsToCache))
                    );
                });

                self.addEventListener('fetch', event => {
                    event.respondWith(
                        caches.match(event.request)
                            .then(response => {
                                return response || fetch(event.request);
                            })
                    );
                });
            `;
            const swBlob = new Blob([swCode], {type: 'application/javascript'});
            const swURL = URL.createObjectURL(swBlob);
            navigator.serviceWorker.register(swURL);
        }

        // PWA 安裝提示
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.querySelector('.install-btn').style.display = 'block';
        });
        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then(() => {
                    deferredPrompt = null;
                    document.querySelector('.install-btn').style.display = 'none';
                });
            }
        }

        // 系統配置
        const config = {
            dataFile: 'lunch_orders.json', // 共用資料檔案路徑（示範版仍用 localStorage）
            menuItems: [
                { id: 1, name: '雞腿便當', price: 85 },
                { id: 2, name: '排骨便當', price: 80 },
                { id: 3, name: '魚排便當', price: 90 },
                { id: 4, name: '素食便當', price: 75 },
                { id: 5, name: '牛肉麵', price: 120 },
                { id: 6, name: '豬肉麵', price: 100 },
                { id: 7, name: '陽春麵', price: 60 },
                { id: 8, name: '炸雞便當', price: 95 }
            ]
        };

        // 全域變數
        let selectedMenuItem = null;
        let allOrders = [];

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            updateDate();
            initializeMenu();
            loadOrders();
            checkAutoClean();
            loadSettings();
            
            // 檢查 URL 參數（QR Code 登入）
            const urlParams = new URLSearchParams(window.location.search);
            const employeeId = urlParams.get('emp');
            if (employeeId) {
                document.getElementById('employeeId').value = employeeId;
                showStatus('已透過 QR Code 自動填入工號', 'success');
            }
        });

        // 更新日期顯示
        function updateDate() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('zh-TW', {
                year: 'numeric', month: 'long', day: 'numeric', weekday: 'long'
            });
            document.getElementById('dateDisplay').textContent = dateStr;
        }

        // 初始化菜單
        function initializeMenu() {
            const menuGrid = document.getElementById('menuGrid');
            menuGrid.innerHTML = '';
            config.menuItems.forEach(item => {
                const menuItem = document.createElement('div');
                menuItem.className = 'menu-item';
                menuItem.onclick = () => selectMenuItem(item.id);
                menuItem.innerHTML = `<h3>${item.name}</h3><div class="price">$${item.price}</div>`;
                menuGrid.appendChild(menuItem);
            });
        }

        // 選擇餐點
        function selectMenuItem(itemId) {
            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('selected'));
            event.target.closest('.menu-item').classList.add('selected');
            selectedMenuItem = config.menuItems.find(item => item.id === itemId);
        }

        // 切換頁籤
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
            if (tabName === 'view') loadOrders();
        }

        // 提交訂單
        async function submitOrder() {
            const employeeId = document.getElementById('employeeId').value.trim();
            const employeeName = document.getElementById('employeeName').value.trim();
            const specialRequest = document.getElementById('specialRequest').value.trim();
            if (!employeeId || !employeeName) { showStatus('請填入工號和姓名', 'error'); return; }
            if (!selectedMenuItem) { showStatus('請選擇餐點', 'error'); return; }

            const order = {
                id: Date.now(),
                timestamp: new Date().toISOString(),
                employeeId, employeeName,
                menuItem: selectedMenuItem,
                specialRequest,
                date: new Date().toDateString()
            };
            try {
                await saveOrder(order);
                showStatus(`訂單提交成功！${selectedMenuItem.name} - $${selectedMenuItem.price}`, 'success');
                document.getElementById('specialRequest').value = '';
                document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('selected'));
                selectedMenuItem = null;
                if (document.getElementById('view-tab').classList.contains('active')) loadOrders();
            } catch (error) {
                showStatus('訂單提交失敗: ' + error.message, 'error');
            }
        }

        // 儲存訂單到檔案（示範版用 localStorage）
        async function saveOrder(order) {
            try {
                let orders = await loadOrdersFromFile();
                const today = new Date().toDateString();
                const existingOrder = orders.find(o =>
                    o.employeeId === order.employeeId &&
                    new Date(o.timestamp).toDateString() === today
                );
                if (existingOrder) Object.assign(existingOrder, order);
                else orders.push(order);
                await saveOrdersToFile(orders);
                allOrders = orders;
            } catch (error) {
                console.error('Save order error:', error);
                throw new Error('無法儲存訂單，請檢查檔案權限');
            }
        }

        async function loadOrdersFromFile() {
            try {
                const response = await fetch(config.dataFile);
                if (response.ok) return await response.json();
                return [];
            } catch { return []; }
        }

        async function saveOrdersToFile(orders) {
            try {
                const data = JSON.stringify(orders, null, 2);
                localStorage.setItem('lunchOrders', data);
                // 真實環境應改為 POST 到你的檔案伺服器/API
            } catch { throw new Error('無法寫入檔案'); }
        }

        // 載入訂單列表
        async function loadOrders() {
            try {
                const data = localStorage.getItem('lunchOrders');
                allOrders = data ? JSON.parse(data) : [];
                displayOrders();
            } catch (error) {
                showStatus('載入訂單失敗: ' + error.message, 'error');
            }
        }

        // 顯示訂單列表
        function displayOrders() {
            const today = new Date().toDateString();
            const todayOrders = allOrders.filter(order => new Date(order.timestamp).toDateString() === today);
            const tableBody = document.getElementById('ordersTableBody');
            tableBody.innerHTML = '';
            if (todayOrders.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #6b7280;">今日尚無訂單</td></tr>';
                document.getElementById('ordersSummary').innerHTML = '';
                return;
            }
            todayOrders.forEach(order => {
                const row = document.createElement('tr');
                const orderTime = new Date(order.timestamp).toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit' });
                row.innerHTML = `
                    <td>${orderTime}</td>
                    <td>${order.employeeId}</td>
                    <td>${order.employeeName}</td>
                    <td>${order.menuItem.name}</td>
                    <td>$${order.menuItem.price}</td>
                    <td>${order.specialRequest || '-'}</td>
                `;
                tableBody.appendChild(row);
            });
            displayOrderSummary(todayOrders);
        }

        // 顯示訂單統計
        function displayOrderSummary(orders) {
            const summary = {}; let totalAmount = 0;
            orders.forEach(order => {
                const itemName = order.menuItem.name;
                if (!summary[itemName]) summary[itemName] = { count: 0, price: order.menuItem.price };
                summary[itemName].count++; totalAmount += order.menuItem.price;
            });
            let summaryHtml = '<h4 style="margin-bottom: 15px;">今日統計</h4>';
            summaryHtml += '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">';
            Object.entries(summary).forEach(([itemName, data]) => {
                summaryHtml += `
                    <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #e5e7eb;">
                        <div style="font-weight: 600;">${itemName}</div>
                        <div style="color: #6b7280;">數量: ${data.count}</div>
                        <div style="color: #ef4444; font-weight: 600;">小計: $${data.count * data.price}</div>
                    </div>`;
            });
            summaryHtml += '</div>';
            summaryHtml += `<div style="margin-top: 15px; padding: 15px; background: #eff6ff; border-radius: 8px; text-align: center;">
                <strong>總訂單數: ${orders.length} | 總金額: ${totalAmount}</strong>
            </div>`;
            document.getElementById('ordersSummary').innerHTML = summaryHtml;
        }

        // ✅ QR Code 產生（改用 Canvas 目標）
        function generateQR() {
            const employeeId = document.getElementById('qrEmployeeId').value.trim();
            if (!employeeId) { showStatus('請輸入工號', 'error'); return; }

            const qrData = window.location.origin + window.location.pathname + '?emp=' + encodeURIComponent(employeeId);
            const canvas = document.getElementById('qrcode');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            QRCode.toCanvas(
                canvas,
                qrData,
                { width: 200, margin: 2 },
                function (error) {
                    if (error) {
                        console.error(error);
                        showStatus('QR Code 產生失敗', 'error');
                    } else {
                        showStatus('QR Code 產生成功', 'success');
                    }
                }
            );
        }

        // 管理功能
        function exportData() {
            const data = { orders: allOrders, exportDate: new Date().toISOString(), version: '1.0' };
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `lunch_orders_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a); a.click(); document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showStatus('資料匯出成功', 'success');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = async function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.orders && Array.isArray(data.orders)) {
                        allOrders = data.orders;
                        await saveOrdersToFile(allOrders);
                        displayOrders();
                        showStatus('資料匯入成功', 'success');
                    } else {
                        showStatus('無效的資料格式', 'error');
                    }
                } catch (error) {
                    showStatus('資料匯入失敗: ' + error.message, 'error');
                }
            };
            reader.readAsText(file);
        }

        function clearTodayOrders() {
            if (confirm('確定要清空今日所有訂單嗎？此操作無法復原。')) {
                const today = new Date().toDateString();
                allOrders = allOrders.filter(order => new Date(order.timestamp).toDateString() !== today);
                saveOrdersToFile(allOrders);
                displayOrders();
                showStatus('今日訂單已清空', 'success');
            }
        }

        function clearAllOrders() {
            if (confirm('確定要清空所有訂單嗎？此操作無法復原。')) {
                allOrders = [];
                saveOrdersToFile(allOrders);
                displayOrders();
                showStatus('所有訂單已清空', 'success');
            }
        }

        // 自動清空功能
        function toggleAutoClean() {
            const enabled = document.getElementById('autoCleanEnabled').checked;
            localStorage.setItem('autoCleanEnabled', enabled);
            showStatus(enabled ? '已啟用自動清空' : '已停用自動清空', 'success');
        }
        function checkAutoClean() {
            const enabled = localStorage.getItem('autoCleanEnabled') === 'true';
            const lastCleanDate = localStorage.getItem('lastCleanDate');
            const today = new Date().toDateString();
            if (enabled && lastCleanDate !== today) {
                const yesterday = new Date(); yesterday.setDate(yesterday.getDate() - 1);
                const yesterdayStr = yesterday.toDateString();
                allOrders = allOrders.filter(order => new Date(order.timestamp).toDateString() !== yesterdayStr);
                saveOrdersToFile(allOrders);
                localStorage.setItem('lastCleanDate', today);
                console.log('自動清空前一天訂單完成');
            }
        }
        function loadSettings() {
            const autoCleanEnabled = localStorage.getItem('autoCleanEnabled') === 'true';
            document.getElementById('autoCleanEnabled').checked = autoCleanEnabled;
        }

        // 顯示狀態訊息
        function showStatus(message, type) {
            const statusElement = document.getElementById('status');
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
            statusElement.style.display = 'block';
            setTimeout(() => { statusElement.style.display = 'none'; }, 3000);
        }

        // 定期刷新訂單（可選）
        setInterval(() => {
            if (document.getElementById('view-tab').classList.contains('active')) loadOrders();
        }, 30000);
    </script>
</body>
</html>
