<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>美味餐廳 - 線上訂位系統</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f9fafb;
            min-height: 100vh
        }

        /* Nav */
        nav {
            background: #fff;
            border-bottom: 1px solid #e5e7eb;
            box-shadow: 0 1px 3px rgba(0, 0, 0, .08);
            position: sticky;
            top: 0;
            z-index: 100
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            height: 64px;
            align-items: center;
            padding: 0 1rem;
            justify-content: space-between
        }

        .nav-brand {
            font-size: 1.25rem;
            font-weight: 700;
            color: #111827
        }

        .nav-buttons {
            display: flex;
            gap: .5rem
        }

        .nav-button {
            padding: .5rem 1rem;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #6b7280;
            border-bottom: 2px solid transparent;
            transition: all .2s;
            height: 64px;
            display: flex;
            align-items: center;
            gap: .5rem
        }

        .nav-button:hover {
            color: #374151
        }

        .nav-button.active {
            color: #2563eb;
            border-bottom-color: #2563eb
        }

        /* Loading */
        .loading-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, .45);
            z-index: 9999;
            justify-content: center;
            align-items: center
        }

        .loading-overlay.show {
            display: flex
        }

        .loading-spinner {
            background: #fff;
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
            min-width: 220px
        }

        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #2563eb;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem
        }

        @keyframes spin {
            0% {
                transform: rotate(0)
            }

            100% {
                transform: rotate(360deg)
            }
        }

        /* Layout */
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem
        }

        .hero {
            text-align: center;
            margin-bottom: 2rem;
            padding: 1.5rem 0
        }

        .hero h1 {
            font-size: 2rem;
            font-weight: 800;
            color: #111827;
            margin-bottom: .25rem
        }

        .hero p {
            font-size: 1.05rem;
            color: #6b7280
        }

        .card {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, .06);
            padding: 1.25rem;
            margin-bottom: 1.25rem
        }

        .card-title {
            font-size: 1.05rem;
            font-weight: 700;
            margin-bottom: .75rem;
            display: flex;
            align-items: center;
            gap: .5rem;
            color: #111827
        }

        .grid {
            display: grid;
            gap: 1.25rem
        }

        .grid-2 {
            grid-template-columns: 1fr
        }

        @media(min-width:1024px) {
            .grid-2 {
                grid-template-columns: repeat(2, 1fr)
            }
        }

        /* Form */
        .form-group {
            margin-bottom: 1rem
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: .5rem;
            color: #374151
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: .75rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            transition: all .2s;
            background: #fff
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, .12)
        }

        /* Buttons */
        .btn {
            padding: .75rem 1.25rem;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all .2s;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: .5rem
        }

        .btn-primary {
            background: #2563eb;
            color: #fff
        }

        .btn-primary:hover {
            background: #1d4ed8
        }

        .btn-secondary {
            background: #f3f4f6;
            color: #374151
        }

        .btn-secondary:hover {
            background: #e5e7eb
        }

        .btn-full {
            width: 100%;
            justify-content: center
        }

        /* Resource */
        .resource-card {
            padding: 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            cursor: pointer;
            transition: all .2s;
            margin-bottom: .75rem;
            background: #fff
        }

        .resource-card:hover {
            border-color: #9ca3af;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, .06)
        }

        .resource-card.selected {
            border-color: #2563eb;
            background: #eff6ff
        }

        .resource-name {
            font-weight: 700;
            margin-bottom: .25rem;
            color: #111827
        }

        .resource-capacity {
            font-size: 13px;
            color: #6b7280;
            margin-bottom: .5rem
        }

        .resource-tags {
            display: flex;
            gap: .25rem;
            flex-wrap: wrap
        }

        .tag {
            padding: .25rem .5rem;
            background: #f3f4f6;
            border-radius: 4px;
            font-size: 12px;
            color: #4b5563
        }

        /* Time slots */
        .time-slots {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: .5rem
        }

        @media(min-width:768px) {
            .time-slots {
                grid-template-columns: repeat(4, 1fr)
            }
        }

        .time-slot {
            padding: .75rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            background: #fff;
            cursor: pointer;
            text-align: center;
            font-size: 14px;
            transition: all .2s
        }

        .time-slot:hover:not(.unavailable) {
            border-color: #93c5fd;
            background: #eff6ff
        }

        .time-slot.selected {
            background: #2563eb;
            color: #fff;
            border-color: #2563eb
        }

        .time-slot.unavailable {
            background: #f9fafb;
            color: #9ca3af;
            cursor: not-allowed
        }

        /* Alerts */
        .alert {
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: .75rem
        }

        .alert-success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #86efac
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5
        }

        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd
        }

        /* Staff list */
        .reservation-item {
            border-bottom: 1px solid #e5e7eb;
            padding: 1rem 0
        }

        .reservation-item:last-child {
            border-bottom: none
        }

        .reservation-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: .35rem
        }

        .reservation-time {
            font-weight: 800;
            color: #111827
        }

        .reservation-details {
            font-size: 14px;
            color: #6b7280
        }

        .status-badge {
            padding: .25rem .75rem;
            border-radius: 9999px;
            font-size: 12px;
            font-weight: 700
        }

        .status-confirmed {
            background: #dcfce7;
            color: #166534
        }

        .status-checked_in {
            background: #dbeafe;
            color: #1e40af
        }

        .status-completed {
            background: #f3f4f6;
            color: #4b5563
        }

        .status-no_show {
            background: #fee2e2;
            color: #991b1b
        }

        .status-cancelled {
            background: #fee2e2;
            color: #991b1b
        }

        /* Empty */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: #6b7280
        }

        .empty-state-icon {
            font-size: 2.75rem;
            margin-bottom: .5rem
        }

        /* API setup strip */
        .api-setup {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            padding: 1.25rem;
            border-radius: 12px;
            margin-bottom: 1.25rem
        }

        .api-setup input {
            margin-top: .5rem;
            background: #fff;
            color: #111827
        }

        /* Systems */
        .row {
            display: flex;
            align-items: center;
            gap: .5rem;
            flex-wrap: wrap
        }

        .muted {
            font-size: 12px;
            color: #6b7280
        }

        .right {
            margin-left: auto
        }
    </style>
</head>

<body>
    <!-- Loading -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p>處理中...</p>
        </div>
    </div>

    <!-- Nav -->
    <nav>
        <div class="nav-container">
            <div class="nav-brand">🍽️ 美味餐廳</div>
            <div class="nav-buttons">
                <button class="nav-button active" onclick="switchView('customer', event)">👤 線上訂位</button>
                <button class="nav-button" onclick="switchView('staff', event)">📋 管理後台</button>
            </div>
        </div>
    </nav>

    <!-- Customer View -->
    <div id="customerView" class="container">
        <!-- API 設定（當未能決定 BASE 時顯示） -->
        <div id="apiSetup" class="api-setup" style="display:none">
            <div class="row">
                <div>
                    <h3 style="margin-bottom:.25rem">⚙️ 系統設定</h3>
                    <div class="muted">請輸入你的 Google Apps Script Web App（/exec）網址，或在網址加上 <code>?api=</code></div>
                </div>
                <div class="right muted" id="apiHint"></div>
            </div>
            <input type="text" id="apiUrlInput" class="form-input"
                placeholder="https://script.google.com/macros/s/.../exec" />
            <div class="row" style="margin-top:.75rem">
                <button class="btn btn-primary" onclick="saveApiUrl()">💾 儲存設定</button>
                <button class="btn btn-secondary" onclick="tryHealth()">🩺 連線測試</button>
            </div>
        </div>

        <!-- Alerts -->
        <div id="alertContainer"></div>

        <div class="hero">
            <h1>線上訂位服務</h1>
            <p>選擇日期、時間與座位，立即完成預約</p>
        </div>

        <div class="grid grid-2">
            <!-- Left: Filters -->
            <div>
                <div class="card">
                    <div class="row" style="justify-content:space-between">
                        <h3 class="card-title">📅 選擇日期</h3>
                        <div id="healthDot" class="muted">API：未知</div>
                    </div>
                    <input type="date" id="customerDate" class="form-input" onchange="onDateChange()" />
                </div>

                <div class="card">
                    <h3 class="card-title">👥 用餐人數</h3>
                    <select id="partySize" class="form-select" onchange="filterResources()">
                        <option value="1">1 人</option>
                        <option value="2" selected>2 人</option>
                        <option value="3">3 人</option>
                        <option value="4">4 人</option>
                        <option value="5">5 人</option>
                        <option value="6">6 人</option>
                        <option value="7">7 人</option>
                        <option value="8">8 人</option>
                    </select>
                </div>

                <div class="card">
                    <h3 class="card-title">🪑 選擇座位</h3>
                    <div id="resourceList">
                        <div class="empty-state">
                            <div class="empty-state-icon">🔍</div>
                            <p>載入座位資料中...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right: Times & Form -->
            <div>
                <div id="timeSlotCard" class="card" style="display:none">
                    <div class="row" style="justify-content:space-between">
                        <h3 class="card-title">⏰ 選擇時間</h3>
                        <div class="row muted">
                            <span>間隔 30 分</span>
                        </div>
                    </div>
                    <div id="timeSlotsList" class="time-slots"></div>
                </div>

                <div id="bookingForm" class="card" style="display:none">
                    <h3 class="card-title">📝 填寫資訊</h3>
                    <div class="form-group">
                        <label class="form-label">姓名 *</label>
                        <input type="text" id="customerName" class="form-input" placeholder="請輸入您的姓名" />
                    </div>
                    <div class="form-group">
                        <label class="form-label">手機號碼 *</label>
                        <input type="tel" id="customerPhone" class="form-input" placeholder="請輸入您的手機號碼" />
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email（選填）</label>
                        <input type="email" id="customerEmail" class="form-input" placeholder="請輸入您的 Email" />
                    </div>
                    <div class="form-group">
                        <label class="form-label">特殊需求</label>
                        <textarea id="customerNotes" class="form-textarea" rows="3" placeholder="如：素食、兒童座椅等"></textarea>
                    </div>
                    <button class="btn btn-primary btn-full" onclick="confirmReservation()">✅ 確認預約</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Staff View -->
    <div id="staffView" class="container" style="display:none">
        <div style="margin-bottom:1.25rem">
            <div class="row" style="justify-content:space-between">
                <h1 style="font-size:1.6rem;font-weight:800;color:#111827">預約管理</h1>
                <div class="muted" id="staffApiState">API：未知</div>
            </div>
            <div class="row" style="gap:.75rem;flex-wrap:wrap;margin-top:.5rem">
                <input type="date" id="staffDate" class="form-input" style="max-width:200px"
                    onchange="loadStaffReservations()" />
                <span style="color:#6b7280">共 <strong id="totalReservations">0</strong> 筆預約</span>
                <button class="btn btn-secondary" onclick="loadStaffReservations()">🔄 重新整理</button>
            </div>
        </div>
        <div class="card">
            <div id="staffReservationList">
                <div class="empty-state">
                    <div class="empty-state-icon">📅</div>
                    <p>載入預約資料中...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========= 決定 API BASE：?api= > localStorage > 同源推斷 =========
        function normalizeExec(u) {
            try {
                const x = new URL(u);
                if (!/\/exec$/.test(x.pathname)) {
                    x.pathname = x.pathname.replace(/\/exec.*/, '/exec');
                    if (!/\/exec$/.test(x.pathname)) x.pathname = (x.pathname.replace(/\/$/, '') + '/exec');
                }
                x.search = ''; x.hash = '';
                return x.toString();
            } catch (e) { return ''; }
        }
        (function decideBase() {
            const url = new URL(location.href);
            const apiParam = url.searchParams.get('api');
            const ls = localStorage.getItem('gasApiUrl');
            let base = '';
            if (apiParam) { base = normalizeExec(apiParam); localStorage.setItem('gasApiUrl', base); }
            else if (ls) { base = normalizeExec(ls); }
            else {
                const here = new URL(location.href);
                const path = here.pathname.endsWith('/exec') ? here.pathname : here.pathname.replace(/\/exec.*/, '/exec');
                base = here.origin + path;
            }
            window.__GAS_BASE__ = base;
            // UI 顯示
            const hint = document.getElementById('apiHint');
            hint.textContent = base ? `目前 BASE：${base}` : '未設定，請輸入 /exec 網址';
            const showSetup = !base || (!base.includes('script.google.com') && !/\/exec$/.test(base));
            document.getElementById('apiSetup').style.display = showSetup ? 'block' : 'none';
        })();

        // ========= 共用工具 =========
        const $ = sel => document.querySelector(sel);
        const fmt2 = n => String(n).padStart(2, '0');
        const today = () => { const d = new Date(); return `${d.getFullYear()}-${fmt2(d.getMonth() + 1)}-${fmt2(d.getDate())}`; };
        function showLoading(b) { $('#loadingOverlay').classList.toggle('show', !!b); }
        function escapeHTML(s) { return String(s || '').replace(/[&<>"']/g, m => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[m])); }
        function showAlert(message, type = 'success') {
            const container = $('#alertContainer'); const el = document.createElement('div');
            el.className = `alert alert-${type}`; el.innerHTML = `<span style="font-size:1.2rem">${type === 'success' ? '✅' : type === 'error' ? '❌' : 'ℹ️'}</span><span>${message}</span>`;
            container.appendChild(el);
            setTimeout(() => { el.style.opacity = '0'; el.style.transform = 'translateY(-6px)'; el.style.transition = 'all .25s'; setTimeout(() => el.remove(), 250); }, 4500);
        }
        async function safeJson(res) { const t = await res.text(); try { return JSON.parse(t) } catch { return { __raw: t } } }
        async function api(action, params = {}) {
            const BASE = window.__GAS_BASE__;
            if (!BASE) throw new Error('尚未設定 API BASE，請用 ?api= 或在頁面上方儲存 /exec 網址');
            const qs = new URLSearchParams({ action, ...params });
            const r = await fetch(`${BASE}?${qs.toString()}`, { method: 'GET', cache: 'no-store' });
            const j = await safeJson(r);
            if (!r.ok) throw new Error(`HTTP ${r.status}`);
            if (j && j.success === false) throw new Error(j.error || 'API 失敗');
            return j.data ?? j;
        }

        // ========= 狀態 =========
        let apiUrl = 'https://thomastsao0704.github.io/WebApp/App98/index.html?api=https://script.google.com/macros/s/AKfycbwQ22P3jxKGiDpvgu6rwPsCRSiGNV02gEnN2YPAu7Cl1ZjJ1FVUkRHpiSICkBmDqUH5yw/exec';               // 僅用於顯示/儲存
        let resources = [];
        let selectedResource = null;
        let selectedTime = null;

        // ========= 初始化 =========
        async function init() {
            // 日期預設今日 & 最小值今日
            const t = today();
            $('#customerDate').value = t; $('#customerDate').min = t;
            $('#staffDate').value = t;

            apiUrl = window.__GAS_BASE__ || '';
            if (!apiUrl) { $('#apiSetup').style.display = 'block'; $('#healthDot').textContent = 'API：未設定'; $('#staffApiState').textContent = 'API：未設定'; return; }

            // 健康檢查
            await tryHealth();

            // 載入座位
            await loadResources();
        }

        // 儲存 API
        function saveApiUrl() {
            const val = $('#apiUrlInput').value.trim();
            if (!val) return showAlert('請輸入 API 網址', 'error');
            if (!val.endsWith('/exec') && !val.includes('script.google.com')) return showAlert('請輸入有效的 Google Apps Script /exec 網址', 'error');
            const normalized = normalizeExec(val);
            localStorage.setItem('gasApiUrl', normalized);
            window.__GAS_BASE__ = normalized;
            apiUrl = normalized;
            $('#apiSetup').style.display = 'none';
            showAlert('✅ API 網址已儲存', 'success');
            tryHealth();
            loadResources();
        }

        async function tryHealth() {
            try {
                const res = await api('ping'); // 你的 doGet 已支援 ping
                $('#healthDot').textContent = 'API：正常';
                $('#staffApiState').textContent = 'API：正常';
            } catch (e) {
                $('#healthDot').textContent = 'API：異常';
                $('#staffApiState').textContent = 'API：異常';
                showAlert('連線測試失敗：' + e.message, 'error');
            }
        }

        // ========= API 呼叫封裝（GET） =========
        async function callAPI(action, params = {}) {
            showLoading(true);
            try {
                return await api(action, params);
            } catch (err) {
                showAlert('API 呼叫失敗：' + err.message, 'error');
                return null;
            } finally {
                showLoading(false);
            }
        }

        // ========= 資料載入 =========
        async function loadResources() {
            const data = await callAPI('getResources');
            if (data) {
                resources = data;
                filterResources();
            }
        }

        // 顧客：篩選座位
        function filterResources() {
            const partySize = parseInt($('#partySize').value, 10);
            const list = resources.filter(r => Number(r.capacity || 0) >= partySize);
            const html = list.map(r => `
        <div class="resource-card ${selectedResource === r.id ? 'selected' : ''}" onclick="selectResource('${r.id}')">
          <div class="resource-name">${escapeHTML(r.name)}</div>
          <div class="resource-capacity">最多 ${r.capacity} 人</div>
          <div class="resource-tags">${(r.tags || []).map(t => `<span class="tag">${escapeHTML(t)}</span>`).join('')}</div>
        </div>
      `).join('');
            $('#resourceList').innerHTML = html || `<div class="empty-state"><div class="empty-state-icon">😅</div><p>沒有符合條件的座位</p></div>`;
        }

        function onDateChange() {
            selectedResource = null; selectedTime = null;
            $('#timeSlotCard').style.display = 'none';
            $('#bookingForm').style.display = 'none';
            filterResources();
        }

        function selectResource(resourceId) {
            selectedResource = resourceId;
            selectedTime = null;
            filterResources();
            loadTimeSlots();
            $('#timeSlotCard').style.display = 'block';
            $('#bookingForm').style.display = 'none';
        }

        // 生成 11:00 ~ 21:00 / 30分粒度
        function generateTimeSlots() {
            const slots = [];
            for (let h = 11; h <= 21; h++) {
                for (let m = 0; m < 60; m += 30) {
                    slots.push(`${fmt2(h)}:${fmt2(m)}`);
                }
            }
            return slots;
        }

        async function loadTimeSlots() {
            const date = $('#customerDate').value;
            const times = generateTimeSlots();

            // 並行檢查可用性
            const checks = await Promise.all(times.map(t => api('checkAvailability', {
                resourceId: selectedResource, date, time: t, duration: 120
            }).catch(() => ({ available: false }))));

            const html = times.map((t, i) => {
                const available = checks[i] && checks[i].available === true;
                const sel = selectedTime === t ? 'selected' : '';
                const dis = available ? '' : 'disabled';
                const cls = `time-slot ${available ? '' : 'unavailable'} ${sel}`;
                const onclick = available ? `onclick="selectTime('${t}')"` : '';
                return `<button class="${cls}" ${onclick} ${dis}>${t}</button>`;
            }).join('');

            $('#timeSlotsList').innerHTML = html;
        }

        function selectTime(t) {
            selectedTime = t;
            // 更新按鈕樣式
            [...document.querySelectorAll('.time-slot')].forEach(btn => {
                if (btn.textContent.trim() === t) btn.classList.add('selected'); else btn.classList.remove('selected');
            });
            $('#bookingForm').style.display = 'block';
            $('#bookingForm').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        async function confirmReservation() {
            const name = $('#customerName').value.trim();
            const phone = $('#customerPhone').value.trim();
            const email = $('#customerEmail').value.trim();
            const notes = $('#customerNotes').value.trim();
            const date = $('#customerDate').value;
            const partySize = parseInt($('#partySize').value, 10);

            if (!selectedResource || !selectedTime) { return showAlert('請先選擇座位與時段', 'error'); }
            if (!name || !phone) { return showAlert('請填寫姓名與手機號碼', 'error'); }

            const result = await callAPI('createReservation', {
                resourceId: selectedResource,
                customerName: name,
                phone, email,
                date, time: selectedTime,
                duration: 120,
                partySize,
                status: 'confirmed',
                notes
            });

            if (result) {
                showAlert(`🎉 預約成功！訂位編號：${result.id}`, 'success');
                // reset
                $('#customerName').value = ''; $('#customerPhone').value = ''; $('#customerEmail').value = ''; $('#customerNotes').value = '';
                selectedResource = null; selectedTime = null;
                $('#timeSlotCard').style.display = 'none'; $('#bookingForm').style.display = 'none';
                filterResources();
            }
        }

        // ========= 後台 =========
        async function loadStaffReservations() {
            const date = $('#staffDate').value;
            const data = await callAPI('getReservations', { date });
            if (!data) { return; }
            $('#totalReservations').textContent = data.length;

            if (data.length === 0) {
                $('#staffReservationList').innerHTML = `<div class="empty-state"><div class="empty-state-icon">📭</div><p>今日無預約</p></div>`;
                return;
            }

            const html = data.sort((a, b) => (a.time || '').localeCompare(b.time || '')).map(r => {
                const res = resources.find(x => x.id === r.resourceId);
                const seat = res ? res.name : r.resourceId;
                return `
          <div class="reservation-item">
            <div class="reservation-header">
              <div>
                <div class="reservation-time">${r.time || '--:--'} - ${escapeHTML(seat)}</div>
                <div class="reservation-details">${escapeHTML(r.customerName || '')} (${escapeHTML(r.phone || '')}) · ${r.partySize || '-'}人</div>
                ${r.notes ? `<div class="reservation-details" style="margin-top:.25rem">💬 ${escapeHTML(r.notes)}</div>` : ''}
              </div>
              <span class="status-badge status-${r.status}">${statusText(r.status)}</span>
            </div>
          </div>
        `;
            }).join('');
            $('#staffReservationList').innerHTML = html;
        }

        function statusText(s) {
            return ({ confirmed: '已確認', checked_in: '已到場', completed: '已完成', no_show: '未到場', cancelled: '已取消' })[s] || s;
        }

        // ========= 視圖切換 =========
        function switchView(view, evt) {
            document.querySelectorAll('.nav-button').forEach(b => b.classList.remove('active'));
            if (evt && evt.target) evt.target.classList.add('active');
            $('#customerView').style.display = (view === 'customer') ? 'block' : 'none';
            $('#staffView').style.display = (view === 'staff') ? 'block' : 'none';
            if (view === 'staff') loadStaffReservations();
        }

        // ========= 啟動 =========
        window.onload = init;
    </script>
</body>

</html>
