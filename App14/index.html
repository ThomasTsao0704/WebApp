<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TPEx å¹³å‡æ—¥äº¤æ˜“é‡ Top 10</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", Arial, sans-serif;
           background: linear-gradient(135deg,#667eea 0%,#764ba2 100%); min-height: 100vh; color: #333; }
    .container { max-width: 800px; margin: 0 auto; padding: 20px; }
    .header { text-align: center; color: #fff; margin-bottom: 20px; }
    .header h1 { font-size: 1.8rem; text-shadow: 2px 2px 4px rgba(0,0,0,.3); margin-bottom: 8px; }
    .header p { opacity: .9; font-size: 14px; }
    .update-time { display: inline-block; margin-top: 10px; padding: 6px 14px; border-radius: 20px;
                   background: rgba(255,255,255,.2); backdrop-filter: blur(10px); font-size: 13px; }
    .controls { background: #fff; padding: 15px; border-radius: 12px; margin-bottom: 15px; 
                box-shadow: 0 8px 24px rgba(0,0,0,.08); text-align: center; }
    button { padding: 12px 20px; font-size: 14px; border-radius: 8px; cursor: pointer; 
             border: none; background: #667eea; color: #fff; font-weight: 600; 
             transition: all 0.2s; margin: 0 5px; }
    button:hover { background: #5a6fd8; transform: translateY(-1px); }
    .table-section { background: #fff; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,.08); overflow: hidden; }
    .section-header { background: linear-gradient(135deg,#667eea,#764ba2); color: #fff; 
                     padding: 15px 20px; font-weight: 600; font-size: 16px; }
    table { width: 100%; border-collapse: collapse; }
    th { background: #f8f9fa; color: #666; font-size: 13px; font-weight: 600; 
         text-align: left; padding: 12px 15px; border-bottom: 2px solid #dee2e6; }
    td { padding: 12px 15px; border-bottom: 1px solid #eee; }
    tr:hover { background: #f8f9ff; }
    .rank { background: linear-gradient(135deg, #ffd700, #ffed4e); color: #333; 
            font-weight: bold; text-align: center; border-radius: 50%; 
            width: 25px; height: 25px; line-height: 25px; font-size: 12px; }
    .rank.top3 { background: linear-gradient(135deg, #ff6b6b, #ee5a24); color: #fff; }
    .volume { font-weight: 600; color: #2d3436; }
    .date-info { text-align: center; background: #e8f4f8; padding: 10px; 
                 color: #2d3436; font-size: 14px; font-weight: 500; }
    .alert { margin: 15px 0; padding: 12px 16px; border-radius: 8px; 
             background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; 
             text-align: center; display: none; }
    .alert.success { background: #e8f5e9; border-color: #a5d6a7; color: #2e7d32; }
    .alert.info { background: #e3f2fd; border-color: #90caf9; color: #1565c0; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ“ˆ TPEx å¹³å‡æ—¥äº¤æ˜“é‡ Top 10</h1>
      <p>æ«ƒè²·ä¸­å¿ƒå¹³å‡æ—¥äº¤æ˜“é‡æ’è¡Œæ¦œï¼ˆç¤ºç¯„è³‡æ–™ï¼‰</p>
      <div class="update-time" id="lastUpdate">è³‡æ–™æ™‚é–“ï¼š2025/08/21</div>
    </div>

    <div class="controls">
      <button id="btnExport">ğŸ“¥ åŒ¯å‡º CSV</button>
      <button id="btnInfo">â„¹ï¸ é—œæ–¼ CORS å•é¡Œ</button>
    </div>

    <div id="alertMsg" class="alert"></div>

    <div class="table-section">
      <div class="section-header">
        <span>ğŸ“Š å¹³å‡æ—¥äº¤æ˜“é‡æ’è¡Œæ¦œ Top 10</span>
      </div>
      <div class="date-info">è³‡æ–™æ—¥æœŸï¼š2025/08/21 (ä¸‰)</div>
      <table>
        <thead>
          <tr>
            <th style="width: 60px; text-align: center;">æ’å</th>
            <th>è­‰åˆ¸ä»£è™Ÿ</th>
            <th>å…¬å¸åç¨±</th>
            <th style="text-align: right;">å¹³å‡æ—¥äº¤æ˜“é‡</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <div style="background: #fff; margin-top: 15px; padding: 15px; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,.08);">
      <h3 style="color: #667eea; margin-bottom: 10px;">ğŸ¯ å­¸ç¿’é‡é»</h3>
      <p style="color: #666; line-height: 1.6;">
        é€™å€‹ç¯„ä¾‹å±•ç¤ºäº† <strong>CORS (è·¨ä¾†æºè³‡æºå…±äº«)</strong> çš„å¯¦éš›å•é¡Œã€‚
        é›–ç„¶ API æœ¬èº«æ­£å¸¸é‹ä½œï¼Œä½†ç€è¦½å™¨çš„å®‰å…¨æ©Ÿåˆ¶é˜»æ­¢äº†è·¨åŸŸè«‹æ±‚ã€‚
        åœ¨å¯¦éš›é–‹ç™¼ä¸­ï¼Œé€šå¸¸éœ€è¦ï¼š
      </p>
      <ul style="color: #666; margin-top: 10px; padding-left: 20px;">
        <li>å¾Œç«¯è¨­å®šé©ç•¶çš„ CORS æ¨™é ­</li>
        <li>ä½¿ç”¨ä¼ºæœå™¨ç«¯ä»£ç†</li>
        <li>æˆ–å»ºç«‹è‡ªå·±çš„ API ç«¯é»</li>
      </ul>
    </div>
  </div>

  <script>
    // æ ¼å¼åŒ–æ•¸å­—
    const nf = new Intl.NumberFormat('zh-TW', { 
      minimumFractionDigits: 2, 
      maximumFractionDigits: 2 
    });
    
    // é¡¯ç¤ºè¨Šæ¯
    const showAlert = (msg, type='info') => {
      const el = document.getElementById('alertMsg');
      el.textContent = msg;
      el.className = `alert ${type}`;
      el.style.display = 'block';
      setTimeout(() => el.style.display = 'none', 5000);
    };

    // ä½¿ç”¨å¾ API æŠ“å–çš„å¯¦éš›è³‡æ–™
    const SAMPLE_DATA = [
      {"Date":"1140821","Rank":"1","SecuritiesCompanyCode":"5371","CompanyName":"ä¸­å¼·å…‰é›»","AverageDailyTradingVolume":"87912.11"},
      {"Date":"1140821","Rank":"2","SecuritiesCompanyCode":"5309","CompanyName":"ç³»çµ±é›»å­","AverageDailyTradingVolume":"49496.71"},
      {"Date":"1140821","Rank":"3","SecuritiesCompanyCode":"6140","CompanyName":"è¨Šé”é›»è…¦","AverageDailyTradingVolume":"42168.66"},
      {"Date":"1140821","Rank":"4","SecuritiesCompanyCode":"5498","CompanyName":"å‡±å´´","AverageDailyTradingVolume":"35269.99"},
      {"Date":"1140821","Rank":"5","SecuritiesCompanyCode":"3294","CompanyName":"è‹±æ¿Ÿ","AverageDailyTradingVolume":"31611.40"},
      {"Date":"1140821","Rank":"6","SecuritiesCompanyCode":"3297","CompanyName":"æ­ç‰¹é›»å­","AverageDailyTradingVolume":"30266.49"},
      {"Date":"1140821","Rank":"7","SecuritiesCompanyCode":"5314","CompanyName":"ä¸–ç´€*","AverageDailyTradingVolume":"27905.85"},
      {"Date":"1140821","Rank":"8","SecuritiesCompanyCode":"5251","CompanyName":"å¤©é‰é›»","AverageDailyTradingVolume":"26170.03"},
      {"Date":"1140821","Rank":"9","SecuritiesCompanyCode":"4931","CompanyName":"æ–°ç››åŠ›","AverageDailyTradingVolume":"23464.92"},
      {"Date":"1140821","Rank":"10","SecuritiesCompanyCode":"5392","CompanyName":"èƒ½ç‡","AverageDailyTradingVolume":"23241.93"}
    ];

    // æ¸²æŸ“è¡¨æ ¼
    function renderTable() {
      const tbody = document.getElementById('tbody');
      
      tbody.innerHTML = SAMPLE_DATA.map((item, index) => {
        const rank = parseInt(item.Rank);
        const rankClass = rank <= 3 ? 'rank top3' : 'rank';
        const volume = parseFloat(item.AverageDailyTradingVolume);
        
        return `
          <tr>
            <td style="text-align: center;">
              <div class="${rankClass}">${rank}</div>
            </td>
            <td><strong>${item.SecuritiesCompanyCode}</strong></td>
            <td>${item.CompanyName || '-'}</td>
            <td style="text-align: right;" class="volume">${nf.format(volume)}</td>
          </tr>
        `;
      }).join('');
    }

    // åŒ¯å‡º CSV
    function exportCSV() {
      const header = ['æ’å', 'è­‰åˆ¸ä»£è™Ÿ', 'å…¬å¸åç¨±', 'å¹³å‡æ—¥äº¤æ˜“é‡'];
      const rows = SAMPLE_DATA.map((item) => [
        item.Rank,
        item.SecuritiesCompanyCode,
        item.CompanyName || '',
        item.AverageDailyTradingVolume
      ]);

      const csv = [
        `# TPEx å¹³å‡æ—¥äº¤æ˜“é‡ Top 10`,
        `# æ—¥æœŸ: 2025/08/21`,
        `# åŒ¯å‡ºæ™‚é–“: ${new Date().toLocaleString('zh-TW')}`,
        '',
        header.join(','),
        ...rows.map(row => 
          row.map(cell => 
            typeof cell === 'string' && cell.includes(',') 
              ? `"${cell.replace(/"/g, '""')}"` 
              : cell
          ).join(',')
        )
      ].join('\n');

      const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `TPExå¹³å‡æ—¥äº¤æ˜“é‡Top10_20250821.csv`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      
      showAlert('å·²åŒ¯å‡º CSV æª”æ¡ˆ', 'success');
    }

    // é¡¯ç¤º CORS èªªæ˜
    function showCorsInfo() {
      showAlert('CORS é˜»æ­¢äº†ç›´æ¥çš„ API è«‹æ±‚ã€‚é€™æ˜¯ç€è¦½å™¨çš„å®‰å…¨æ©Ÿåˆ¶ï¼Œç”¨ä¾†é˜²æ­¢æƒ¡æ„ç¶²ç«™å­˜å–å…¶ä»–ç¶²åŸŸçš„è³‡æºã€‚å¯¦éš›é–‹ç™¼ä¸­éœ€è¦å¾Œç«¯é…åˆè¨­å®š CORS æ¨™é ­ã€‚', 'info');
    }

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
      renderTable();
      document.getElementById('btnExport').addEventListener('click', exportCSV);
      document.getElementById('btnInfo').addEventListener('click', showCorsInfo);
      
      // é¡¯ç¤ºæ­¡è¿è¨Šæ¯
      setTimeout(() => {
        showAlert('è¼‰å…¥å®Œæˆï¼é€™æ˜¯ä½¿ç”¨å¯¦éš› API è³‡æ–™çš„ç¤ºç¯„ç‰ˆæœ¬ã€‚', 'success');
      }, 500);
    });
  </script>
</body>
</html>
