<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TPEx 平均日交易量 Top 10</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", Arial, sans-serif;
           background: linear-gradient(135deg,#667eea 0%,#764ba2 100%); min-height: 100vh; color: #333; }
    .container { max-width: 800px; margin: 0 auto; padding: 20px; }
    .header { text-align: center; color: #fff; margin-bottom: 20px; }
    .header h1 { font-size: 1.8rem; text-shadow: 2px 2px 4px rgba(0,0,0,.3); margin-bottom: 8px; }
    .header p { opacity: .9; font-size: 14px; }
    .update-time { display: inline-block; margin-top: 10px; padding: 6px 14px; border-radius: 20px;
                   background: rgba(255,255,255,.2); backdrop-filter: blur(10px); font-size: 13px; }
    .controls { background: #fff; padding: 15px; border-radius: 12px; margin-bottom: 15px; 
                box-shadow: 0 8px 24px rgba(0,0,0,.08); text-align: center; }
    button { padding: 12px 20px; font-size: 14px; border-radius: 8px; cursor: pointer; 
             border: none; background: #667eea; color: #fff; font-weight: 600; 
             transition: all 0.2s; margin: 0 5px; }
    button:hover { background: #5a6fd8; transform: translateY(-1px); }
    .table-section { background: #fff; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,.08); overflow: hidden; }
    .section-header { background: linear-gradient(135deg,#667eea,#764ba2); color: #fff; 
                     padding: 15px 20px; font-weight: 600; font-size: 16px; }
    table { width: 100%; border-collapse: collapse; }
    th { background: #f8f9fa; color: #666; font-size: 13px; font-weight: 600; 
         text-align: left; padding: 12px 15px; border-bottom: 2px solid #dee2e6; }
    td { padding: 12px 15px; border-bottom: 1px solid #eee; }
    tr:hover { background: #f8f9ff; }
    .rank { background: linear-gradient(135deg, #ffd700, #ffed4e); color: #333; 
            font-weight: bold; text-align: center; border-radius: 50%; 
            width: 25px; height: 25px; line-height: 25px; font-size: 12px; }
    .rank.top3 { background: linear-gradient(135deg, #ff6b6b, #ee5a24); color: #fff; }
    .volume { font-weight: 600; color: #2d3436; }
    .date-info { text-align: center; background: #e8f4f8; padding: 10px; 
                 color: #2d3436; font-size: 14px; font-weight: 500; }
    .alert { margin: 15px 0; padding: 12px 16px; border-radius: 8px; 
             background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; 
             text-align: center; display: none; }
    .alert.success { background: #e8f5e9; border-color: #a5d6a7; color: #2e7d32; }
    .alert.info { background: #e3f2fd; border-color: #90caf9; color: #1565c0; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>📈 TPEx 平均日交易量 Top 10</h1>
      <p>櫃買中心平均日交易量排行榜（示範資料）</p>
      <div class="update-time" id="lastUpdate">資料時間：2025/08/21</div>
    </div>

    <div class="controls">
      <button id="btnExport">📥 匯出 CSV</button>
      <button id="btnInfo">ℹ️ 關於 CORS 問題</button>
    </div>

    <div id="alertMsg" class="alert"></div>

    <div class="table-section">
      <div class="section-header">
        <span>📊 平均日交易量排行榜 Top 10</span>
      </div>
      <div class="date-info">資料日期：2025/08/21 (三)</div>
      <table>
        <thead>
          <tr>
            <th style="width: 60px; text-align: center;">排名</th>
            <th>證券代號</th>
            <th>公司名稱</th>
            <th style="text-align: right;">平均日交易量</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <div style="background: #fff; margin-top: 15px; padding: 15px; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,.08);">
      <h3 style="color: #667eea; margin-bottom: 10px;">🎯 學習重點</h3>
      <p style="color: #666; line-height: 1.6;">
        這個範例展示了 <strong>CORS (跨來源資源共享)</strong> 的實際問題。
        雖然 API 本身正常運作，但瀏覽器的安全機制阻止了跨域請求。
        在實際開發中，通常需要：
      </p>
      <ul style="color: #666; margin-top: 10px; padding-left: 20px;">
        <li>後端設定適當的 CORS 標頭</li>
        <li>使用伺服器端代理</li>
        <li>或建立自己的 API 端點</li>
      </ul>
    </div>
  </div>

  <script>
    // 格式化數字
    const nf = new Intl.NumberFormat('zh-TW', { 
      minimumFractionDigits: 2, 
      maximumFractionDigits: 2 
    });
    
    // 顯示訊息
    const showAlert = (msg, type='info') => {
      const el = document.getElementById('alertMsg');
      el.textContent = msg;
      el.className = `alert ${type}`;
      el.style.display = 'block';
      setTimeout(() => el.style.display = 'none', 5000);
    };

    // 使用從 API 抓取的實際資料
    const SAMPLE_DATA = [
      {"Date":"1140821","Rank":"1","SecuritiesCompanyCode":"5371","CompanyName":"中強光電","AverageDailyTradingVolume":"87912.11"},
      {"Date":"1140821","Rank":"2","SecuritiesCompanyCode":"5309","CompanyName":"系統電子","AverageDailyTradingVolume":"49496.71"},
      {"Date":"1140821","Rank":"3","SecuritiesCompanyCode":"6140","CompanyName":"訊達電腦","AverageDailyTradingVolume":"42168.66"},
      {"Date":"1140821","Rank":"4","SecuritiesCompanyCode":"5498","CompanyName":"凱崴","AverageDailyTradingVolume":"35269.99"},
      {"Date":"1140821","Rank":"5","SecuritiesCompanyCode":"3294","CompanyName":"英濟","AverageDailyTradingVolume":"31611.40"},
      {"Date":"1140821","Rank":"6","SecuritiesCompanyCode":"3297","CompanyName":"杭特電子","AverageDailyTradingVolume":"30266.49"},
      {"Date":"1140821","Rank":"7","SecuritiesCompanyCode":"5314","CompanyName":"世紀*","AverageDailyTradingVolume":"27905.85"},
      {"Date":"1140821","Rank":"8","SecuritiesCompanyCode":"5251","CompanyName":"天鉞電","AverageDailyTradingVolume":"26170.03"},
      {"Date":"1140821","Rank":"9","SecuritiesCompanyCode":"4931","CompanyName":"新盛力","AverageDailyTradingVolume":"23464.92"},
      {"Date":"1140821","Rank":"10","SecuritiesCompanyCode":"5392","CompanyName":"能率","AverageDailyTradingVolume":"23241.93"}
    ];

    // 渲染表格
    function renderTable() {
      const tbody = document.getElementById('tbody');
      
      tbody.innerHTML = SAMPLE_DATA.map((item, index) => {
        const rank = parseInt(item.Rank);
        const rankClass = rank <= 3 ? 'rank top3' : 'rank';
        const volume = parseFloat(item.AverageDailyTradingVolume);
        
        return `
          <tr>
            <td style="text-align: center;">
              <div class="${rankClass}">${rank}</div>
            </td>
            <td><strong>${item.SecuritiesCompanyCode}</strong></td>
            <td>${item.CompanyName || '-'}</td>
            <td style="text-align: right;" class="volume">${nf.format(volume)}</td>
          </tr>
        `;
      }).join('');
    }

    // 匯出 CSV
    function exportCSV() {
      const header = ['排名', '證券代號', '公司名稱', '平均日交易量'];
      const rows = SAMPLE_DATA.map((item) => [
        item.Rank,
        item.SecuritiesCompanyCode,
        item.CompanyName || '',
        item.AverageDailyTradingVolume
      ]);

      const csv = [
        `# TPEx 平均日交易量 Top 10`,
        `# 日期: 2025/08/21`,
        `# 匯出時間: ${new Date().toLocaleString('zh-TW')}`,
        '',
        header.join(','),
        ...rows.map(row => 
          row.map(cell => 
            typeof cell === 'string' && cell.includes(',') 
              ? `"${cell.replace(/"/g, '""')}"` 
              : cell
          ).join(',')
        )
      ].join('\n');

      const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `TPEx平均日交易量Top10_20250821.csv`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      
      showAlert('已匯出 CSV 檔案', 'success');
    }

    // 顯示 CORS 說明
    function showCorsInfo() {
      showAlert('CORS 阻止了直接的 API 請求。這是瀏覽器的安全機制，用來防止惡意網站存取其他網域的資源。實際開發中需要後端配合設定 CORS 標頭。', 'info');
    }

    // 初始化
    document.addEventListener('DOMContentLoaded', () => {
      renderTable();
      document.getElementById('btnExport').addEventListener('click', exportCSV);
      document.getElementById('btnInfo').addEventListener('click', showCorsInfo);
      
      // 顯示歡迎訊息
      setTimeout(() => {
        showAlert('載入完成！這是使用實際 API 資料的示範版本。', 'success');
      }, 500);
    });
  </script>
</body>
</html>
