<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ä¼‘é–’æ´»å‹•æœå°‹ï¼ˆå–®æª”ç‰ˆï¼‰</title>
  <!-- Tailwind CSS CDNï¼ˆå…å®‰è£ï¼‰ -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* æ·±è‰²æ¼¸å±¤èƒŒæ™¯ & å°å‹•ç•« */
    body { min-height:100vh; background: linear-gradient(135deg,#4c1d95 0%,#1e3a8a 50%,#312e81 100%); }
    .glass { background: rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.18); backdrop-filter: blur(6px); }
    .spin { animation: spin 1s linear infinite; } @keyframes spin { to { transform: rotate(360deg); } }
    .rtl { direction: rtl; }
  </style>
</head>
<body class="text-white">
  <!-- å°èˆªåˆ— -->
  <nav class="sticky top-0 z-50 glass">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center space-x-3">
        <div class="text-2xl">ğŸª</div>
        <h1 id="nav-title" class="text-xl font-bold">ä¼‘é–’æ´»å‹•æœå°‹</h1>
      </div>
      <div class="hidden md:flex items-center space-x-2" id="tabs"></div>
      <!-- èªè¨€åˆ‡æ› -->
      <div class="relative">
        <button id="langBtn" class="px-3 py-2 rounded-lg bg-white/20 hover:bg-white/30 flex items-center space-x-2">
          <span id="langFlag">ğŸ‡¹ğŸ‡¼</span><span id="langNative" class="hidden sm:inline">ç¹é«”ä¸­æ–‡</span>
        </button>
        <div id="langMenu" class="absolute right-0 mt-2 w-56 max-h-72 overflow-auto bg-white text-gray-800 rounded-lg shadow-xl border hidden"></div>
      </div>
    </div>
  </nav>

  <main class="max-w-6xl mx-auto px-4 py-8">
    <!-- æ¨™é¡Œèˆ‡çµ±è¨ˆ -->
    <section class="text-center mb-10">
      <h2 id="app-title" class="text-4xl md:text-6xl font-extrabold mb-3">ä¼‘é–’æ´»å‹•æœå°‹</h2>
      <p id="app-subtitle" class="text-white/80 text-lg mb-8">æ¢ç´¢åŸå¸‚ä¸­æœ€ç²¾å½©çš„ä¼‘é–’å¨›æ¨‚æ´»å‹•</p>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 max-w-4xl mx-auto">
        <div class="glass rounded-xl p-4 text-center">
          <div class="text-sky-300 mb-1">ğŸ“ˆ</div>
          <div id="stat-events" class="text-2xl font-bold">0</div>
          <div id="stat-events-label" class="text-white/70 text-sm">ç¸½æ´»å‹•æ•¸</div>
        </div>
        <div class="glass rounded-xl p-4 text-center">
          <div class="text-emerald-300 mb-1">ğŸ—ºï¸</div>
          <div id="stat-venues" class="text-2xl font-bold">0</div>
          <div id="stat-venues-label" class="text-white/70 text-sm">ç¸½å ´æ‰€æ•¸</div>
        </div>
        <div class="glass rounded-xl p-4 text-center">
          <div class="text-fuchsia-300 mb-1">ğŸŒ</div>
          <div id="stat-cities" class="text-2xl font-bold">0</div>
          <div id="stat-cities-label" class="text-white/70 text-sm">è¦†è“‹åŸå¸‚</div>
        </div>
        <div class="glass rounded-xl p-4 text-center">
          <div class="text-orange-300 mb-1">ğŸ“…</div>
          <div id="stat-thisweek" class="text-2xl font-bold">0</div>
          <div id="stat-thisweek-label" class="text-white/70 text-sm">æœ¬é€±æ´»å‹•</div>
        </div>
      </div>
    </section>

    <!-- å¿«é€Ÿé¸æ“‡å ´æ‰€é¡å‹ -->
    <section class="mb-8">
      <h3 class="text-xl font-semibold text-center mb-3">å¿«é€Ÿé¸æ“‡å ´æ‰€é¡å‹</h3>
      <div id="typeChips" class="flex flex-wrap justify-center gap-2"></div>
    </section>

    <!-- ç¯©é¸å™¨ -->
    <section class="glass rounded-2xl p-6 mb-8">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-4">
        <div>
          <label id="lbl-city" class="block text-sm font-medium mb-2">åŸå¸‚</label>
          <select id="f-city" class="w-full px-3 py-2 bg-white/20 border border-white/30 rounded-lg">
            <option value="">æ‰€æœ‰åŸå¸‚</option>
          </select>
        </div>
        <div>
          <label id="lbl-venueType" class="block text-sm font-medium mb-2">å ´æ‰€é¡å‹</label>
          <select id="f-type" class="w-full px-3 py-2 bg-white/20 border border-white/30 rounded-lg"></select>
        </div>
        <div>
          <label id="lbl-startDate" class="block text-sm font-medium mb-2">é–‹å§‹æ—¥æœŸ</label>
          <input id="f-start" type="date" class="w-full px-3 py-2 bg-white/20 border border-white/30 rounded-lg">
        </div>
        <div>
          <label id="lbl-endDate" class="block text-sm font-medium mb-2">çµæŸæ—¥æœŸ</label>
          <input id="f-end" type="date" class="w-full px-3 py-2 bg-white/20 border border-white/30 rounded-lg">
        </div>
        <div>
          <label id="lbl-keyword" class="block text-sm font-medium mb-2">é—œéµå­—</label>
          <input id="f-key" type="text" class="w-full px-3 py-2 bg-white/20 border border-white/30 rounded-lg" placeholder="æœå°‹æ´»å‹•åç¨±æˆ–æè¿°...">
        </div>
      </div>
      <div class="flex flex-col sm:flex-row gap-3">
        <button id="btn-search" class="flex-1 bg-gradient-to-r from-blue-500 to-purple-600 px-6 py-3 rounded-lg font-semibold hover:from-blue-600 hover:to-purple-700 flex items-center justify-center gap-2">
          <span id="txt-search">æœå°‹æ´»å‹•</span>
        </button>
        <button id="btn-clear" class="px-6 py-3 bg-white/20 rounded-lg font-semibold hover:bg-white/30 flex items-center justify-center gap-2">
          <span id="txt-clear">æ¸…é™¤</span>
        </button>
      </div>
    </section>

    <!-- éŒ¯èª¤è¨Šæ¯ -->
    <div id="errorBox" class="hidden glass rounded-xl p-4 border border-red-400 text-red-100 mb-6"></div>

    <!-- æœå°‹çµæœ -->
    <section id="resultSection" class="mb-6">
      <div class="flex items-center justify-between mb-4">
        <h3 id="lbl-results" class="text-2xl font-bold">æœå°‹çµæœ</h3>
        <div id="countBox" class="text-white/70">0 å€‹æ´»å‹•</div>
      </div>
      <div id="emptyBox" class="hidden text-center py-12">
        <div class="text-6xl mb-3">ğŸ”</div>
        <h4 id="emptyTitle" class="text-xl font-semibold mb-2">æ‰¾ä¸åˆ°æ´»å‹•</h4>
        <p id="emptyHint" class="text-white/70">è«‹å˜—è©¦èª¿æ•´æœå°‹æ¢ä»¶æˆ–é¸æ“‡ä¸åŒçš„æ—¥æœŸç¯„åœ</p>
      </div>
      <div id="cards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
      <div class="text-center mt-8">
        <button id="btn-load" class="hidden bg-gradient-to-r from-purple-500 to-pink-500 px-8 py-3 rounded-lg font-semibold hover:from-purple-600 hover:to-pink-600">
          <span id="txt-load">è¼‰å…¥æ›´å¤š</span>
        </button>
      </div>
    </section>
  </main>

  <!-- è©³æƒ… Modal -->
  <div id="modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 items-center justify-center p-4 hidden">
    <div class="bg-white text-gray-900 rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-auto">
      <div class="relative">
        <img id="m-img" src="" alt="" class="w-full h-64 object-cover">
        <button id="m-close" class="absolute top-4 right-4 bg-black/50 text-white rounded-full p-2 hover:bg-black/70">âœ•</button>
        <div id="m-type" class="absolute top-4 left-4 bg-indigo-500 text-white rounded-full px-3 py-1 text-sm font-semibold"></div>
      </div>
      <div class="p-6">
        <h2 id="m-title" class="text-2xl font-bold mb-4"></h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6 text-gray-800">
          <div class="space-y-2">
            <div class="flex items-center"><span class="mr-2">ğŸ“</span><div><div id="m-venue" class="font-semibold"></div><div id="m-city" class="text-sm"></div></div></div>
            <div class="flex items-center"><span class="mr-2">ğŸ“…</span><span id="m-date"></span></div>
            <div class="flex items-center"><span class="mr-2">â°</span><span id="m-time"></span></div>
          </div>
          <div class="space-y-2">
            <div class="flex items-center"><span class="mr-2">ğŸ‘¥</span><span id="m-att"></span></div>
            <div class="flex items-center"><span class="mr-2">â­</span><span id="m-int"></span></div>
            <div class="flex items-center"><span class="mr-2">ğŸ’°</span><span id="m-price"></span></div>
          </div>
        </div>
        <div class="mb-6">
          <h3 id="m-desc-title" class="text-lg font-semibold mb-2">æ´»å‹•æè¿°</h3>
          <p id="m-desc" class="leading-relaxed"></p>
        </div>
        <div class="flex flex-col sm:flex-row gap-3">
          <button id="m-share" class="flex-1 bg-gradient-to-r from-blue-500 to-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-blue-600 hover:to-purple-700">åˆ†äº«æ´»å‹•</button>
          <button id="m-close2" class="flex-1 bg-gray-200 text-gray-800 px-6 py-3 rounded-lg font-semibold hover:bg-gray-300">é—œé–‰</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ====== ç¿»è­¯ï¼ˆèˆ‡ä½ åŸå§‹æª”ä¸€è‡´èªæ„ï¼‰ ======
    const translations = {
      "zh-TW": {
        app:{title:"ä¼‘é–’æ´»å‹•æœå°‹",subtitle:"æ¢ç´¢åŸå¸‚ä¸­æœ€ç²¾å½©çš„ä¼‘é–’å¨›æ¨‚æ´»å‹•"},
        navigation:{home:"é¦–é ",events:"æ´»å‹•",venues:"å ´æ‰€",about:"é—œæ–¼"},
        filter:{city:"åŸå¸‚",allCities:"æ‰€æœ‰åŸå¸‚",venueType:"å ´æ‰€é¡å‹",allVenues:"æ‰€æœ‰å ´æ‰€",startDate:"é–‹å§‹æ—¥æœŸ",endDate:"çµæŸæ—¥æœŸ",keyword:"é—œéµå­—",keywordPlaceholder:"æœå°‹æ´»å‹•åç¨±æˆ–æè¿°..."},
        venueTypes:{all:"æ‰€æœ‰å ´æ‰€",bar:"é…’å§",restaurant:"é¤å»³",cafe:"å’–å•¡å»³",hotspring:"æº«æ³‰",other:"å…¶ä»–"},
        button:{search:"æœå°‹æ´»å‹•",clear:"æ¸…é™¤",viewMore:"æŸ¥çœ‹è©³æƒ…",loadMore:"è¼‰å…¥æ›´å¤š",close:"é—œé–‰"},
        result:{searchResults:"æœå°‹çµæœ",foundEvents:"å€‹æ´»å‹•",noEvents:"æ‰¾ä¸åˆ°æ´»å‹•",tryDifferent:"è«‹å˜—è©¦èª¿æ•´æœå°‹æ¢ä»¶æˆ–é¸æ“‡ä¸åŒçš„æ—¥æœŸç¯„åœ"},
        event:{attending:"åƒåŠ ",interested:"æ„Ÿèˆˆè¶£",viewDetails:"æŸ¥çœ‹è©³æƒ…",shareEvent:"åˆ†äº«æ´»å‹•",addToCalendar:"åŠ å…¥è¡Œäº‹æ›†",free:"å…è²»",ticketPrice:"ç¥¨åƒ¹",ageLimit:"å¹´é½¡é™åˆ¶",website:"å®˜ç¶²",phone:"é›»è©±",description:"æ´»å‹•æè¿°"},
        stats:{totalEvents:"ç¸½æ´»å‹•æ•¸",totalVenues:"ç¸½å ´æ‰€æ•¸",totalCities:"è¦†è“‹åŸå¸‚",thisWeekEvents:"æœ¬é€±æ´»å‹•"},
        status:{searching:"æœå°‹æ´»å‹•ä¸­...",translating:"ç¿»è­¯ä¸­...",loading:"è¼‰å…¥ä¸­...",loadingMore:"è¼‰å…¥æ›´å¤šä¸­..."},
        error:{searchFailed:"æœå°‹å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦",translationFailed:"ç¿»è­¯æœå‹™æš«æ™‚ç„¡æ³•ä½¿ç”¨",networkError:"ç¶²è·¯é€£ç·šéŒ¯èª¤",loadFailed:"è¼‰å…¥å¤±æ•—"}
      },
      "en": {
        app:{title:"Leisure Events Search",subtitle:"Discover the most exciting leisure and entertainment events in the city"},
        navigation:{home:"Home",events:"Events",venues:"Venues",about:"About"},
        filter:{city:"City",allCities:"All Cities",venueType:"Venue Type",allVenues:"All Venues",startDate:"Start Date",endDate:"End Date",keyword:"Keyword",keywordPlaceholder:"Search event names or descriptions..."},
        venueTypes:{all:"All Venues",bar:"Bars",restaurant:"Restaurants",cafe:"Cafes",hotspring:"Hot Springs",other:"Others"},
        button:{search:"Search Events",clear:"Clear",viewMore:"View Details",loadMore:"Load More",close:"Close"},
        result:{searchResults:"Search Results",foundEvents:"events found",noEvents:"No events found",tryDifferent:"Try adjusting search criteria or selecting different date range"},
        event:{attending:"Attending",interested:"Interested",viewDetails:"View Details",shareEvent:"Share Event",addToCalendar:"Add to Calendar",free:"Free",ticketPrice:"Price",ageLimit:"Age Limit",website:"Website",phone:"Phone",description:"Event Description"},
        stats:{totalEvents:"Total Events",totalVenues:"Total Venues",totalCities:"Cities Covered",thisWeekEvents:"This Week"},
        status:{searching:"Searching events...",translating:"Translating...",loading:"Loading...",loadingMore:"Loading more..."},
        error:{searchFailed:"Search failed, please try again later",translationFailed:"Translation service unavailable",networkError:"Network connection error",loadFailed:"Load failed"}
      },
      "ja": {
        app:{title:"ãƒ¬ã‚¸ãƒ£ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆæ¤œç´¢",subtitle:"è¡—ã§æœ€ã‚‚åˆºæ¿€çš„ãªãƒ¬ã‚¸ãƒ£ãƒ¼ãƒ»ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ†ã‚¤ãƒ¡ãƒ³ãƒˆã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºè¦‹ã—ã‚ˆã†"},
        navigation:{home:"ãƒ›ãƒ¼ãƒ ",events:"ã‚¤ãƒ™ãƒ³ãƒˆ",venues:"ä¼šå ´",about:"ã«ã¤ã„ã¦"},
        filter:{city:"éƒ½å¸‚",allCities:"ã™ã¹ã¦ã®éƒ½å¸‚",venueType:"ä¼šå ´ã‚¿ã‚¤ãƒ—",allVenues:"ã™ã¹ã¦ã®ä¼šå ´",startDate:"é–‹å§‹æ—¥",endDate:"çµ‚äº†æ—¥",keyword:"ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰",keywordPlaceholder:"ã‚¤ãƒ™ãƒ³ãƒˆåã‚„èª¬æ˜ã‚’æ¤œç´¢..."},
        venueTypes:{all:"ã™ã¹ã¦ã®ä¼šå ´",bar:"ãƒãƒ¼",restaurant:"ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³",cafe:"ã‚«ãƒ•ã‚§",hotspring:"æ¸©æ³‰",other:"ãã®ä»–"},
        button:{search:"ã‚¤ãƒ™ãƒ³ãƒˆæ¤œç´¢",clear:"ã‚¯ãƒªã‚¢",viewMore:"è©³ç´°ã‚’è¦‹ã‚‹",loadMore:"ã‚‚ã£ã¨èª­ã¿è¾¼ã‚€",close:"é–‰ã˜ã‚‹"},
        result:{searchResults:"æ¤œç´¢çµæœ",foundEvents:"ã‚¤ãƒ™ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ",noEvents:"ã‚¤ãƒ™ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“",tryDifferent:"æ¤œç´¢æ¡ä»¶ã‚’èª¿æ•´ã™ã‚‹ã‹ã€ç•°ãªã‚‹æ—¥ä»˜ç¯„å›²ã‚’é¸æŠã—ã¦ãã ã•ã„"},
        event:{attending:"å‚åŠ ",interested:"èˆˆå‘³ã‚ã‚Š",viewDetails:"è©³ç´°ã‚’è¦‹ã‚‹",shareEvent:"ã‚¤ãƒ™ãƒ³ãƒˆã‚’ã‚·ã‚§ã‚¢",addToCalendar:"ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«è¿½åŠ ",free:"ç„¡æ–™",ticketPrice:"æ–™é‡‘",ageLimit:"å¹´é½¢åˆ¶é™",website:"ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆ",phone:"é›»è©±",description:"ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°"},
        stats:{totalEvents:"ç·ã‚¤ãƒ™ãƒ³ãƒˆæ•°",totalVenues:"ç·ä¼šå ´æ•°",totalCities:"å¯¾å¿œéƒ½å¸‚",thisWeekEvents:"ä»Šé€±ã®ã‚¤ãƒ™ãƒ³ãƒˆ"},
        status:{searching:"ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ¤œç´¢ä¸­...",translating:"ç¿»è¨³ä¸­...",loading:"èª­ã¿è¾¼ã¿ä¸­...",loadingMore:"è¿½åŠ èª­ã¿è¾¼ã¿ä¸­..."},
        error:{searchFailed:"æ¤œç´¢ã«å¤±æ•—ã—ã¾ã—ãŸã€‚å¾Œã§ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„",translationFailed:"ç¿»è¨³ã‚µãƒ¼ãƒ“ã‚¹ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“",networkError:"ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚¨ãƒ©ãƒ¼",loadFailed:"èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ"}
      }
    };

    // èªè¨€åˆ—è¡¨
    const languages = [
      { code:"zh-TW", name:"Traditional Chinese", native:"ç¹é«”ä¸­æ–‡", flag:"ğŸ‡¹ğŸ‡¼" },
      { code:"en", name:"English", native:"English", flag:"ğŸ‡ºğŸ‡¸" },
      { code:"ja", name:"Japanese", native:"æ—¥æœ¬èª", flag:"ğŸ‡¯ğŸ‡µ" }
    ];

    // å ´æ‰€é¡å‹
    const venueTypes = [
      { value:"all", icon:"ğŸ¢" },
      { value:"bar", icon:"ğŸ»" },
      { value:"restaurant", icon:"ğŸ½ï¸" },
      { value:"cafe", icon:"â˜•" },
      { value:"hotspring", icon:"â™¨ï¸" },
      { value:"other", icon:"ğŸª" }
    ];

    // æ¨¡æ“¬è³‡æ–™
    const mockCities = ["å°åŒ—å¸‚","å°ä¸­å¸‚","é«˜é›„å¸‚","å°å—å¸‚","æ–°åŒ—å¸‚","å®œè˜­ç¸£"];
    const mockStats = { total_events:156, total_venues:89, total_cities:6, this_week_events:24 };
    const mockEvents = [
      { id:1, name:"é€±äº”å¤œçˆµå£«éŸ³æ¨‚æœƒ", description:"çŸ¥åçˆµå£«æ¨‚åœ˜ç¾å ´æ¼”å‡ºï¼Œäº«å—ç¾é…’èˆ‡éŸ³æ¨‚çš„å®Œç¾çµåˆã€‚åœ¨å„ªé›…çš„ç’°å¢ƒä¸­è†è½ç¶“å…¸çˆµå£«æ›²ç›®ã€‚", venue_name:"Blue Note çˆµå£«é…’å§", city:"å°åŒ—å¸‚", venue_type:"bar", date:"2025-08-15", time:"20:00", attending:156, interested:324, image:"https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=800&h=480&fit=crop", ticket_price:800 },
      { id:2, name:"æ¸¯å¼é»å¿ƒè£½ä½œèª²ç¨‹", description:"å­¸ç¿’æ­£å®—æ¸¯å¼é»å¿ƒè£½ä½œæŠ€å·§ï¼Œç”±å°ˆæ¥­å¸«å‚…è¦ªè‡ªæŒ‡å°ï¼Œå“åšç¾å‘³æˆæœã€‚", venue_name:"å¤©é¦™æ¨“", city:"å°åŒ—å¸‚", venue_type:"restaurant", date:"2025-08-16", time:"14:00", attending:32, interested:78, image:"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=800&h=480&fit=crop", ticket_price:1500 },
      { id:3, name:"å’–å•¡æ‹‰èŠ±è—è¡“èª²ç¨‹", description:"å­¸ç¿’å°ˆæ¥­å’–å•¡æ‹‰èŠ±æŠ€å·§ï¼Œå‰µä½œå±¬æ–¼è‡ªå·±çš„å’–å•¡è—è¡“ä½œå“ã€‚", venue_name:"è—å±±å’–å•¡", city:"å°åŒ—å¸‚", venue_type:"cafe", date:"2025-08-17", time:"10:00", attending:25, interested:56, image:"https://images.unsplash.com/photo-1501339847302-ac426a4a7cbb?w=800&h=480&fit=crop", ticket_price:800 },
      { id:4, name:"æº«æ³‰é¤Šç”Ÿä¹‹æ—…", description:"ä¸€æ—¥æº«æ³‰é«”é©—ï¼ŒåŒ…å«æ³¡æ¹¯ã€æŒ‰æ‘©ã€é¤Šç”Ÿé¤é»ï¼Œè®“èº«å¿ƒå®Œå…¨æ”¾é¬†ã€‚", venue_name:"çƒä¾†æº«æ³‰æœƒé¤¨", city:"æ–°åŒ—å¸‚", venue_type:"hotspring", date:"2025-08-18", time:"09:00", attending:45, interested:87, image:"https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=800&h=480&fit=crop", ticket_price:2500 },
      { id:5, name:"ç•¶ä»£è—è¡“å±•è¦½", description:"å±•å‡ºæœ¬åœŸè—è¡“å®¶æœ€æ–°ä½œå“ï¼Œæ¢ç´¢ç•¶ä»£è—è¡“ä¹‹ç¾ï¼Œæ„Ÿå—å‰µä½œçš„åŠ›é‡ã€‚", venue_name:"æ–‡åŒ–å±•æ¼”ä¸­å¿ƒ", city:"å°åŒ—å¸‚", venue_type:"other", date:"2025-08-19", time:"10:00", attending:234, interested:456, image:"https://images.unsplash.com/photo-1492684223066-81342ee5ff30?w=800&h=480&fit=crop", ticket_price:300 },
      { id:6, name:"é›»éŸ³ç‹‚æ­¡ç¯€", description:"é ‚å°–DJå¸¶ä¾†éœ‡æ’¼é›»éŸ³é«”é©—ï¼Œå¤œæ™šç‹‚æ­¡ä¸åœæ­‡ï¼Œæ„Ÿå—éŸ³æ¨‚çš„éœ‡æ’¼åŠ›ã€‚", venue_name:"Neon Nights", city:"å°ä¸­å¸‚", venue_type:"bar", date:"2025-08-20", time:"21:00", attending:423, interested:892, image:"https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=800&h=480&fit=crop", ticket_price:1000 }
    ];

    // ====== ç‹€æ…‹ ======
    let state = {
      lang: "zh-TW",
      showLangMenu: false,
      filters: { city:"", venueType:"", startDate:"", endDate:"", keyword:"" },
      events: [...mockEvents],
      page: 1,
      hasMore: true,
      isSearching: false
    };

    // ====== å°å·¥å…· ======
    const $ = (sel) => document.querySelector(sel);
    const t = (path) => {
      const dict = translations[state.lang] || translations["zh-TW"];
      return path.split(".").reduce((acc,key)=>acc?.[key], dict) ?? path;
    };
    const setText = (sel, txt) => { const el = $(sel); if (el) el.textContent = txt; };

    // èªè¨€åµæ¸¬
    (function detectLang(){
      const saved = localStorage.getItem("preferred-language");
      if (saved && translations[saved]) { state.lang = saved; return; }
      const nav = navigator.language || "zh-TW";
      const langKey = ["zh-TW","en","ja"].find(code => code === nav || code.split("-")[0] === nav.split("-")[0]) || "zh-TW";
      state.lang = langKey;
    })();

    // ====== åˆå§‹åŒ– UI ======
    function initUI(){
      // æ¨™é¡Œ/å­—å¹•
      setText("#nav-title", t("app.title"));
      setText("#app-title", t("app.title"));
      setText("#app-subtitle", t("app.subtitle"));

      // çµ±è¨ˆ
      $("#stat-events").textContent =  mockStats.total_events;
      $("#stat-venues").textContent =  mockStats.total_venues;
      $("#stat-cities").textContent =  mockStats.total_cities;
      $("#stat-thisweek").textContent = mockStats.this_week_events;
      setText("#stat-events-label", t("stats.totalEvents"));
      setText("#stat-venues-label", t("stats.totalVenues"));
      setText("#stat-cities-label", t("stats.totalCities"));
      setText("#stat-thisweek-label", t("stats.thisWeekEvents"));

      // Tabsï¼ˆåƒ…å±•ç¤ºï¼‰
      const tabs = ["home","events","venues","about"];
      const tabsBox = $("#tabs"); tabsBox.innerHTML = "";
      tabs.forEach(tab=>{
        const b = document.createElement("button");
        b.className = "px-3 py-2 rounded-lg hover:bg-white/10 text-white/80 hover:text-white";
        b.textContent = t("navigation."+tab);
        tabsBox.appendChild(b);
      });

      // èªè¨€é¡¯ç¤º
      const langMeta = languages.find(l=>l.code===state.lang) || languages[0];
      $("#langFlag").textContent = langMeta.flag;
      $("#langNative").textContent = langMeta.native;

      // èªè¨€é¸å–®
      const menu = $("#langMenu"); menu.innerHTML = "";
      languages.forEach(l=>{
        const item = document.createElement("button");
        item.className = "w-full text-left px-4 py-2 hover:bg-gray-50 flex items-center gap-2";
        item.innerHTML = `<span>${l.flag}</span><div><div class="font-medium">${l.native}</div><div class="text-sm text-gray-500">${l.name}</div></div>`;
        item.onclick = ()=> changeLanguage(l.code);
        menu.appendChild(item);
      });

      // ç¯©é¸ labels
      setText("#lbl-city", t("filter.city"));
      setText("#lbl-venueType", t("filter.venueType"));
      setText("#lbl-startDate", t("filter.startDate"));
      setText("#lbl-endDate", t("filter.endDate"));
      setText("#lbl-keyword", t("filter.keyword"));
      $("#f-key").placeholder = t("filter.keywordPlaceholder");

      // æŒ‰éˆ•
      setText("#txt-search", t("button.search"));
      setText("#txt-clear", t("button.clear"));
      setText("#lbl-results", t("result.searchResults"));
      setText("#txt-load", t("button.loadMore"));
      setText("#emptyTitle", t("result.noEvents"));
      setText("#emptyHint", t("result.tryDifferent"));
      setText("#m-desc-title", t("event.description"));
      $("#m-share").textContent = t("event.shareEvent");
      $("#m-close2").textContent = t("button.close");

      // åŸå¸‚
      const fcity = $("#f-city");
      fcity.innerHTML = `<option value="">${t("filter.allCities")}</option>`;
      mockCities.forEach(c=>{
        const op = document.createElement("option");
        op.value = c; op.textContent = c;
        fcity.appendChild(op);
      });

      // é¡å‹ select
      const ftype = $("#f-type"); ftype.innerHTML = "";
      venueTypes.forEach(v=>{
        const op = document.createElement("option");
        op.value = (v.value==="all" ? "" : v.value);
        op.textContent = `${t("venueTypes."+v.value)}`;
        ftype.appendChild(op);
      });

      // å¿«é€Ÿ chips
      const chips = $("#typeChips"); chips.innerHTML = "";
      venueTypes.forEach(v=>{
        const btn = document.createElement("button");
        btn.className = "px-4 py-2 rounded-full bg-white/20 hover:bg-white/30";
        btn.textContent = `${v.icon} ${t("venueTypes."+v.value)}`;
        btn.onclick = () => {
          state.filters.venueType = (v.value==="all" ? "" : v.value);
          $("#f-type").value = state.filters.venueType;
          doSearch(false);
        };
        chips.appendChild(btn);
      });

      // èªç³»æ–¹å‘
      document.documentElement.lang = state.lang;
      const isRTL = (state.lang === "ar"); // è‹¥æœªä¾†åŠ å…¥é˜¿æ‹‰ä¼¯æ–‡
      document.body.classList.toggle("rtl", isRTL);

      // é¦–æ¬¡æ¸²æŸ“
      renderEvents();
      updateCount();
    }

    // ====== èªè¨€åˆ‡æ› ======
    function changeLanguage(code){
      if (!translations[code]) return;
      state.lang = code;
      localStorage.setItem("preferred-language", code);
      $("#langMenu").classList.add("hidden");
      initUI(); // é‡æ–°æ¸²æŸ“æ‰€æœ‰å­—ä¸²
    }

    // ====== æœå°‹é‚è¼¯ ======
    function filterEvents(all, f){
      let arr = all.slice();
      if (f.city)     arr = arr.filter(e => e.city === f.city);
      if (f.venueType)arr = arr.filter(e => e.venue_type === f.venueType);
      if (f.startDate)arr = arr.filter(e => e.date >= f.startDate);
      if (f.endDate)  arr = arr.filter(e => e.date <= f.endDate);
      if (f.keyword) {
        const kw = f.keyword.toLowerCase();
        arr = arr.filter(e =>
          e.name.toLowerCase().includes(kw) ||
          e.description.toLowerCase().includes(kw) ||
          e.venue_name.toLowerCase().includes(kw)
        );
      }
      return arr;
    }

    function doSearch(append){
      $("#errorBox").classList.add("hidden");
      state.isSearching = true;
      $("#btn-search").disabled = true;
      $("#btn-search").innerHTML = `<span class="spin inline-block border-2 border-white border-t-transparent rounded-full w-4 h-4"></span> ${t("status.searching")}`;

      // æ¨¡æ“¬ API å»¶é²
      setTimeout(()=>{
        const result = filterEvents(mockEvents, state.filters);
        if (append) {
          state.events = [...state.events, ...result];
        } else {
          state.events = result;
        }
        state.hasMore = result.length > 6;
        renderEvents();
        updateCount();

        $("#btn-search").disabled = false;
        $("#btn-search").textContent = t("button.search");
        state.isSearching = false;
      }, 600);
    }

    function clearFilters(){
      state.filters = { city:"", venueType:"", startDate:"", endDate:"", keyword:"" };
      $("#f-city").value = "";
      $("#f-type").value = "";
      $("#f-start").value = "";
      $("#f-end").value = "";
      $("#f-key").value = "";
      state.events = [...mockEvents];
      state.hasMore = true;
      renderEvents();
      updateCount();
    }

    function renderEvents(){
      const box = $("#cards"); box.innerHTML = "";
      const list = state.events;
      if (!list.length){
        $("#emptyBox").classList.remove("hidden");
      } else {
        $("#emptyBox").classList.add("hidden");
      }

      list.forEach(ev=>{
        const card = document.createElement("div");
        card.className = "glass rounded-2xl overflow-hidden hover:bg-white/20 transition";
        card.innerHTML = `
          <div class="relative">
            <img src="${ev.image}" alt="${ev.name}" class="w-full h-48 object-cover">
            <div class="absolute top-4 left-4 bg-indigo-500 rounded-full px-3 py-1 text-white text-sm font-semibold">${getVenueLabel(ev.venue_type)}</div>
            <div class="absolute bottom-4 left-4 bg-green-500/90 rounded-full px-3 py-1 text-white text-sm font-semibold">
              ${ev.ticket_price === 0 ? t("event.free") : "NT$"+ev.ticket_price}
            </div>
          </div>
          <div class="p-5">
            <h4 class="text-xl font-bold mb-2">${ev.name}</h4>
            <p class="text-white/80 mb-4 h-12 overflow-hidden">${ev.description}</p>
            <div class="space-y-2 mb-4 text-white/80">
              <div>ğŸ“ ${ev.venue_name}, ${ev.city}</div>
              <div>ğŸ“… ${ev.date}</div>
              <div>â° ${ev.time}</div>
            </div>
            <div class="flex items-center justify-between mb-4 text-sm text-white/80">
              <div>ğŸ‘¥ ${ev.attending} ${t("event.attending")}</div>
              <div>â­ ${ev.interested} ${t("event.interested")}</div>
            </div>
            <div class="flex gap-2">
              <button class="flex-1 bg-gradient-to-r from-pink-500 to-red-500 px-4 py-2 rounded-lg font-semibold hover:from-pink-600 hover:to-red-600 text-sm" data-action="detail" data-id="${ev.id}">
                ${t("event.viewDetails")}
              </button>
              <button class="px-3 py-2 bg-white/20 rounded-lg hover:bg-white/30 text-sm" data-action="share" data-id="${ev.id}">ğŸ”—</button>
            </div>
          </div>
        `;
        box.appendChild(card);
      });

      // ç¶å®šå¡ç‰‡å…§æŒ‰éˆ•äº‹ä»¶
      box.querySelectorAll("button[data-action='detail']").forEach(b=>{
        b.onclick = ()=> openModal(parseInt(b.dataset.id,10));
      });
      box.querySelectorAll("button[data-action='share']").forEach(b=>{
        b.onclick = ()=> shareEvent(parseInt(b.dataset.id,10));
      });

      // è¼‰å…¥æ›´å¤š
      const loadBtn = $("#btn-load");
      if (state.hasMore && state.events.length > 0){
        loadBtn.classList.remove("hidden");
        loadBtn.onclick = ()=> doSearch(true);
      } else {
        loadBtn.classList.add("hidden");
      }
    }

    function getVenueLabel(v){
      switch(v){
        case "bar": return t("venueTypes.bar");
        case "restaurant": return t("venueTypes.restaurant");
        case "cafe": return t("venueTypes.cafe");
        case "hotspring": return t("venueTypes.hotspring");
        case "other": return t("venueTypes.other");
        default: return t("venueTypes.all");
      }
    }

    function updateCount(){
      $("#countBox").textContent = `${state.events.length} ${t("result.foundEvents")}`;
    }

    // ====== Modal ======
    function openModal(id){
      const ev = state.events.find(e=>e.id===id) || mockEvents.find(e=>e.id===id);
      if (!ev) return;
      $("#m-img").src = ev.image;
      $("#m-title").textContent = ev.name;
      $("#m-type").textContent = getVenueLabel(ev.venue_type);
      $("#m-venue").textContent = ev.venue_name;
      $("#m-city").textContent = ev.city;
      $("#m-date").textContent = ev.date;
      $("#m-time").textContent = ev.time;
      $("#m-att").textContent = `${ev.attending} ${t("event.attending")}`;
      $("#m-int").textContent = `${ev.interested} ${t("event.interested")}`;
      $("#m-price").textContent = ev.ticket_price===0 ? t("event.free") : "NT$"+ev.ticket_price;
      $("#m-desc").textContent = ev.description;

      $("#modal").classList.remove("hidden");
      $("#modal").classList.add("flex");
      $("#m-share").onclick = ()=> shareEvent(id);
    }

    function closeModal(){
      $("#modal").classList.add("hidden");
      $("#modal").classList.remove("flex");
    }

    function shareEvent(id){
      const ev = state.events.find(e=>e.id===id) || mockEvents.find(e=>e.id===id);
      if (!ev) return;
      const url = location.href;
      if (navigator.share){
        navigator.share({ title: ev.name, text: ev.description, url }).catch(()=>{});
      } else {
        navigator.clipboard.writeText(`${ev.name} - ${url}`);
        alert("æ´»å‹•é€£çµå·²è¤‡è£½åˆ°å‰ªè²¼ç°¿");
      }
    }

    // ====== äº‹ä»¶ç¶å®š ======
    $("#langBtn").onclick = ()=> $("#langMenu").classList.toggle("hidden");
    document.addEventListener("click", (e)=>{
      if (!$("#langBtn").contains(e.target) && !$("#langMenu").contains(e.target)){
        $("#langMenu").classList.add("hidden");
      }
    });

    $("#f-city").onchange = (e)=>{ state.filters.city = e.target.value; };
    $("#f-type").onchange = (e)=>{ state.filters.venueType = e.target.value; };
    $("#f-start").onchange = (e)=>{ state.filters.startDate = e.target.value; };
    $("#f-end").onchange = (e)=>{ state.filters.endDate = e.target.value; };
    $("#f-key").addEventListener("keypress", (e)=>{ if (e.key==="Enter") doSearch(false); });

    $("#btn-search").onclick = ()=> doSearch(false);
    $("#btn-clear").onclick = ()=> clearFilters();

    $("#m-close").onclick = closeModal;
    $("#m-close2").onclick = closeModal;
    $("#modal").addEventListener("click", (e)=>{ if (e.target.id === "modal") closeModal(); });

    // é¦–æ¬¡è¼‰å…¥
    initUI();
  </script>
</body>
</html>
