import React, { useState, useEffect, useCallback } from 'react';
import { Search, Calendar, MapPin, Users, Clock, Filter, Globe, Star, Share2, ExternalLink, Phone, Globe2, TrendingUp, Activity, Map } from 'lucide-react';

// 完整翻譯檔案
const translations = {
  'zh-TW': {
    app: {
      title: '休閒活動搜尋',
      subtitle: '探索城市中最精彩的休閒娛樂活動'
    },
    navigation: {
      home: '首頁',
      events: '活動',
      venues: '場所',
      about: '關於'
    },
    filter: {
      city: '城市',
      allCities: '所有城市',
      venueType: '場所類型',
      allVenues: '所有場所',
      startDate: '開始日期',
      endDate: '結束日期',
      keyword: '關鍵字',
      keywordPlaceholder: '搜尋活動名稱或描述...'
    },
    venueTypes: {
      all: '所有場所',
      bar: '酒吧',
      restaurant: '餐廳',
      cafe: '咖啡廳',
      hotspring: '溫泉',
      other: '其他'
    },
    button: {
      search: '搜尋活動',
      clear: '清除',
      viewMore: '查看更多',
      loadMore: '載入更多',
      close: '關閉'
    },
    result: {
      searchResults: '搜尋結果',
      foundEvents: '個活動',
      noEvents: '找不到活動',
      tryDifferent: '請嘗試調整搜尋條件或選擇不同的日期範圍'
    },
    event: {
      attending: '參加',
      interested: '感興趣',
      viewDetails: '查看詳情',
      shareEvent: '分享活動',
      addToCalendar: '加入行事曆',
      free: '免費',
      ticketPrice: '票價',
      ageLimit: '年齡限制',
      website: '官網',
      phone: '電話',
      description: '活動描述'
    },
    stats: {
      totalEvents: '總活動數',
      totalVenues: '總場所數',
      totalCities: '覆蓋城市',
      thisWeekEvents: '本週活動'
    },
    status: {
      searching: '搜尋活動中...',
      translating: '翻譯中...',
      loading: '載入中...',
      loadingMore: '載入更多中...'
    },
    error: {
      searchFailed: '搜尋失敗，請稍後再試',
      translationFailed: '翻譯服務暫時無法使用',
      networkError: '網路連線錯誤',
      loadFailed: '載入失敗'
    }
  },
  'en': {
    app: {
      title: 'Leisure Events Search',
      subtitle: 'Discover the most exciting leisure and entertainment events in the city'
    },
    navigation: {
      home: 'Home',
      events: 'Events',
      venues: 'Venues',
      about: 'About'
    },
    filter: {
      city: 'City',
      allCities: 'All Cities',
      venueType: 'Venue Type',
      allVenues: 'All Venues',
      startDate: 'Start Date',
      endDate: 'End Date',
      keyword: 'Keyword',
      keywordPlaceholder: 'Search event names or descriptions...'
    },
    venueTypes: {
      all: 'All Venues',
      bar: 'Bars',
      restaurant: 'Restaurants',
      cafe: 'Cafes',
      hotspring: 'Hot Springs',
      other: 'Others'
    },
    button: {
      search: 'Search Events',
      clear: 'Clear',
      viewMore: 'View More',
      loadMore: 'Load More',
      close: 'Close'
    },
    result: {
      searchResults: 'Search Results',
      foundEvents: 'events found',
      noEvents: 'No events found',
      tryDifferent: 'Try adjusting search criteria or selecting different date range'
    },
    event: {
      attending: 'Attending',
      interested: 'Interested',
      viewDetails: 'View Details',
      shareEvent: 'Share Event',
      addToCalendar: 'Add to Calendar',
      free: 'Free',
      ticketPrice: 'Price',
      ageLimit: 'Age Limit',
      website: 'Website',
      phone: 'Phone',
      description: 'Event Description'
    },
    stats: {
      totalEvents: 'Total Events',
      totalVenues: 'Total Venues',
      totalCities: 'Cities Covered',
      thisWeekEvents: 'This Week'
    },
    status: {
      searching: 'Searching events...',
      translating: 'Translating...',
      loading: 'Loading...',
      loadingMore: 'Loading more...'
    },
    error: {
      searchFailed: 'Search failed, please try again later',
      translationFailed: 'Translation service unavailable',
      networkError: 'Network connection error',
      loadFailed: 'Load failed'
    }
  },
  'ja': {
    app: {
      title: 'レジャーイベント検索',
      subtitle: '街で最も刺激的なレジャー・エンターテイメントイベントを発見しよう'
    },
    navigation: {
      home: 'ホーム',
      events: 'イベント',
      venues: '会場',
      about: 'について'
    },
    filter: {
      city: '都市',
      allCities: 'すべての都市',
      venueType: '会場タイプ',
      allVenues: 'すべての会場',
      startDate: '開始日',
      endDate: '終了日',
      keyword: 'キーワード',
      keywordPlaceholder: 'イベント名や説明を検索...'
    },
    venueTypes: {
      all: 'すべての会場',
      bar: 'バー',
      restaurant: 'レストラン',
      cafe: 'カフェ',
      hotspring: '温泉',
      other: 'その他'
    },
    button: {
      search: 'イベント検索',
      clear: 'クリア',
      viewMore: '詳細を見る',
      loadMore: 'もっと読み込む',
      close: '閉じる'
    },
    result: {
      searchResults: '検索結果',
      foundEvents: 'イベントが見つかりました',
      noEvents: 'イベントが見つかりません',
      tryDifferent: '検索条件を調整するか、異なる日付範囲を選択してください'
    },
    event: {
      attending: '参加',
      interested: '興味あり',
      viewDetails: '詳細を見る',
      shareEvent: 'イベントをシェア',
      addToCalendar: 'カレンダーに追加',
      free: '無料',
      ticketPrice: '料金',
      ageLimit: '年齢制限',
      website: 'ウェブサイト',
      phone: '電話',
      description: 'イベント詳細'
    },
    stats: {
      totalEvents: '総イベント数',
      totalVenues: '総会場数',
      totalCities: '対応都市',
      thisWeekEvents: '今週のイベント'
    },
    status: {
      searching: 'イベントを検索中...',
      translating: '翻訳中...',
      loading: '読み込み中...',
      loadingMore: '追加読み込み中...'
    },
    error: {
      searchFailed: '検索に失敗しました。後でもう一度お試しください',
      translationFailed: '翻訳サービスが利用できません',
      networkError: 'ネットワーク接続エラー',
      loadFailed: '読み込みに失敗しました'
    }
  }
};

// 語言列表
const languages = [
  { code: 'zh-TW', name: 'Traditional Chinese', native: '繁體中文', flag: '🇹🇼' },
  { code: 'zh-CN', name: 'Simplified Chinese', native: '简体中文', flag: '🇨🇳' },
  { code: 'en', name: 'English', native: 'English', flag: '🇺🇸' },
  { code: 'ja', name: 'Japanese', native: '日本語', flag: '🇯🇵' },
  { code: 'ko', name: 'Korean', native: '한국어', flag: '🇰🇷' },
  { code: 'es', name: 'Spanish', native: 'Español', flag: '🇪🇸' },
  { code: 'fr', name: 'French', native: 'Français', flag: '🇫🇷' },
  { code: 'de', name: 'German', native: 'Deutsch', flag: '🇩🇪' },
  { code: 'ar', name: 'Arabic', native: 'العربية', flag: '🇸🇦', rtl: true },
  { code: 'th', name: 'Thai', native: 'ไทย', flag: '🇹🇭' },
  { code: 'vi', name: 'Vietnamese', native: 'Tiếng Việt', flag: '🇻🇳' }
];

// 場所類型列表
const venueTypes = [
  { value: 'all', icon: '🏢', color: 'bg-gray-500', gradientFrom: 'from-gray-500', gradientTo: 'to-gray-600' },
  { value: 'bar', icon: '🍻', color: 'bg-purple-500', gradientFrom: 'from-purple-500', gradientTo: 'to-purple-600' },
  { value: 'restaurant', icon: '🍽️', color: 'bg-orange-500', gradientFrom: 'from-orange-500', gradientTo: 'to-orange-600' },
  { value: 'cafe', icon: '☕', color: 'bg-yellow-600', gradientFrom: 'from-yellow-500', gradientTo: 'to-yellow-600' },
  { value: 'hotspring', icon: '♨️', color: 'bg-blue-500', gradientFrom: 'from-blue-500', gradientTo: 'to-blue-600' },
  { value: 'other', icon: '🎪', color: 'bg-green-500', gradientFrom: 'from-green-500', gradientTo: 'to-green-600' }
];

// 模擬 API 數據
const mockCities = ['台北市', '台中市', '高雄市', '台南市', '新北市', '宜蘭縣'];

const mockStats = {
  total_events: 156,
  total_venues: 89,
  total_cities: 6,
  this_week_events: 24
};

const mockEvents = [
  {
    id: 1,
    name: '週五夜爵士音樂會',
    description: '知名爵士樂團現場演出，享受美酒與音樂的完美結合。在優雅的環境中聆聽經典爵士曲目。',
    venue_name: 'Blue Note 爵士酒吧',
    city: '台北市',
    venue_type: 'bar',
    date: '2025-08-15',
    time: '20:00',
    attending: 156,
    interested: 324,
    image: 'https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=400&h=250&fit=crop',
    ticket_price: 800
  },
  {
    id: 2,
    name: '港式點心製作課程',
    description: '學習正宗港式點心製作技巧，由專業師傅親自指導，品嚐美味成果。',
    venue_name: '天香樓',
    city: '台北市',
    venue_type: 'restaurant',
    date: '2025-08-16',
    time: '14:00',
    attending: 32,
    interested: 78,
    image: 'https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400&h=250&fit=crop',
    ticket_price: 1500
  },
  {
    id: 3,
    name: '咖啡拉花藝術課程',
    description: '學習專業咖啡拉花技巧，創作屬於自己的咖啡藝術作品。',
    venue_name: '藍山咖啡',
    city: '台北市',
    venue_type: 'cafe',
    date: '2025-08-17',
    time: '10:00',
    attending: 25,
    interested: 56,
    image: 'https://images.unsplash.com/photo-1501339847302-ac426a4a7cbb?w=400&h=250&fit=crop',
    ticket_price: 800
  },
  {
    id: 4,
    name: '溫泉養生之旅',
    description: '一日溫泉體驗，包含泡湯、按摩、養生餐點，讓身心完全放鬆。',
    venue_name: '烏來溫泉會館',
    city: '新北市',
    venue_type: 'hotspring',
    date: '2025-08-18',
    time: '09:00',
    attending: 45,
    interested: 87,
    image: 'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=400&h=250&fit=crop',
    ticket_price: 2500
  },
  {
    id: 5,
    name: '當代藝術展覽',
    description: '展出本土藝術家最新作品，探索當代藝術之美，感受創作的力量。',
    venue_name: '文化展演中心',
    city: '台北市',
    venue_type: 'other',
    date: '2025-08-19',
    time: '10:00',
    attending: 234,
    interested: 456,
    image: 'https://images.unsplash.com/photo-1492684223066-81342ee5ff30?w=400&h=250&fit=crop',
    ticket_price: 300
  },
  {
    id: 6,
    name: '電音狂歡節',
    description: '頂尖DJ帶來震撼電音體驗，夜晚狂歡不停歇，感受音樂的震撼力。',
    venue_name: 'Neon Nights',
    city: '台中市',
    venue_type: 'bar',
    date: '2025-08-20',
    time: '21:00',
    attending: 423,
    interested: 892,
    image: 'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=400&h=250&fit=crop',
    ticket_price: 1000
  }
];

// API 基礎 URL
const API_BASE_URL = '/api';

export default function LeisureEventsSearchApp() {
  // 狀態管理
  const [currentLang, setCurrentLang] = useState('zh-TW');
  const [showLangMenu, setShowLangMenu] = useState(false);
  const [searchFilters, setSearchFilters] = useState({
    city: '',
    venueType: '',
    startDate: '',
    endDate: '',
    keyword: ''
  });
  
  const [events, setEvents] = useState(mockEvents);
  const [cities, setCities] = useState(mockCities);
  const [isSearching, setIsSearching] = useState(false);
  const [isLoadingMore, setIsLoadingMore] = useState(false);
  const [activeTab, setActiveTab] = useState('events');
  const [selectedEvent, setSelectedEvent] = useState(null);
  const [error, setError] = useState('');
  const [hasMore, setHasMore] = useState(true);
  const [page, setPage] = useState(1);
  const [stats, setStats] = useState(mockStats);

  // 取得翻譯文字
  const t = useCallback((path) => {
    const keys = path.split('.');
    let value = translations[currentLang];
    for (const key of keys) {
      value = value?.[key];
    }
    return value || path;
  }, [currentLang]);

  // 語言偵測與設定
  useEffect(() => {
    const detectLanguage = () => {
      const browserLang = navigator.language;
      const supportedLang = languages.find(lang => 
        lang.code === browserLang || lang.code.split('-')[0] === browserLang.split('-')[0]
      );
      return supportedLang ? supportedLang.code : 'zh-TW';
    };
    
    const savedLang = localStorage.getItem('preferred-language') || detectLanguage();
    setCurrentLang(savedLang);
  }, []);

  // 模擬 API 調用
  const fetchEvents = async (filters = searchFilters, pageNum = 1, append = false) => {
    try {
      if (!append) {
        setIsSearching(true);
        setError('');
      } else {
        setIsLoadingMore(true);
      }

      // 模擬 API 延遲
      await new Promise(resolve => setTimeout(resolve, 1000));

      let filteredEvents = mockEvents;

      // 篩選邏輯
      if (filters.city) {
        filteredEvents = filteredEvents.filter(event => event.city === filters.city);
      }
      
      if (filters.venueType) {
        filteredEvents = filteredEvents.filter(event => event.venue_type === filters.venueType);
      }
      
      if (filters.keyword) {
        const keyword = filters.keyword.toLowerCase();
        filteredEvents = filteredEvents.filter(event => 
          event.name.toLowerCase().includes(keyword) ||
          event.description.toLowerCase().includes(keyword) ||
          event.venue_name.toLowerCase().includes(keyword)
        );
      }

      if (append) {
        setEvents(prev => [...prev, ...filteredEvents]);
      } else {
        setEvents(filteredEvents);
      }
      
      setHasMore(filteredEvents.length > 6);
      setPage(pageNum);

    } catch (err) {
      console.error('搜尋失敗:', err);
      setError(t('error.networkError'));
    } finally {
      setIsSearching(false);
      setIsLoadingMore(false);
    }
  };

  // 切換語言
  const changeLanguage = (langCode) => {
    setCurrentLang(langCode);
    localStorage.setItem('preferred-language', langCode);
    setShowLangMenu(false);
  };

  // 搜尋活動
  const handleSearch = () => {
    fetchEvents(searchFilters, 1, false);
  };

  // 載入更多
  const handleLoadMore = () => {
    fetchEvents(searchFilters, page + 1, true);
  };

  // 清除篩選
  const clearFilters = () => {
    const emptyFilters = {
      city: '',
      venueType: '',
      startDate: '',
      endDate: '',
      keyword: ''
    };
    setSearchFilters(emptyFilters);
    setEvents(mockEvents);
  };

  // 分享活動
  const handleShare = async (event) => {
    if (navigator.share) {
      try {
        await navigator.share({
          title: event.name,
          text: event.description,
          url: window.location.href
        });
      } catch (err) {
        console.log('分享取消');
      }
    } else {
      navigator.clipboard.writeText(`${event.name} - ${window.location.href}`);
      alert('活動連結已複製到剪貼簿');
    }
  };

  // 取得當前語言設定
  const currentLangConfig = languages.find(lang => lang.code === currentLang);
  const isRTL = currentLangConfig?.rtl || false;

  return (
    <div className={`min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 ${isRTL ? 'rtl' : 'ltr'}`}>
      {/* 導航列 */}
      <nav className="bg-black/30 backdrop-blur-md border-b border-white/10 sticky top-0 z-50">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center justify-between">
            <div className="flex items-center space-x-4">
              <div className="text-2xl font-bold text-white">🎪</div>
              <h1 className="text-xl font-bold text-white">{t('app.title')}</h1>
            </div>
            
            <div className="hidden md:flex items-center space-x-6">
              {['home', 'events', 'venues', 'about'].map(tab => (
                <button
                  key={tab}
                  onClick={() => setActiveTab(tab)}
                  className={`px-3 py-2 rounded-lg transition-all ${
                    activeTab === tab 
                      ? 'bg-white/20 text-white' 
                      : 'text-white/70 hover:text-white hover:bg-white/10'
                  }`}
                >
                  {t(`navigation.${tab}`)}
                </button>
              ))}
            </div>
            
            {/* 語言選擇器 */}
            <div className="relative">
              <button
                onClick={() => setShowLangMenu(!showLangMenu)}
                className="flex items-center space-x-2 px-3 py-2 bg-white/20 rounded-lg text-white hover:bg-white/30 transition-all"
              >
                <Globe size={16} />
                <span>{currentLangConfig?.flag}</span>
                <span className="hidden sm:inline">{currentLangConfig?.native}</span>
              </button>
              
              {showLangMenu && (
                <div className="absolute right-0 top-full mt-2 bg-white rounded-lg shadow-xl border border-gray-200 min-w-48 max-h-64 overflow-y-auto z-50">
                  {languages.map(lang => (
                    <button
                      key={lang.code}
                      onClick={() => changeLanguage(lang.code)}
                      className={`w-full px-4 py-2 text-left hover:bg-gray-50 flex items-center space-x-3 ${
                        currentLang === lang.code ? 'bg-blue-50 text-blue-600' : 'text-gray-700'
                      }`}
                    >
                      <span className="text-lg">{lang.flag}</span>
                      <div>
                        <div className="font-medium">{lang.native}</div>
                        <div className="text-sm text-gray-500">{lang.name}</div>
                      </div>
                    </button>
                  ))}
                </div>
              )}
            </div>
          </div>
        </div>
      </nav>

      {/* 主要內容 */}
      <main className="container mx-auto px-4 py-8">
        {/* 錯誤訊息 */}
        {error && (
          <div className="bg-red-500/20 border border-red-500/30 rounded-lg p-4 mb-6">
            <div className="text-red-100 font-medium">{error}</div>
          </div>
        )}

        {/* 標題區與統計 */}
        <div className="text-center mb-12">
          <h2 className="text-4xl md:text-6xl font-bold text-white mb-4">
            {t('app.title')}
          </h2>
          <p className="text-xl text-white/80 max-w-2xl mx-auto mb-8">
            {t('app.subtitle')}
          </p>
          
          {/* 統計卡片 */}
          <div className="grid grid-cols-2 md:grid-cols-4 gap-4 max-w-4xl mx-auto mb-8">
            <div className="bg-white/10 backdrop-blur-sm rounded-lg p-4 border border-white/20">
              <div className="flex items-center justify-center mb-2">
                <Activity className="w-6 h-6 text-blue-400 mr-2" />
              </div>
              <div className="text-2xl font-bold text-white">{stats.total_events}</div>
              <div className="text-white/70 text-sm">{t('stats.totalEvents')}</div>
            </div>
            <div className="bg-white/10 backdrop-blur-sm rounded-lg p-4 border border-white/20">
              <div className="flex items-center justify-center mb-2">
                <Map className="w-6 h-6 text-green-400 mr-2" />
              </div>
              <div className="text-2xl font-bold text-white">{stats.total_venues}</div>
              <div className="text-white/70 text-sm">{t('stats.totalVenues')}</div>
            </div>
            <div className="bg-white/10 backdrop-blur-sm rounded-lg p-4 border border-white/20">
              <div className="flex items-center justify-center mb-2">
                <Globe2 className="w-6 h-6 text-purple-400 mr-2" />
              </div>
              <div className="text-2xl font-bold text-white">{stats.total_cities}</div>
              <div className="text-white/70 text-sm">{t('stats.totalCities')}</div>
            </div>
            <div className="bg-white/10 backdrop-blur-sm rounded-lg p-4 border border-white/20">
              <div className="flex items-center justify-center mb-2">
                <TrendingUp className="w-6 h-6 text-orange-400 mr-2" />
              </div>
              <div className="text-2xl font-bold text-white">{stats.this_week_events}</div>
              <div className="text-white/70 text-sm">{t('stats.thisWeekEvents')}</div>
            </div>
          </div>
        </div>

        {/* 場所類型快速選擇 */}
        <div className="mb-8">
          <h3 className="text-xl font-semibold text-white mb-4 text-center">快速選擇場所類型</h3>
          <div className="flex flex-wrap justify-center gap-3">
            {venueTypes.map(type => (
              <button
                key={type.value}
                onClick={() => {
                  setSearchFilters({...searchFilters, venueType: type.value === 'all' ? '' : type.value});
                  const newFilters = {...searchFilters, venueType: type.value === 'all' ? '' : type.value};
                  fetchEvents(newFilters, 1, false);
                }}
                className={`flex items-center space-x-2 px-4 py-2 rounded-full text-white font-medium transition-all hover:scale-105 ${
                  searchFilters.venueType === (type.value === 'all' ? '' : type.value)
                    ? `bg-gradient-to-r ${type.gradientFrom} ${type.gradientTo} shadow-lg`
                    : 'bg-white/20 hover:bg-white/30'
                }`}
              >
                <span className="text-lg">{type.icon}</span>
                <span>{t(`venueTypes.${type.value}`)}</span>
              </button>
            ))}
          </div>
        </div>

        {/* 搜尋篩選器 */}
        <div className="bg-white/10 backdrop-blur-md rounded-2xl p-6 mb-8 border border-white/20">
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-6">
            {/* 城市選擇 */}
            <div>
              <label className="block text-sm font-medium text-white mb-2">
                {t('filter.city')}
              </label>
              <select
                value={searchFilters.city}
                onChange={(e) => setSearchFilters({...searchFilters, city: e.target.value})}
                className="w-full px-3 py-2 bg-white/20 border border-white/30 rounded-lg text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400"
              >
                <option value="" className="text-gray-900">{t('filter.allCities')}</option>
                {cities.map(city => (
                  <option key={city} value={city} className="text-gray-900">{city}</option>
                ))}
              </select>
            </div>

            {/* 場所類型選擇 */}
            <div>
              <label className="block text-sm font-medium text-white mb-2">
                {t('filter.venueType')}
              </label>
              <select
                value={searchFilters.venueType}
                onChange={(e) => setSearchFilters({...searchFilters, venueType: e.target.value})}
                className="w-full px-3 py-2 bg-white/20 border border-white/30 rounded-lg text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400"
              >
                {venueTypes.map(type => (
                  <option key={type.value} value={type.value === 'all' ? '' : type.value} className="text-gray-900">
                    {type.icon} {t(`venueTypes.${type.value}`)}
                  </option>
                ))}
              </select>
            </div>

            {/* 開始日期 */}
            <div>
              <label className="block text-sm font-medium text-white mb-2">
                {t('filter.startDate')}
              </label>
              <input
                type="date"
                value={searchFilters.startDate}
                onChange={(e) => setSearchFilters({...searchFilters, startDate: e.target.value})}
                className="w-full px-3 py-2 bg-white/20 border border-white/30 rounded-lg text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400"
              />
            </div>

            {/* 結束日期 */}
            <div>
              <label className="block text-sm font-medium text-white mb-2">
                {t('filter.endDate')}
              </label>
              <input
                type="date"
                value={searchFilters.endDate}
                onChange={(e) => setSearchFilters({...searchFilters, endDate: e.target.value})}
                className="w-full px-3 py-2 bg-white/20 border border-white/30 rounded-lg text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400"
              />
            </div>

            {/* 關鍵字搜尋 */}
            <div>
              <label className="block text-sm font-medium text-white mb-2">
                {t('filter.keyword')}
              </label>
              <input
                type="text"
                placeholder={t('filter.keywordPlaceholder')}
                value={searchFilters.keyword}
                onChange={(e) => setSearchFilters({...searchFilters, keyword: e.target.value})}
                onKeyPress={(e) => e.key === 'Enter' && handleSearch()}
                className="w-full px-3 py-2 bg-white/20 border border-white/30 rounded-lg text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400"
              />
            </div>
          </div>

          {/* 搜尋按鈕 */}
          <div className="flex flex-col sm:flex-row gap-4">
            <button
              onClick={handleSearch}
              disabled={isSearching}
              className="flex-1 bg-gradient-to-r from-blue-500 to-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-blue-600 hover:to-purple-700 transition-all flex items-center justify-center space-x-2 disabled:opacity-50"
            >
              {isSearching ? (
                <>
                  <div className="animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"></div>
                  <span>{t('status.searching')}</span>
                </>
              ) : (
                <>
                  <Search size={18} />
                  <span>{t('button.search')}</span>
                </>
              )}
            </button>
            
            <button
              onClick={clearFilters}
              className="px-6 py-3 bg-white/20 text-white rounded-lg font-semibold hover:bg-white/30 transition-all flex items-center justify-center space-x-2"
            >
              <Filter size={18} />
              <span>{t('button.clear')}</span>
            </button>
          </div>
        </div>

        {/* 搜尋結果 */}
        <div className="mb-6">
          <div className="flex items-center justify-between mb-6">
            <h3 className="text-2xl font-bold text-white">
              {t('result.searchResults')}
            </h3>
            <div className="text-white/70">
              {events.length} {t('result.foundEvents')}
            </div>
          </div>

          {events.length === 0 && !isSearching ? (
            <div className="text-center py-12">
              <div className="text-6xl mb-4">🔍</div>
              <h3 className="text-xl font-semibold text-white mb-2">{t('result.noEvents')}</h3>
              <p className="text-white/70">{t('result.tryDifferent')}</p>
            </div>
          ) : (
            <>
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {events.map(event => {
                  const venueTypeInfo = venueTypes.find(t => t.value === event.venue_type);
                  return (
                    <div key={event.id} className="bg-white/10 backdrop-blur-md rounded-2xl overflow-hidden border border-white/20 hover:bg-white/20 transition-all group hover:scale-105">
                      <div className="relative">
                        <img
                          src={event.image}
                          alt={event.name}
                          className="w-full h-48 object-cover group-hover:scale-110 transition-transform duration-300"
                        />
                        <div className="absolute top-4 right-4">
                          <div className="bg-black/50 backdrop-blur-sm rounded-full p-2">
                            <Star className="w-4 h-4 text-yellow-400 fill-current" />
                          </div>
                        </div>
                        <div className="absolute top-4 left-4">
                          <div className={`${venueTypeInfo?.color || 'bg-gray-500'} backdrop-blur-sm rounded-full px-3 py-1 text-white text-sm font-semibold flex items-center space-x-1`}>
                            <span>{venueTypeInfo?.icon}</span>
                            <span>{t(`venueTypes.${event.venue_type}`)}</span>
                          </div>
                        </div>
                        {event.ticket_price !== null && (
                          <div className="absolute bottom-4 left-4">
                            <div className="bg-green-500/90 backdrop-blur-sm rounded-full px-3 py-1 text-white text-sm font-semibold">
                              {event.ticket_price === 0 ? t('event.free') : `NT$${event.ticket_price}`}
                            </div>
                          </div>
                        )}
                      </div>
                      
                      <div className="p-6">
                        <h4 className="text-xl font-bold text-white mb-2">
                          {event.name}
                        </h4>
                        
                        <p className="text-white/80 mb-4 h-12 overflow-hidden">
                          {event.description}
                        </p>
                        
                        <div className="space-y-2 mb-4">
                          <div className="flex items-center text-white/70">
                            <MapPin size={16} className="mr-2 flex-shrink-0" />
                            <span className="truncate">{event.venue_name}, {event.city}</span>
                          </div>
                          
                          <div className="flex items-center text-white/70">
                            <Calendar size={16} className="mr-2 flex-shrink-0" />
                            <span>{event.date}</span>
                          </div>
                          
                          <div className="flex items-center text-white/70">
                            <Clock size={16} className="mr-2 flex-shrink-0" />
                            <span>{event.time}</span>
                          </div>
                        </div>
                        
                        <div className="flex items-center justify-between mb-4">
                          <div className="flex items-center space-x-4 text-sm text-white/70">
                            <div className="flex items-center">
                              <Users size={14} className="mr-1" />
                              {event.attending} {t('event.attending')}
                            </div>
                            <div className="flex items-center">
                              <Star size={14} className="mr-1" />
                              {event.interested} {t('event.interested')}
                            </div>
                          </div>
                        </div>
                        
                        <div className="flex space-x-2">
                          <button 
                            onClick={() => setSelectedEvent(event)}
                            className="flex-1 bg-gradient-to-r from-pink-500 to-red-500 text-white px-4 py-2 rounded-lg font-semibold hover:from-pink-600 hover:to-red-600 transition-all text-sm"
                          >
                            {t('event.viewDetails')}
                          </button>
                          
                          <button 
                            onClick={() => handleShare(event)}
                            className="px-3 py-2 bg-white/20 text-white rounded-lg hover:bg-white/30 transition-all"
                          >
                            <Share2 size={16} />
                          </button>
                        </div>
                      </div>
                    </div>
                  );
                })}
              </div>

              {/* 載入更多按鈕 */}
              {hasMore && events.length > 0 && (
                <div className="text-center mt-8">
                  <button
                    onClick={handleLoadMore}
                    disabled={isLoadingMore}
                    className="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-8 py-3 rounded-lg font-semibold hover:from-purple-600 hover:to-pink-600 transition-all flex items-center justify-center space-x-2 disabled:opacity-50 mx-auto"
                  >
                    {isLoadingMore ? (
                      <>
                        <div className="animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"></div>
                        <span>{t('status.loadingMore')}</span>
                      </>
                    ) : (
                      <span>{t('button.loadMore')}</span>
                    )}
                  </button>
                </div>
              )}
            </>
          )}
        </div>
      </main>

      {/* 活動詳情模態框 */}
      {selectedEvent && (
        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div className="relative">
              <img
                src={selectedEvent.image}
                alt={selectedEvent.name}
                className="w-full h-64 object-cover"
              />
              <button
                onClick={() => setSelectedEvent(null)}
                className="absolute top-4 right-4 bg-black/50 backdrop-blur-sm rounded-full p-2 text-white hover:bg-black/70 transition-all"
              >
                ✕
              </button>
              <div className="absolute top-4 left-4">
                {(() => {
                  const venueTypeInfo = venueTypes.find(t => t.value === selectedEvent.venue_type);
                  return (
                    <div className={`${venueTypeInfo?.color || 'bg-gray-500'} backdrop-blur-sm rounded-full px-3 py-1 text-white text-sm font-semibold flex items-center space-x-1`}>
                      <span>{venueTypeInfo?.icon}</span>
                      <span>{t(`venueTypes.${selectedEvent.venue_type}`)}</span>
                    </div>
                  );
                })()}
              </div>
            </div>
            
            <div className="p-6">
              <h2 className="text-2xl font-bold text-gray-900 mb-4">
                {selectedEvent.name}
              </h2>
              
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div className="space-y-3">
                  <div className="flex items-center text-gray-700">
                    <MapPin size={20} className="mr-3 text-blue-600" />
                    <div>
                      <div className="font-semibold">{selectedEvent.venue_name}</div>
                      <div className="text-sm">{selectedEvent.city}</div>
                    </div>
                  </div>
                  
                  <div className="flex items-center text-gray-700">
                    <Calendar size={20} className="mr-3 text-green-600" />
                    <span>{selectedEvent.date}</span>
                  </div>
                  
                  <div className="flex items-center text-gray-700">
                    <Clock size={20} className="mr-3 text-purple-600" />
                    <span>{selectedEvent.time}</span>
                  </div>
                </div>
                
                <div className="space-y-3">
                  <div className="flex items-center text-gray-700">
                    <Users size={20} className="mr-3 text-orange-600" />
                    <span>{selectedEvent.attending} {t('event.attending')}</span>
                  </div>
                  
                  <div className="flex items-center text-gray-700">
                    <Star size={20} className="mr-3 text-yellow-600" />
                    <span>{selectedEvent.interested} {t('event.interested')}</span>
                  </div>
                  
                  {selectedEvent.ticket_price !== null && (
                    <div className="flex items-center text-gray-700">
                      <span className="w-5 h-5 mr-3 text-green-600">💰</span>
                      <span>
                        {selectedEvent.ticket_price === 0 
                          ? t('event.free') 
                          : `NT$${selectedEvent.ticket_price}`
                        }
                      </span>
                    </div>
                  )}
                </div>
              </div>
              
              <div className="mb-6">
                <h3 className="text-lg font-semibold text-gray-900 mb-2">{t('event.description')}</h3>
                <p className="text-gray-700 leading-relaxed">
                  {selectedEvent.description}
                </p>
              </div>
              
              <div className="flex flex-col sm:flex-row gap-3">
                <button
                  onClick={() => handleShare(selectedEvent)}
                  className="flex-1 bg-gradient-to-r from-blue-500 to-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-blue-600 hover:to-purple-700 transition-all flex items-center justify-center space-x-2"
                >
                  <Share2 size={18} />
                  <span>{t('event.shareEvent')}</span>
                </button>
                
                <button
                  onClick={() => setSelectedEvent(null)}
                  className="flex-1 bg-gray-200 text-gray-800 px-6 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-all"
                >
                  {t('button.close')}
                </button>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}
