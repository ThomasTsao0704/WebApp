import React, { useState, useEffect, useCallback } from 'react';
import { Search, Calendar, MapPin, Users, Clock, Filter, Globe, Star, Share2, ExternalLink, Phone, Globe2, TrendingUp, Activity, Map } from 'lucide-react';

// å®Œæ•´ç¿»è­¯æª”æ¡ˆ
const translations = {
  'zh-TW': {
    app: {
      title: 'ä¼‘é–’æ´»å‹•æœå°‹',
      subtitle: 'æ¢ç´¢åŸå¸‚ä¸­æœ€ç²¾å½©çš„ä¼‘é–’å¨›æ¨‚æ´»å‹•'
    },
    navigation: {
      home: 'é¦–é ',
      events: 'æ´»å‹•',
      venues: 'å ´æ‰€',
      about: 'é—œæ–¼'
    },
    filter: {
      city: 'åŸå¸‚',
      allCities: 'æ‰€æœ‰åŸå¸‚',
      venueType: 'å ´æ‰€é¡å‹',
      allVenues: 'æ‰€æœ‰å ´æ‰€',
      startDate: 'é–‹å§‹æ—¥æœŸ',
      endDate: 'çµæŸæ—¥æœŸ',
      keyword: 'é—œéµå­—',
      keywordPlaceholder: 'æœå°‹æ´»å‹•åç¨±æˆ–æè¿°...'
    },
    venueTypes: {
      all: 'æ‰€æœ‰å ´æ‰€',
      bar: 'é…’å§',
      restaurant: 'é¤å»³',
      cafe: 'å’–å•¡å»³',
      hotspring: 'æº«æ³‰',
      other: 'å…¶ä»–'
    },
    button: {
      search: 'æœå°‹æ´»å‹•',
      clear: 'æ¸…é™¤',
      viewMore: 'æŸ¥çœ‹æ›´å¤š',
      loadMore: 'è¼‰å…¥æ›´å¤š',
      close: 'é—œé–‰'
    },
    result: {
      searchResults: 'æœå°‹çµæœ',
      foundEvents: 'å€‹æ´»å‹•',
      noEvents: 'æ‰¾ä¸åˆ°æ´»å‹•',
      tryDifferent: 'è«‹å˜—è©¦èª¿æ•´æœå°‹æ¢ä»¶æˆ–é¸æ“‡ä¸åŒçš„æ—¥æœŸç¯„åœ'
    },
    event: {
      attending: 'åƒåŠ ',
      interested: 'æ„Ÿèˆˆè¶£',
      viewDetails: 'æŸ¥çœ‹è©³æƒ…',
      shareEvent: 'åˆ†äº«æ´»å‹•',
      addToCalendar: 'åŠ å…¥è¡Œäº‹æ›†',
      free: 'å…è²»',
      ticketPrice: 'ç¥¨åƒ¹',
      ageLimit: 'å¹´é½¡é™åˆ¶',
      website: 'å®˜ç¶²',
      phone: 'é›»è©±',
      description: 'æ´»å‹•æè¿°'
    },
    stats: {
      totalEvents: 'ç¸½æ´»å‹•æ•¸',
      totalVenues: 'ç¸½å ´æ‰€æ•¸',
      totalCities: 'è¦†è“‹åŸå¸‚',
      thisWeekEvents: 'æœ¬é€±æ´»å‹•'
    },
    status: {
      searching: 'æœå°‹æ´»å‹•ä¸­...',
      translating: 'ç¿»è­¯ä¸­...',
      loading: 'è¼‰å…¥ä¸­...',
      loadingMore: 'è¼‰å…¥æ›´å¤šä¸­...'
    },
    error: {
      searchFailed: 'æœå°‹å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦',
      translationFailed: 'ç¿»è­¯æœå‹™æš«æ™‚ç„¡æ³•ä½¿ç”¨',
      networkError: 'ç¶²è·¯é€£ç·šéŒ¯èª¤',
      loadFailed: 'è¼‰å…¥å¤±æ•—'
    }
  },
  'en': {
    app: {
      title: 'Leisure Events Search',
      subtitle: 'Discover the most exciting leisure and entertainment events in the city'
    },
    navigation: {
      home: 'Home',
      events: 'Events',
      venues: 'Venues',
      about: 'About'
    },
    filter: {
      city: 'City',
      allCities: 'All Cities',
      venueType: 'Venue Type',
      allVenues: 'All Venues',
      startDate: 'Start Date',
      endDate: 'End Date',
      keyword: 'Keyword',
      keywordPlaceholder: 'Search event names or descriptions...'
    },
    venueTypes: {
      all: 'All Venues',
      bar: 'Bars',
      restaurant: 'Restaurants',
      cafe: 'Cafes',
      hotspring: 'Hot Springs',
      other: 'Others'
    },
    button: {
      search: 'Search Events',
      clear: 'Clear',
      viewMore: 'View More',
      loadMore: 'Load More',
      close: 'Close'
    },
    result: {
      searchResults: 'Search Results',
      foundEvents: 'events found',
      noEvents: 'No events found',
      tryDifferent: 'Try adjusting search criteria or selecting different date range'
    },
    event: {
      attending: 'Attending',
      interested: 'Interested',
      viewDetails: 'View Details',
      shareEvent: 'Share Event',
      addToCalendar: 'Add to Calendar',
      free: 'Free',
      ticketPrice: 'Price',
      ageLimit: 'Age Limit',
      website: 'Website',
      phone: 'Phone',
      description: 'Event Description'
    },
    stats: {
      totalEvents: 'Total Events',
      totalVenues: 'Total Venues',
      totalCities: 'Cities Covered',
      thisWeekEvents: 'This Week'
    },
    status: {
      searching: 'Searching events...',
      translating: 'Translating...',
      loading: 'Loading...',
      loadingMore: 'Loading more...'
    },
    error: {
      searchFailed: 'Search failed, please try again later',
      translationFailed: 'Translation service unavailable',
      networkError: 'Network connection error',
      loadFailed: 'Load failed'
    }
  },
  'ja': {
    app: {
      title: 'ãƒ¬ã‚¸ãƒ£ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆæ¤œç´¢',
      subtitle: 'è¡—ã§æœ€ã‚‚åˆºæ¿€çš„ãªãƒ¬ã‚¸ãƒ£ãƒ¼ãƒ»ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ†ã‚¤ãƒ¡ãƒ³ãƒˆã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºè¦‹ã—ã‚ˆã†'
    },
    navigation: {
      home: 'ãƒ›ãƒ¼ãƒ ',
      events: 'ã‚¤ãƒ™ãƒ³ãƒˆ',
      venues: 'ä¼šå ´',
      about: 'ã«ã¤ã„ã¦'
    },
    filter: {
      city: 'éƒ½å¸‚',
      allCities: 'ã™ã¹ã¦ã®éƒ½å¸‚',
      venueType: 'ä¼šå ´ã‚¿ã‚¤ãƒ—',
      allVenues: 'ã™ã¹ã¦ã®ä¼šå ´',
      startDate: 'é–‹å§‹æ—¥',
      endDate: 'çµ‚äº†æ—¥',
      keyword: 'ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰',
      keywordPlaceholder: 'ã‚¤ãƒ™ãƒ³ãƒˆåã‚„èª¬æ˜ã‚’æ¤œç´¢...'
    },
    venueTypes: {
      all: 'ã™ã¹ã¦ã®ä¼šå ´',
      bar: 'ãƒãƒ¼',
      restaurant: 'ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³',
      cafe: 'ã‚«ãƒ•ã‚§',
      hotspring: 'æ¸©æ³‰',
      other: 'ãã®ä»–'
    },
    button: {
      search: 'ã‚¤ãƒ™ãƒ³ãƒˆæ¤œç´¢',
      clear: 'ã‚¯ãƒªã‚¢',
      viewMore: 'è©³ç´°ã‚’è¦‹ã‚‹',
      loadMore: 'ã‚‚ã£ã¨èª­ã¿è¾¼ã‚€',
      close: 'é–‰ã˜ã‚‹'
    },
    result: {
      searchResults: 'æ¤œç´¢çµæœ',
      foundEvents: 'ã‚¤ãƒ™ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ',
      noEvents: 'ã‚¤ãƒ™ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“',
      tryDifferent: 'æ¤œç´¢æ¡ä»¶ã‚’èª¿æ•´ã™ã‚‹ã‹ã€ç•°ãªã‚‹æ—¥ä»˜ç¯„å›²ã‚’é¸æŠã—ã¦ãã ã•ã„'
    },
    event: {
      attending: 'å‚åŠ ',
      interested: 'èˆˆå‘³ã‚ã‚Š',
      viewDetails: 'è©³ç´°ã‚’è¦‹ã‚‹',
      shareEvent: 'ã‚¤ãƒ™ãƒ³ãƒˆã‚’ã‚·ã‚§ã‚¢',
      addToCalendar: 'ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«è¿½åŠ ',
      free: 'ç„¡æ–™',
      ticketPrice: 'æ–™é‡‘',
      ageLimit: 'å¹´é½¢åˆ¶é™',
      website: 'ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆ',
      phone: 'é›»è©±',
      description: 'ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°'
    },
    stats: {
      totalEvents: 'ç·ã‚¤ãƒ™ãƒ³ãƒˆæ•°',
      totalVenues: 'ç·ä¼šå ´æ•°',
      totalCities: 'å¯¾å¿œéƒ½å¸‚',
      thisWeekEvents: 'ä»Šé€±ã®ã‚¤ãƒ™ãƒ³ãƒˆ'
    },
    status: {
      searching: 'ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ¤œç´¢ä¸­...',
      translating: 'ç¿»è¨³ä¸­...',
      loading: 'èª­ã¿è¾¼ã¿ä¸­...',
      loadingMore: 'è¿½åŠ èª­ã¿è¾¼ã¿ä¸­...'
    },
    error: {
      searchFailed: 'æ¤œç´¢ã«å¤±æ•—ã—ã¾ã—ãŸã€‚å¾Œã§ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„',
      translationFailed: 'ç¿»è¨³ã‚µãƒ¼ãƒ“ã‚¹ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“',
      networkError: 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚¨ãƒ©ãƒ¼',
      loadFailed: 'èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ'
    }
  }
};

// èªè¨€åˆ—è¡¨
const languages = [
  { code: 'zh-TW', name: 'Traditional Chinese', native: 'ç¹é«”ä¸­æ–‡', flag: 'ğŸ‡¹ğŸ‡¼' },
  { code: 'zh-CN', name: 'Simplified Chinese', native: 'ç®€ä½“ä¸­æ–‡', flag: 'ğŸ‡¨ğŸ‡³' },
  { code: 'en', name: 'English', native: 'English', flag: 'ğŸ‡ºğŸ‡¸' },
  { code: 'ja', name: 'Japanese', native: 'æ—¥æœ¬èª', flag: 'ğŸ‡¯ğŸ‡µ' },
  { code: 'ko', name: 'Korean', native: 'í•œêµ­ì–´', flag: 'ğŸ‡°ğŸ‡·' },
  { code: 'es', name: 'Spanish', native: 'EspaÃ±ol', flag: 'ğŸ‡ªğŸ‡¸' },
  { code: 'fr', name: 'French', native: 'FranÃ§ais', flag: 'ğŸ‡«ğŸ‡·' },
  { code: 'de', name: 'German', native: 'Deutsch', flag: 'ğŸ‡©ğŸ‡ª' },
  { code: 'ar', name: 'Arabic', native: 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', flag: 'ğŸ‡¸ğŸ‡¦', rtl: true },
  { code: 'th', name: 'Thai', native: 'à¹„à¸—à¸¢', flag: 'ğŸ‡¹ğŸ‡­' },
  { code: 'vi', name: 'Vietnamese', native: 'Tiáº¿ng Viá»‡t', flag: 'ğŸ‡»ğŸ‡³' }
];

// å ´æ‰€é¡å‹åˆ—è¡¨
const venueTypes = [
  { value: 'all', icon: 'ğŸ¢', color: 'bg-gray-500', gradientFrom: 'from-gray-500', gradientTo: 'to-gray-600' },
  { value: 'bar', icon: 'ğŸ»', color: 'bg-purple-500', gradientFrom: 'from-purple-500', gradientTo: 'to-purple-600' },
  { value: 'restaurant', icon: 'ğŸ½ï¸', color: 'bg-orange-500', gradientFrom: 'from-orange-500', gradientTo: 'to-orange-600' },
  { value: 'cafe', icon: 'â˜•', color: 'bg-yellow-600', gradientFrom: 'from-yellow-500', gradientTo: 'to-yellow-600' },
  { value: 'hotspring', icon: 'â™¨ï¸', color: 'bg-blue-500', gradientFrom: 'from-blue-500', gradientTo: 'to-blue-600' },
  { value: 'other', icon: 'ğŸª', color: 'bg-green-500', gradientFrom: 'from-green-500', gradientTo: 'to-green-600' }
];

// æ¨¡æ“¬ API æ•¸æ“š
const mockCities = ['å°åŒ—å¸‚', 'å°ä¸­å¸‚', 'é«˜é›„å¸‚', 'å°å—å¸‚', 'æ–°åŒ—å¸‚', 'å®œè˜­ç¸£'];

const mockStats = {
  total_events: 156,
  total_venues: 89,
  total_cities: 6,
  this_week_events: 24
};

const mockEvents = [
  {
    id: 1,
    name: 'é€±äº”å¤œçˆµå£«éŸ³æ¨‚æœƒ',
    description: 'çŸ¥åçˆµå£«æ¨‚åœ˜ç¾å ´æ¼”å‡ºï¼Œäº«å—ç¾é…’èˆ‡éŸ³æ¨‚çš„å®Œç¾çµåˆã€‚åœ¨å„ªé›…çš„ç’°å¢ƒä¸­è†è½ç¶“å…¸çˆµå£«æ›²ç›®ã€‚',
    venue_name: 'Blue Note çˆµå£«é…’å§',
    city: 'å°åŒ—å¸‚',
    venue_type: 'bar',
    date: '2025-08-15',
    time: '20:00',
    attending: 156,
    interested: 324,
    image: 'https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=400&h=250&fit=crop',
    ticket_price: 800
  },
  {
    id: 2,
    name: 'æ¸¯å¼é»å¿ƒè£½ä½œèª²ç¨‹',
    description: 'å­¸ç¿’æ­£å®—æ¸¯å¼é»å¿ƒè£½ä½œæŠ€å·§ï¼Œç”±å°ˆæ¥­å¸«å‚…è¦ªè‡ªæŒ‡å°ï¼Œå“åšç¾å‘³æˆæœã€‚',
    venue_name: 'å¤©é¦™æ¨“',
    city: 'å°åŒ—å¸‚',
    venue_type: 'restaurant',
    date: '2025-08-16',
    time: '14:00',
    attending: 32,
    interested: 78,
    image: 'https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400&h=250&fit=crop',
    ticket_price: 1500
  },
  {
    id: 3,
    name: 'å’–å•¡æ‹‰èŠ±è—è¡“èª²ç¨‹',
    description: 'å­¸ç¿’å°ˆæ¥­å’–å•¡æ‹‰èŠ±æŠ€å·§ï¼Œå‰µä½œå±¬æ–¼è‡ªå·±çš„å’–å•¡è—è¡“ä½œå“ã€‚',
    venue_name: 'è—å±±å’–å•¡',
    city: 'å°åŒ—å¸‚',
    venue_type: 'cafe',
    date: '2025-08-17',
    time: '10:00',
    attending: 25,
    interested: 56,
    image: 'https://images.unsplash.com/photo-1501339847302-ac426a4a7cbb?w=400&h=250&fit=crop',
    ticket_price: 800
  },
  {
    id: 4,
    name: 'æº«æ³‰é¤Šç”Ÿä¹‹æ—…',
    description: 'ä¸€æ—¥æº«æ³‰é«”é©—ï¼ŒåŒ…å«æ³¡æ¹¯ã€æŒ‰æ‘©ã€é¤Šç”Ÿé¤é»ï¼Œè®“èº«å¿ƒå®Œå…¨æ”¾é¬†ã€‚',
    venue_name: 'çƒä¾†æº«æ³‰æœƒé¤¨',
    city: 'æ–°åŒ—å¸‚',
    venue_type: 'hotspring',
    date: '2025-08-18',
    time: '09:00',
    attending: 45,
    interested: 87,
    image: 'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=400&h=250&fit=crop',
    ticket_price: 2500
  },
  {
    id: 5,
    name: 'ç•¶ä»£è—è¡“å±•è¦½',
    description: 'å±•å‡ºæœ¬åœŸè—è¡“å®¶æœ€æ–°ä½œå“ï¼Œæ¢ç´¢ç•¶ä»£è—è¡“ä¹‹ç¾ï¼Œæ„Ÿå—å‰µä½œçš„åŠ›é‡ã€‚',
    venue_name: 'æ–‡åŒ–å±•æ¼”ä¸­å¿ƒ',
    city: 'å°åŒ—å¸‚',
    venue_type: 'other',
    date: '2025-08-19',
    time: '10:00',
    attending: 234,
    interested: 456,
    image: 'https://images.unsplash.com/photo-1492684223066-81342ee5ff30?w=400&h=250&fit=crop',
    ticket_price: 300
  },
  {
    id: 6,
    name: 'é›»éŸ³ç‹‚æ­¡ç¯€',
    description: 'é ‚å°–DJå¸¶ä¾†éœ‡æ’¼é›»éŸ³é«”é©—ï¼Œå¤œæ™šç‹‚æ­¡ä¸åœæ­‡ï¼Œæ„Ÿå—éŸ³æ¨‚çš„éœ‡æ’¼åŠ›ã€‚',
    venue_name: 'Neon Nights',
    city: 'å°ä¸­å¸‚',
    venue_type: 'bar',
    date: '2025-08-20',
    time: '21:00',
    attending: 423,
    interested: 892,
    image: 'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=400&h=250&fit=crop',
    ticket_price: 1000
  }
];

// API åŸºç¤ URL
const API_BASE_URL = '/api';

export default function LeisureEventsSearchApp() {
  // ç‹€æ…‹ç®¡ç†
  const [currentLang, setCurrentLang] = useState('zh-TW');
  const [showLangMenu, setShowLangMenu] = useState(false);
  const [searchFilters, setSearchFilters] = useState({
    city: '',
    venueType: '',
    startDate: '',
    endDate: '',
    keyword: ''
  });
  
  const [events, setEvents] = useState(mockEvents);
  const [cities, setCities] = useState(mockCities);
  const [isSearching, setIsSearching] = useState(false);
  const [isLoadingMore, setIsLoadingMore] = useState(false);
  const [activeTab, setActiveTab] = useState('events');
  const [selectedEvent, setSelectedEvent] = useState(null);
  const [error, setError] = useState('');
  const [hasMore, setHasMore] = useState(true);
  const [page, setPage] = useState(1);
  const [stats, setStats] = useState(mockStats);

  // å–å¾—ç¿»è­¯æ–‡å­—
  const t = useCallback((path) => {
    const keys = path.split('.');
    let value = translations[currentLang];
    for (const key of keys) {
      value = value?.[key];
    }
    return value || path;
  }, [currentLang]);

  // èªè¨€åµæ¸¬èˆ‡è¨­å®š
  useEffect(() => {
    const detectLanguage = () => {
      const browserLang = navigator.language;
      const supportedLang = languages.find(lang => 
        lang.code === browserLang || lang.code.split('-')[0] === browserLang.split('-')[0]
      );
      return supportedLang ? supportedLang.code : 'zh-TW';
    };
    
    const savedLang = localStorage.getItem('preferred-language') || detectLanguage();
    setCurrentLang(savedLang);
  }, []);

  // æ¨¡æ“¬ API èª¿ç”¨
  const fetchEvents = async (filters = searchFilters, pageNum = 1, append = false) => {
    try {
      if (!append) {
        setIsSearching(true);
        setError('');
      } else {
        setIsLoadingMore(true);
      }

      // æ¨¡æ“¬ API å»¶é²
      await new Promise(resolve => setTimeout(resolve, 1000));

      let filteredEvents = mockEvents;

      // ç¯©é¸é‚è¼¯
      if (filters.city) {
        filteredEvents = filteredEvents.filter(event => event.city === filters.city);
      }
      
      if (filters.venueType) {
        filteredEvents = filteredEvents.filter(event => event.venue_type === filters.venueType);
      }
      
      if (filters.keyword) {
        const keyword = filters.keyword.toLowerCase();
        filteredEvents = filteredEvents.filter(event => 
          event.name.toLowerCase().includes(keyword) ||
          event.description.toLowerCase().includes(keyword) ||
          event.venue_name.toLowerCase().includes(keyword)
        );
      }

      if (append) {
        setEvents(prev => [...prev, ...filteredEvents]);
      } else {
        setEvents(filteredEvents);
      }
      
      setHasMore(filteredEvents.length > 6);
      setPage(pageNum);

    } catch (err) {
      console.error('æœå°‹å¤±æ•—:', err);
      setError(t('error.networkError'));
    } finally {
      setIsSearching(false);
      setIsLoadingMore(false);
    }
  };

  // åˆ‡æ›èªè¨€
  const changeLanguage = (langCode) => {
    setCurrentLang(langCode);
    localStorage.setItem('preferred-language', langCode);
    setShowLangMenu(false);
  };

  // æœå°‹æ´»å‹•
  const handleSearch = () => {
    fetchEvents(searchFilters, 1, false);
  };

  // è¼‰å…¥æ›´å¤š
  const handleLoadMore = () => {
    fetchEvents(searchFilters, page + 1, true);
  };

  // æ¸…é™¤ç¯©é¸
  const clearFilters = () => {
    const emptyFilters = {
      city: '',
      venueType: '',
      startDate: '',
      endDate: '',
      keyword: ''
    };
    setSearchFilters(emptyFilters);
    setEvents(mockEvents);
  };

  // åˆ†äº«æ´»å‹•
  const handleShare = async (event) => {
    if (navigator.share) {
      try {
        await navigator.share({
          title: event.name,
          text: event.description,
          url: window.location.href
        });
      } catch (err) {
        console.log('åˆ†äº«å–æ¶ˆ');
      }
    } else {
      navigator.clipboard.writeText(`${event.name} - ${window.location.href}`);
      alert('æ´»å‹•é€£çµå·²è¤‡è£½åˆ°å‰ªè²¼ç°¿');
    }
  };

  // å–å¾—ç•¶å‰èªè¨€è¨­å®š
  const currentLangConfig = languages.find(lang => lang.code === currentLang);
  const isRTL = currentLangConfig?.rtl || false;

  return (
    <div className={`min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 ${isRTL ? 'rtl' : 'ltr'}`}>
      {/* å°èˆªåˆ— */}
      <nav className="bg-black/30 backdrop-blur-md border-b border-white/10 sticky top-0 z-50">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center justify-between">
            <div className="flex items-center space-x-4">
              <div className="text-2xl font-bold text-white">ğŸª</div>
              <h1 className="text-xl font-bold text-white">{t('app.title')}</h1>
            </div>
            
            <div className="hidden md:flex items-center space-x-6">
              {['home', 'events', 'venues', 'about'].map(tab => (
                <button
                  key={tab}
                  onClick={() => setActiveTab(tab)}
                  className={`px-3 py-2 rounded-lg transition-all ${
                    activeTab === tab 
                      ? 'bg-white/20 text-white' 
                      : 'text-white/70 hover:text-white hover:bg-white/10'
                  }`}
                >
                  {t(`navigation.${tab}`)}
                </button>
              ))}
            </div>
            
            {/* èªè¨€é¸æ“‡å™¨ */}
            <div className="relative">
              <button
                onClick={() => setShowLangMenu(!showLangMenu)}
                className="flex items-center space-x-2 px-3 py-2 bg-white/20 rounded-lg text-white hover:bg-white/30 transition-all"
              >
                <Globe size={16} />
                <span>{currentLangConfig?.flag}</span>
                <span className="hidden sm:inline">{currentLangConfig?.native}</span>
              </button>
              
              {showLangMenu && (
                <div className="absolute right-0 top-full mt-2 bg-white rounded-lg shadow-xl border border-gray-200 min-w-48 max-h-64 overflow-y-auto z-50">
                  {languages.map(lang => (
                    <button
                      key={lang.code}
                      onClick={() => changeLanguage(lang.code)}
                      className={`w-full px-4 py-2 text-left hover:bg-gray-50 flex items-center space-x-3 ${
                        currentLang === lang.code ? 'bg-blue-50 text-blue-600' : 'text-gray-700'
                      }`}
                    >
                      <span className="text-lg">{lang.flag}</span>
                      <div>
                        <div className="font-medium">{lang.native}</div>
                        <div className="text-sm text-gray-500">{lang.name}</div>
                      </div>
                    </button>
                  ))}
                </div>
              )}
            </div>
          </div>
        </div>
      </nav>

      {/* ä¸»è¦å…§å®¹ */}
      <main className="container mx-auto px-4 py-8">
        {/* éŒ¯èª¤è¨Šæ¯ */}
        {error && (
          <div className="bg-red-500/20 border border-red-500/30 rounded-lg p-4 mb-6">
            <div className="text-red-100 font-medium">{error}</div>
          </div>
        )}

        {/* æ¨™é¡Œå€èˆ‡çµ±è¨ˆ */}
        <div className="text-center mb-12">
          <h2 className="text-4xl md:text-6xl font-bold text-white mb-4">
            {t('app.title')}
          </h2>
          <p className="text-xl text-white/80 max-w-2xl mx-auto mb-8">
            {t('app.subtitle')}
          </p>
          
          {/* çµ±è¨ˆå¡ç‰‡ */}
          <div className="grid grid-cols-2 md:grid-cols-4 gap-4 max-w-4xl mx-auto mb-8">
            <div className="bg-white/10 backdrop-blur-sm rounded-lg p-4 border border-white/20">
              <div className="flex items-center justify-center mb-2">
                <Activity className="w-6 h-6 text-blue-400 mr-2" />
              </div>
              <div className="text-2xl font-bold text-white">{stats.total_events}</div>
              <div className="text-white/70 text-sm">{t('stats.totalEvents')}</div>
            </div>
            <div className="bg-white/10 backdrop-blur-sm rounded-lg p-4 border border-white/20">
              <div className="flex items-center justify-center mb-2">
                <Map className="w-6 h-6 text-green-400 mr-2" />
              </div>
              <div className="text-2xl font-bold text-white">{stats.total_venues}</div>
              <div className="text-white/70 text-sm">{t('stats.totalVenues')}</div>
            </div>
            <div className="bg-white/10 backdrop-blur-sm rounded-lg p-4 border border-white/20">
              <div className="flex items-center justify-center mb-2">
                <Globe2 className="w-6 h-6 text-purple-400 mr-2" />
              </div>
              <div className="text-2xl font-bold text-white">{stats.total_cities}</div>
              <div className="text-white/70 text-sm">{t('stats.totalCities')}</div>
            </div>
            <div className="bg-white/10 backdrop-blur-sm rounded-lg p-4 border border-white/20">
              <div className="flex items-center justify-center mb-2">
                <TrendingUp className="w-6 h-6 text-orange-400 mr-2" />
              </div>
              <div className="text-2xl font-bold text-white">{stats.this_week_events}</div>
              <div className="text-white/70 text-sm">{t('stats.thisWeekEvents')}</div>
            </div>
          </div>
        </div>

        {/* å ´æ‰€é¡å‹å¿«é€Ÿé¸æ“‡ */}
        <div className="mb-8">
          <h3 className="text-xl font-semibold text-white mb-4 text-center">å¿«é€Ÿé¸æ“‡å ´æ‰€é¡å‹</h3>
          <div className="flex flex-wrap justify-center gap-3">
            {venueTypes.map(type => (
              <button
                key={type.value}
                onClick={() => {
                  setSearchFilters({...searchFilters, venueType: type.value === 'all' ? '' : type.value});
                  const newFilters = {...searchFilters, venueType: type.value === 'all' ? '' : type.value};
                  fetchEvents(newFilters, 1, false);
                }}
                className={`flex items-center space-x-2 px-4 py-2 rounded-full text-white font-medium transition-all hover:scale-105 ${
                  searchFilters.venueType === (type.value === 'all' ? '' : type.value)
                    ? `bg-gradient-to-r ${type.gradientFrom} ${type.gradientTo} shadow-lg`
                    : 'bg-white/20 hover:bg-white/30'
                }`}
              >
                <span className="text-lg">{type.icon}</span>
                <span>{t(`venueTypes.${type.value}`)}</span>
              </button>
            ))}
          </div>
        </div>

        {/* æœå°‹ç¯©é¸å™¨ */}
        <div className="bg-white/10 backdrop-blur-md rounded-2xl p-6 mb-8 border border-white/20">
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-6">
            {/* åŸå¸‚é¸æ“‡ */}
            <div>
              <label className="block text-sm font-medium text-white mb-2">
                {t('filter.city')}
              </label>
              <select
                value={searchFilters.city}
                onChange={(e) => setSearchFilters({...searchFilters, city: e.target.value})}
                className="w-full px-3 py-2 bg-white/20 border border-white/30 rounded-lg text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400"
              >
                <option value="" className="text-gray-900">{t('filter.allCities')}</option>
                {cities.map(city => (
                  <option key={city} value={city} className="text-gray-900">{city}</option>
                ))}
              </select>
            </div>

            {/* å ´æ‰€é¡å‹é¸æ“‡ */}
            <div>
              <label className="block text-sm font-medium text-white mb-2">
                {t('filter.venueType')}
              </label>
              <select
                value={searchFilters.venueType}
                onChange={(e) => setSearchFilters({...searchFilters, venueType: e.target.value})}
                className="w-full px-3 py-2 bg-white/20 border border-white/30 rounded-lg text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400"
              >
                {venueTypes.map(type => (
                  <option key={type.value} value={type.value === 'all' ? '' : type.value} className="text-gray-900">
                    {type.icon} {t(`venueTypes.${type.value}`)}
                  </option>
                ))}
              </select>
            </div>

            {/* é–‹å§‹æ—¥æœŸ */}
            <div>
              <label className="block text-sm font-medium text-white mb-2">
                {t('filter.startDate')}
              </label>
              <input
                type="date"
                value={searchFilters.startDate}
                onChange={(e) => setSearchFilters({...searchFilters, startDate: e.target.value})}
                className="w-full px-3 py-2 bg-white/20 border border-white/30 rounded-lg text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400"
              />
            </div>

            {/* çµæŸæ—¥æœŸ */}
            <div>
              <label className="block text-sm font-medium text-white mb-2">
                {t('filter.endDate')}
              </label>
              <input
                type="date"
                value={searchFilters.endDate}
                onChange={(e) => setSearchFilters({...searchFilters, endDate: e.target.value})}
                className="w-full px-3 py-2 bg-white/20 border border-white/30 rounded-lg text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400"
              />
            </div>

            {/* é—œéµå­—æœå°‹ */}
            <div>
              <label className="block text-sm font-medium text-white mb-2">
                {t('filter.keyword')}
              </label>
              <input
                type="text"
                placeholder={t('filter.keywordPlaceholder')}
                value={searchFilters.keyword}
                onChange={(e) => setSearchFilters({...searchFilters, keyword: e.target.value})}
                onKeyPress={(e) => e.key === 'Enter' && handleSearch()}
                className="w-full px-3 py-2 bg-white/20 border border-white/30 rounded-lg text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400"
              />
            </div>
          </div>

          {/* æœå°‹æŒ‰éˆ• */}
          <div className="flex flex-col sm:flex-row gap-4">
            <button
              onClick={handleSearch}
              disabled={isSearching}
              className="flex-1 bg-gradient-to-r from-blue-500 to-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-blue-600 hover:to-purple-700 transition-all flex items-center justify-center space-x-2 disabled:opacity-50"
            >
              {isSearching ? (
                <>
                  <div className="animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"></div>
                  <span>{t('status.searching')}</span>
                </>
              ) : (
                <>
                  <Search size={18} />
                  <span>{t('button.search')}</span>
                </>
              )}
            </button>
            
            <button
              onClick={clearFilters}
              className="px-6 py-3 bg-white/20 text-white rounded-lg font-semibold hover:bg-white/30 transition-all flex items-center justify-center space-x-2"
            >
              <Filter size={18} />
              <span>{t('button.clear')}</span>
            </button>
          </div>
        </div>

        {/* æœå°‹çµæœ */}
        <div className="mb-6">
          <div className="flex items-center justify-between mb-6">
            <h3 className="text-2xl font-bold text-white">
              {t('result.searchResults')}
            </h3>
            <div className="text-white/70">
              {events.length} {t('result.foundEvents')}
            </div>
          </div>

          {events.length === 0 && !isSearching ? (
            <div className="text-center py-12">
              <div className="text-6xl mb-4">ğŸ”</div>
              <h3 className="text-xl font-semibold text-white mb-2">{t('result.noEvents')}</h3>
              <p className="text-white/70">{t('result.tryDifferent')}</p>
            </div>
          ) : (
            <>
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {events.map(event => {
                  const venueTypeInfo = venueTypes.find(t => t.value === event.venue_type);
                  return (
                    <div key={event.id} className="bg-white/10 backdrop-blur-md rounded-2xl overflow-hidden border border-white/20 hover:bg-white/20 transition-all group hover:scale-105">
                      <div className="relative">
                        <img
                          src={event.image}
                          alt={event.name}
                          className="w-full h-48 object-cover group-hover:scale-110 transition-transform duration-300"
                        />
                        <div className="absolute top-4 right-4">
                          <div className="bg-black/50 backdrop-blur-sm rounded-full p-2">
                            <Star className="w-4 h-4 text-yellow-400 fill-current" />
                          </div>
                        </div>
                        <div className="absolute top-4 left-4">
                          <div className={`${venueTypeInfo?.color || 'bg-gray-500'} backdrop-blur-sm rounded-full px-3 py-1 text-white text-sm font-semibold flex items-center space-x-1`}>
                            <span>{venueTypeInfo?.icon}</span>
                            <span>{t(`venueTypes.${event.venue_type}`)}</span>
                          </div>
                        </div>
                        {event.ticket_price !== null && (
                          <div className="absolute bottom-4 left-4">
                            <div className="bg-green-500/90 backdrop-blur-sm rounded-full px-3 py-1 text-white text-sm font-semibold">
                              {event.ticket_price === 0 ? t('event.free') : `NT$${event.ticket_price}`}
                            </div>
                          </div>
                        )}
                      </div>
                      
                      <div className="p-6">
                        <h4 className="text-xl font-bold text-white mb-2">
                          {event.name}
                        </h4>
                        
                        <p className="text-white/80 mb-4 h-12 overflow-hidden">
                          {event.description}
                        </p>
                        
                        <div className="space-y-2 mb-4">
                          <div className="flex items-center text-white/70">
                            <MapPin size={16} className="mr-2 flex-shrink-0" />
                            <span className="truncate">{event.venue_name}, {event.city}</span>
                          </div>
                          
                          <div className="flex items-center text-white/70">
                            <Calendar size={16} className="mr-2 flex-shrink-0" />
                            <span>{event.date}</span>
                          </div>
                          
                          <div className="flex items-center text-white/70">
                            <Clock size={16} className="mr-2 flex-shrink-0" />
                            <span>{event.time}</span>
                          </div>
                        </div>
                        
                        <div className="flex items-center justify-between mb-4">
                          <div className="flex items-center space-x-4 text-sm text-white/70">
                            <div className="flex items-center">
                              <Users size={14} className="mr-1" />
                              {event.attending} {t('event.attending')}
                            </div>
                            <div className="flex items-center">
                              <Star size={14} className="mr-1" />
                              {event.interested} {t('event.interested')}
                            </div>
                          </div>
                        </div>
                        
                        <div className="flex space-x-2">
                          <button 
                            onClick={() => setSelectedEvent(event)}
                            className="flex-1 bg-gradient-to-r from-pink-500 to-red-500 text-white px-4 py-2 rounded-lg font-semibold hover:from-pink-600 hover:to-red-600 transition-all text-sm"
                          >
                            {t('event.viewDetails')}
                          </button>
                          
                          <button 
                            onClick={() => handleShare(event)}
                            className="px-3 py-2 bg-white/20 text-white rounded-lg hover:bg-white/30 transition-all"
                          >
                            <Share2 size={16} />
                          </button>
                        </div>
                      </div>
                    </div>
                  );
                })}
              </div>

              {/* è¼‰å…¥æ›´å¤šæŒ‰éˆ• */}
              {hasMore && events.length > 0 && (
                <div className="text-center mt-8">
                  <button
                    onClick={handleLoadMore}
                    disabled={isLoadingMore}
                    className="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-8 py-3 rounded-lg font-semibold hover:from-purple-600 hover:to-pink-600 transition-all flex items-center justify-center space-x-2 disabled:opacity-50 mx-auto"
                  >
                    {isLoadingMore ? (
                      <>
                        <div className="animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"></div>
                        <span>{t('status.loadingMore')}</span>
                      </>
                    ) : (
                      <span>{t('button.loadMore')}</span>
                    )}
                  </button>
                </div>
              )}
            </>
          )}
        </div>
      </main>

      {/* æ´»å‹•è©³æƒ…æ¨¡æ…‹æ¡† */}
      {selectedEvent && (
        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div className="relative">
              <img
                src={selectedEvent.image}
                alt={selectedEvent.name}
                className="w-full h-64 object-cover"
              />
              <button
                onClick={() => setSelectedEvent(null)}
                className="absolute top-4 right-4 bg-black/50 backdrop-blur-sm rounded-full p-2 text-white hover:bg-black/70 transition-all"
              >
                âœ•
              </button>
              <div className="absolute top-4 left-4">
                {(() => {
                  const venueTypeInfo = venueTypes.find(t => t.value === selectedEvent.venue_type);
                  return (
                    <div className={`${venueTypeInfo?.color || 'bg-gray-500'} backdrop-blur-sm rounded-full px-3 py-1 text-white text-sm font-semibold flex items-center space-x-1`}>
                      <span>{venueTypeInfo?.icon}</span>
                      <span>{t(`venueTypes.${selectedEvent.venue_type}`)}</span>
                    </div>
                  );
                })()}
              </div>
            </div>
            
            <div className="p-6">
              <h2 className="text-2xl font-bold text-gray-900 mb-4">
                {selectedEvent.name}
              </h2>
              
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div className="space-y-3">
                  <div className="flex items-center text-gray-700">
                    <MapPin size={20} className="mr-3 text-blue-600" />
                    <div>
                      <div className="font-semibold">{selectedEvent.venue_name}</div>
                      <div className="text-sm">{selectedEvent.city}</div>
                    </div>
                  </div>
                  
                  <div className="flex items-center text-gray-700">
                    <Calendar size={20} className="mr-3 text-green-600" />
                    <span>{selectedEvent.date}</span>
                  </div>
                  
                  <div className="flex items-center text-gray-700">
                    <Clock size={20} className="mr-3 text-purple-600" />
                    <span>{selectedEvent.time}</span>
                  </div>
                </div>
                
                <div className="space-y-3">
                  <div className="flex items-center text-gray-700">
                    <Users size={20} className="mr-3 text-orange-600" />
                    <span>{selectedEvent.attending} {t('event.attending')}</span>
                  </div>
                  
                  <div className="flex items-center text-gray-700">
                    <Star size={20} className="mr-3 text-yellow-600" />
                    <span>{selectedEvent.interested} {t('event.interested')}</span>
                  </div>
                  
                  {selectedEvent.ticket_price !== null && (
                    <div className="flex items-center text-gray-700">
                      <span className="w-5 h-5 mr-3 text-green-600">ğŸ’°</span>
                      <span>
                        {selectedEvent.ticket_price === 0 
                          ? t('event.free') 
                          : `NT$${selectedEvent.ticket_price}`
                        }
                      </span>
                    </div>
                  )}
                </div>
              </div>
              
              <div className="mb-6">
                <h3 className="text-lg font-semibold text-gray-900 mb-2">{t('event.description')}</h3>
                <p className="text-gray-700 leading-relaxed">
                  {selectedEvent.description}
                </p>
              </div>
              
              <div className="flex flex-col sm:flex-row gap-3">
                <button
                  onClick={() => handleShare(selectedEvent)}
                  className="flex-1 bg-gradient-to-r from-blue-500 to-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-blue-600 hover:to-purple-700 transition-all flex items-center justify-center space-x-2"
                >
                  <Share2 size={18} />
                  <span>{t('event.shareEvent')}</span>
                </button>
                
                <button
                  onClick={() => setSelectedEvent(null)}
                  className="flex-1 bg-gray-200 text-gray-800 px-6 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-all"
                >
                  {t('button.close')}
                </button>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}
