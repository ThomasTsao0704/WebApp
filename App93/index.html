<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>股票分析記錄</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Microsoft JhengHei", "微軟正黑體", sans-serif;
            background: #f0f2f6;
            padding: 10px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        .header {
            background: white;
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .tabs {
            display: flex;
            gap: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            color: #666;
            font-size: 14px;
            transition: all 0.3s;
        }

        .tab.active {
            color: #ff4b4b;
            border-bottom-color: #ff4b4b;
        }

        .content {
            padding: 20px;
        }

        .page-title {
            font-size: 24px;
            margin-bottom: 25px;
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: #333;
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background: #f8f9fa;
            transition: border-color 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: #ff4b4b;
            background: white;
        }

        .form-input:disabled {
            background: #e9ecef;
            color: #6c757d;
            cursor: not-allowed;
        }

        .number-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
        }

        .number-display {
            flex: 1;
            padding: 8px;
            text-align: center;
            font-size: 16px;
            color: #333;
        }

        .btn-control {
            width: 36px;
            height: 36px;
            border: none;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 18px;
            color: #666;
            transition: all 0.2s;
        }

        .btn-control:hover {
            background: #e0e0e0;
        }

        .slider-container {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #ff4b4b;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #ff4b4b;
            cursor: pointer;
            border: none;
        }

        .slider-value {
            text-align: center;
            margin-bottom: 10px;
            font-size: 16px;
            color: #ff4b4b;
            font-weight: 600;
        }

        select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background: #f8f9fa;
            cursor: pointer;
        }

        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background: #f8f9fa;
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
        }

        textarea:focus {
            outline: none;
            border-color: #ff4b4b;
            background: white;
        }

        .submit-btn {
            width: 100%;
            max-width: 200px;
            padding: 12px 24px;
            background: #ff4b4b;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
            margin-top: 20px;
            margin-right: 10px;
        }

        .submit-btn:hover {
            background: #e63946;
        }

        .export-btn {
            width: 100%;
            max-width: 200px;
            padding: 12px 24px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
            margin-top: 20px;
        }

        .export-btn:hover {
            background: #218838;
        }

        .export-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .record-count {
            margin-top: 20px;
            padding: 15px;
            background: #e8f4f8;
            border-radius: 4px;
            text-align: center;
            font-size: 14px;
            color: #333;
        }

        .record-count span {
            font-weight: bold;
            color: #ff4b4b;
            font-size: 18px;
        }

        .footer {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            color: #666;
            font-size: 12px;
            border-top: 1px solid #e0e0e0;
        }

        .fullscreen-btn {
            float: right;
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            text-decoration: underline;
        }

        .auto-fill-hint {
            font-size: 12px;
            color: #6c757d;
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="tabs">
                <div class="tab active">🔧 新增分析紀錄</div>
                <div class="tab">📋 瀏覽分析紀錄</div>
                <div class="tab">📊 整合分析視圖</div>
            </div>
        </div>

        <div class="content">
            <h1 class="page-title">📝 新增股票分析紀錄</h1>

            <form id="analysisForm">
                <div class="form-group">
                    <label class="form-label">📅 分析日期</label>
                    <input type="date" class="form-input" id="analysisDate" value="2025-09-30">
                </div>

                <div class="form-group">
                    <label class="form-label">🏷️ 股票代號</label>
                    <input type="text" class="form-input" id="stockCode" placeholder="例：2330" list="stockCodeList">
                    <datalist id="stockCodeList"></datalist>
                    <div class="auto-fill-hint">💡 輸入代號會自動帶入名稱和產業</div>
                </div>

                <div class="form-group">
                    <label class="form-label">📄 股票名稱</label>
                    <input type="text" class="form-input" id="stockName" placeholder="例：台積電" list="stockNameList">
                    <datalist id="stockNameList"></datalist>
                    <div class="auto-fill-hint">💡 輸入名稱會自動帶入代號和產業</div>
                </div>

                <div class="form-group">
                    <label class="form-label">🏭 市場產業</label>
                    <input type="text" class="form-input" id="industry" placeholder="市場產業" disabled>
                </div>

                <div class="form-group">
                    <label class="form-label">🎯 目標價</label>
                    <div class="number-input-group">
                        <button type="button" class="btn-control" onclick="changeValue('target', -1)">−</button>
                        <div class="number-display" id="targetPrice">0.00</div>
                        <button type="button" class="btn-control" onclick="changeValue('target', 1)">+</button>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">🛡️ 停損價</label>
                    <div class="number-input-group">
                        <button type="button" class="btn-control" onclick="changeValue('stop', -1)">−</button>
                        <div class="number-display" id="stopPrice">0.00</div>
                        <button type="button" class="btn-control" onclick="changeValue('stop', 1)">+</button>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">📊 信心度</label>
                    <div class="slider-container">
                        <div class="slider-value" id="confidenceValue">5</div>
                        <input type="range" min="0" max="10" value="5" class="slider" id="confidenceSlider" oninput="updateConfidence(this.value)">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">🔧 策略標籤</label>
                    <select id="strategy">
                        <option value="">選擇策略</option>
                        <option>長線投資</option>
                        <option>短線交易</option>
                        <option>波段操作</option>
                        <option>價值投資</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">😊 市場情緒</label>
                    <select id="sentiment">
                        <option>非常樂觀</option>
                        <option>樂觀</option>
                        <option>中性</option>
                        <option>悲觀</option>
                        <option>非常悲觀</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">📍 參考指標</label>
                    <select id="indicator">
                        <option value="">選擇指標</option>
                        <option>KD指標</option>
                        <option>MACD</option>
                        <option>RSI</option>
                        <option>均線系統</option>
                        <option>成交量</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">💜 預判方向與進場理由</label>
                    <textarea id="prediction" placeholder="請輸入預判方向與進場理由..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">📊 分析內容</label>
                    <textarea id="analysis" placeholder="請輸入詳細的分析內容..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">📝 額外備註</label>
                    <textarea id="notes" placeholder="請輸入額外備註..."></textarea>
                </div>

                <button type="submit" class="submit-btn">📊 新增記錄</button>
                <button type="button" class="export-btn" onclick="exportToCSV()">💾 匯出CSV檔案</button>
            </form>

            <div class="record-count" id="recordCount">
                已儲存記錄：<span id="count">0</span> 條
            </div>
        </div>

        <div class="footer">
            Built with Streamlit ❤️
            <button class="fullscreen-btn">Fullscreen ↗</button>
        </div>
    </div>

    <script>
        // 股票資料
        const stockData = [{"股票代號":"1101","股票名稱":"台泥","市場產業":"上市水泥工業"},{"股票代號":"1102","股票名稱":"亞泥","市場產業":"上市水泥工業"},{"股票代號":"1103","股票名稱":"嘉泥","市場產業":"上市水泥工業"},{"股票代號":"1104","股票名稱":"環泥","市場產業":"上市水泥工業"},{"股票代號":"1108","股票名稱":"幸福","市場產業":"上市水泥工業"},{"股票代號":"1109","股票名稱":"信大","市場產業":"上市水泥工業"},{"股票代號":"1110","股票名稱":"東泥","市場產業":"上市水泥工業"},{"股票代號":"1201","股票名稱":"味全","市場產業":"上市食品工業"},{"股票代號":"1203","股票名稱":"味王","市場產業":"上市食品工業"},{"股票代號":"1210","股票名稱":"大成","市場產業":"上市食品工業"},{"股票代號":"1213","股票名稱":"大飲","市場產業":"上市食品工業"},{"股票代號":"1215","股票名稱":"卜蜂","市場產業":"上市食品工業"},{"股票代號":"1216","股票名稱":"統一","市場產業":"上市食品工業"},{"股票代號":"1217","股票名稱":"愛之味","市場產業":"上市食品工業"},{"股票代號":"1218","股票名稱":"泰山","市場產業":"上市食品工業"},{"股票代號":"1219","股票名稱":"福壽","市場產業":"上市食品工業"},{"股票代號":"1220","股票名稱":"台榮","市場產業":"上市食品工業"},{"股票代號":"1225","股票名稱":"福懋油","市場產業":"上市食品工業"},{"股票代號":"1227","股票名稱":"佳格","市場產業":"上市食品工業"},{"股票代號":"1229","股票名稱":"聯華","市場產業":"上市食品工業"},{"股票代號":"1231","股票名稱":"聯華食","市場產業":"上市食品工業"},{"股票代號":"1232","股票名稱":"大統益","市場產業":"上市食品工業"},{"股票代號":"1233","股票名稱":"天仁","市場產業":"上市食品工業"},{"股票代號":"1234","股票名稱":"黑松","市場產業":"上市食品工業"},{"股票代號":"1235","股票名稱":"興泰","市場產業":"上市食品工業"},{"股票代號":"1236","股票名稱":"宏亞","市場產業":"上市食品工業"},{"股票代號":"1256","股票名稱":"鮮活果汁-KY","市場產業":"上市食品工業"},{"股票代號":"1301","股票名稱":"台塑","市場產業":"上市塑膠工業"},{"股票代號":"1303","股票名稱":"南亞","市場產業":"上市塑膠工業"},{"股票代號":"1304","股票名稱":"台聚","市場產業":"上市塑膠工業"},{"股票代號":"1305","股票名稱":"華夏","市場產業":"上市塑膠工業"},{"股票代號":"1307","股票名稱":"三芳","市場產業":"上市塑膠工業"},{"股票代號":"1308","股票名稱":"亞聚","市場產業":"上市塑膠工業"},{"股票代號":"1309","股票名稱":"台達化","市場產業":"上市塑膠工業"},{"股票代號":"1310","股票名稱":"台苯","市場產業":"上市塑膠工業"},{"股票代號":"1312","股票名稱":"國喬","市場產業":"上市塑膠工業"},{"股票代號":"1313","股票名稱":"聯成","市場產業":"上市塑膠工業"},{"股票代號":"1314","股票名稱":"中石化","市場產業":"上市塑膠工業"},{"股票代號":"1315","股票名稱":"達新","市場產業":"上市塑膠工業"},{"股票代號":"1316","股票名稱":"上曜","市場產業":"上市建材營造業"},{"股票代號":"1319","股票名稱":"東陽","市場產業":"上市汽車工業"},{"股票代號":"1321","股票名稱":"大洋","市場產業":"上市塑膠工業"},{"股票代號":"1323","股票名稱":"永裕","市場產業":"上市塑膠工業"},{"股票代號":"1324","股票名稱":"地球","市場產業":"上市塑膠工業"},{"股票代號":"1325","股票名稱":"恆大","市場產業":"上市塑膠工業"},{"股票代號":"1326","股票名稱":"台化","市場產業":"上市塑膠工業"},{"股票代號":"1337","股票名稱":"再生-KY","市場產業":"上市塑膠工業"},{"股票代號":"1338","股票名稱":"廣華-KY","市場產業":"上市汽車工業"},{"股票代號":"1339","股票名稱":"昭輝","市場產業":"上市汽車工業"},{"股票代號":"1340","股票名稱":"勝悅-KY","市場產業":"上市塑膠工業"},{"股票代號":"1341","股票名稱":"富林-KY","市場產業":"上市塑膠工業"},{"股票代號":"1342","股票名稱":"八貫","市場產業":"上市其他業"},{"股票代號":"1402","股票名稱":"遠東新","市場產業":"上市紡織纖維"},{"股票代號":"1409","股票名稱":"新纖","市場產業":"上市紡織纖維"},{"股票代號":"1410","股票名稱":"南染","市場產業":"上市紡織纖維"},{"股票代號":"1413","股票名稱":"宏洲","市場產業":"上市紡織纖維"},{"股票代號":"1414","股票名稱":"東和","市場產業":"上市紡織纖維"},{"股票代號":"1416","股票名稱":"廣豐","市場產業":"上市其他業"},{"股票代號":"1417","股票名稱":"嘉裕","市場產業":"上市紡織纖維"},{"股票代號":"1418","股票名稱":"東華","市場產業":"上市紡織纖維"},{"股票代號":"1419","股票名稱":"新紡","市場產業":"上市紡織纖維"},{"股票代號":"1423","股票名稱":"利華","市場產業":"上市紡織纖維"},{"股票代號":"1432","股票名稱":"大魯閣","市場產業":"上市運動休閒"},{"股票代號":"1434","股票名稱":"福懋","市場產業":"上市紡織纖維"},{"股票代號":"1435","股票名稱":"中福","市場產業":"上市其他業"},{"股票代號":"1436","股票名稱":"華友聯","市場產業":"上市建材營造業"},{"股票代號":"1437","股票名稱":"勤益控","市場產業":"上市其他業"},{"股票代號":"1438","股票名稱":"三地開發","市場產業":"上市建材營造業"},{"股票代號":"1439","股票名稱":"雋揚","市場產業":"上市建材營造業"},{"股票代號":"1440","股票名稱":"南紡","市場產業":"上市紡織纖維"},{"股票代號":"1441","股票名稱":"大東","市場產業":"上市紡織纖維"},{"股票代號":"1442","股票名稱":"名軒","市場產業":"上市建材營造業"},{"股票代號":"1443","股票名稱":"立益物流","市場產業":"上市其他業"},{"股票代號":"1444","股票名稱":"力麗","市場產業":"上市紡織纖維"},{"股票代號":"1445","股票名稱":"大宇","市場產業":"上市紡織纖維"},{"股票代號":"1446","股票名稱":"宏和","市場產業":"上市紡織纖維"},{"股票代號":"1447","股票名稱":"力鵬","市場產業":"上市紡織纖維"},{"股票代號":"1449","股票名稱":"佳和","市場產業":"上市紡織纖維"},{"股票代號":"1451","股票名稱":"年興","市場產業":"上市紡織纖維"},{"股票代號":"1452","股票名稱":"宏益","市場產業":"上市紡織纖維"},{"股票代號":"1453","股票名稱":"大將","市場產業":"上市建材營造業"},{"股票代號":"1454","股票名稱":"台富","市場產業":"上市紡織纖維"},{"股票代號":"1455","股票名稱":"集盛","市場產業":"上市紡織纖維"},{"股票代號":"1456","股票名稱":"怡華","市場產業":"上市建材營造業"},{"股票代號":"1457","股票名稱":"宜進","市場產業":"上市紡織纖維"},{"股票代號":"1459","股票名稱":"聯發","市場產業":"上市紡織纖維"},{"股票代號":"1460","股票名稱":"宏遠","市場產業":"上市紡織纖維"},{"股票代號":"1463","股票名稱":"強盛新","市場產業":"上市紡織纖維"},{"股票代號":"1464","股票名稱":"得力","市場產業":"上市紡織纖維"},{"股票代號":"1465","股票名稱":"偉全","市場產業":"上市紡織纖維"},{"股票代號":"1466","股票名稱":"聚隆","市場產業":"上市紡織纖維"},{"股票代號":"1467","股票名稱":"南緯","市場產業":"上市紡織纖維"},{"股票代號":"1468","股票名稱":"昶和","市場產業":"上市紡織纖維"},{"股票代號":"1470","股票名稱":"大統新創","市場產業":"上市紡織纖維"},{"股票代號":"1471","股票名稱":"首利","市場產業":"上市電子零組件業"},{"股票代號":"1472","股票名稱":"三洋實業","市場產業":"上市建材營造業"},{"股票代號":"1473","股票名稱":"台南","市場產業":"上市紡織纖維"},{"股票代號":"1474","股票名稱":"弘裕","市場產業":"上市紡織纖維"},{"股票代號":"1475","股票名稱":"業旺","市場產業":"上市紡織纖維"},{"股票代號":"1476","股票名稱":"儒鴻","市場產業":"上市紡織纖維"},{"股票代號":"1477","股票名稱":"聚陽","市場產業":"上市紡織纖維"},{"股票代號":"1503","股票名稱":"士電","市場產業":"上市電機機械"},{"股票代號":"1504","股票名稱":"東元","市場產業":"上市電機機械"},{"股票代號":"1506","股票名稱":"正道","市場產業":"上市電機機械"},{"股票代號":"1512","股票名稱":"瑞利","市場產業":"上市汽車工業"},{"股票代號":"1513","股票名稱":"中興電","市場產業":"上市電機機械"},{"股票代號":"1514","股票名稱":"亞力","市場產業":"上市電機機械"},{"股票代號":"1515","股票名稱":"力山","市場產業":"上市電機機械"},{"股票代號":"1516","股票名稱":"川飛","市場產業":"上市其他業"},{"股票代號":"1517","股票名稱":"利奇","市場產業":"上市電機機械"},{"股票代號":"1519","股票名稱":"華城","市場產業":"上市電機機械"},{"股票代號":"1521","股票名稱":"大億","市場產業":"上市汽車工業"},{"股票代號":"1522","股票名稱":"堤維西","市場產業":"上市汽車工業"},{"股票代號":"1524","股票名稱":"耿鼎","市場產業":"上市汽車工業"},{"股票代號":"1525","股票名稱":"江申","市場產業":"上市汽車工業"},{"股票代號":"1526","股票名稱":"日馳","市場產業":"上市電機機械"},{"股票代號":"1527","股票名稱":"鑽全","市場產業":"上市電機機械"},{"股票代號":"1528","股票名稱":"恩德","市場產業":"上市電機機械"},{"股票代號":"1529","股票名稱":"樂事綠能","市場產業":"上市電機機械"},{"股票代號":"1530","股票名稱":"亞崴","市場產業":"上市電機機械"},{"股票代號":"1531","股票名稱":"高林股","市場產業":"上市電機機械"},{"股票代號":"1532","股票名稱":"勤美","市場產業":"上市電機機械"},{"股票代號":"1533","股票名稱":"車王電","市場產業":"上市汽車工業"},{"股票代號":"1535","股票名稱":"中宇","市場產業":"上市電機機械"},{"股票代號":"1536","股票名稱":"和大","市場產業":"上市汽車工業"},{"股票代號":"1537","股票名稱":"廣隆","市場產業":"上市電機機械"},{"股票代號":"1538","股票名稱":"正峰","市場產業":"上市電機機械"},{"股票代號":"1539","股票名稱":"巨庭","市場產業":"上市電機機械"},{"股票代號":"1540","股票名稱":"喬福","市場產業":"上市電機機械"},{"股票代號":"1541","股票名稱":"錩泰","市場產業":"上市電機機械"},{"股票代號":"1558","股票名稱":"伸興","市場產業":"上市電機機械"},{"股票代號":"1560","股票名稱":"中砂","市場產業":"上市電機機械"},{"股票代號":"1563","股票名稱":"巧新","市場產業":"上市汽車工業"},{"股票代號":"1568","股票名稱":"倉佑","市場產業":"上市汽車工業"},{"股票代號":"1582","股票名稱":"信錦","市場產業":"上市電子零組件業"},{"股票代號":"1583","股票名稱":"程泰","市場產業":"上市電機機械"},{"股票代號":"1587","股票名稱":"吉茂","市場產業":"上市汽車工業"},{"股票代號":"1589","股票名稱":"永冠-KY","市場產業":"上市電機機械"},{"股票代號":"1590","股票名稱":"亞德客-KY","市場產業":"上市電機機械"},{"股票代號":"1597","股票名稱":"直得","市場產業":"上市電機機械"},{"股票代號":"1598","股票名稱":"岱宇","市場產業":"上市運動休閒"},{"股票代號":"1603","股票名稱":"華電","市場產業":"上市電器電纜"},{"股票代號":"1604","股票名稱":"聲寶","市場產業":"上市電器電纜"},{"股票代號":"1605","股票名稱":"華新","市場產業":"上市電器電纜"},{"股票代號":"1608","股票名稱":"華榮","市場產業":"上市電器電纜"},{"股票代號":"1609","股票名稱":"大亞","市場產業":"上市電器電纜"},{"股票代號":"1611","股票名稱":"中電","市場產業":"上市電器電纜"},{"股票代號":"1612","股票名稱":"宏泰","市場產業":"上市電器電纜"},{"股票代號":"1614","股票名稱":"三洋電","市場產業":"上市電器電纜"},{"股票代號":"1615","股票名稱":"大山","市場產業":"上市電器電纜"},{"股票代號":"1616","股票名稱":"億泰","市場產業":"上市電器電纜"},{"股票代號":"1617","股票名稱":"榮星","市場產業":"上市電器電纜"},{"股票代號":"1618","股票名稱":"合機","市場產業":"上市電器電纜"},{"股票代號":"1626","股票名稱":"艾美特-KY","市場產業":"上市電器電纜"},{"股票代號":"1702","股票名稱":"南僑","市場產業":"上市食品工業"},{"股票代號":"1707","股票名稱":"葡萄王","市場產業":"上市生技醫療業"},{"股票代號":"1708","股票名稱":"東鹼","市場產業":"上市化學工業"},{"股票代號":"1709","股票名稱":"和益","市場產業":"上市化學工業"},{"股票代號":"1710","股票名稱":"東聯","市場產業":"上市化學工業"},{"股票代號":"1711","股票名稱":"永光","市場產業":"上市化學工業"},{"股票代號":"1712","股票名稱":"興農","市場產業":"上市化學工業"},{"股票代號":"1713","股票名稱":"國化","市場產業":"上市化學工業"},{"股票代號":"1714","股票名稱":"和桐","市場產業":"上市化學工業"},{"股票代號":"1717","股票名稱":"長興","市場產業":"上市化學工業"},{"股票代號":"1718","股票名稱":"中纖","市場產業":"上市化學工業"},{"股票代號":"1720","股票名稱":"生達","市場產業":"上市生技醫療業"},{"股票代號":"1721","股票名稱":"三晃","市場產業":"上市化學工業"},{"股票代號":"1722","股票名稱":"台肥","市場產業":"上市化學工業"},{"股票代號":"1723","股票名稱":"中碳","市場產業":"上市化學工業"},{"股票代號":"1725","股票名稱":"元禎","市場產業":"上市化學工業"},{"股票代號":"1726","股票名稱":"永記","市場產業":"上市化學工業"},{"股票代號":"1727","股票名稱":"中華化","市場產業":"上市化學工業"},{"股票代號":"1730","股票名稱":"花仙子","市場產業":"上市化學工業"},{"股票代號":"1731","股票名稱":"美吾華","市場產業":"上市生技醫療業"},{"股票代號":"1732","股票名稱":"毛寶","市場產業":"上市化學工業"},{"股票代號":"1733","股票名稱":"五鼎","市場產業":"上市生技醫療業"},{"股票代號":"1734","股票名稱":"杏輝","市場產業":"上市生技醫療業"},{"股票代號":"1735","股票名稱":"日勝化","市場產業":"上市化學工業"},{"股票代號":"1736","股票名稱":"喬山","市場產業":"上市運動休閒"},{"股票代號":"1737","股票名稱":"臺鹽","市場產業":"上市食品工業"},{"股票代號":"1752","股票名稱":"南光","市場產業":"上市生技醫療業"},{"股票代號":"1760","股票名稱":"寶齡富錦","市場產業":"上市生技醫療業"},{"股票代號":"1762","股票名稱":"中化生","市場產業":"上市生技醫療業"},{"股票代號":"1773","股票名稱":"勝一","市場產業":"上市化學工業"},{"股票代號":"1776","股票名稱":"展宇","市場產業":"上市化學工業"},{"股票代號":"1783","股票名稱":"和康生","市場產業":"上市生技醫療業"},{"股票代號":"1786","股票名稱":"科妍","市場產業":"上市生技醫療業"},{"股票代號":"1789","股票名稱":"神隆","市場產業":"上市生技醫療業"},{"股票代號":"1795","股票名稱":"美時","市場產業":"上市生技醫療業"},{"股票代號":"1802","股票名稱":"台玻","市場產業":"上市玻璃陶瓷"},{"股票代號":"1805","股票名稱":"寶徠","市場產業":"上市建材營造業"},{"股票代號":"1806","股票名稱":"冠軍","市場產業":"上市玻璃陶瓷"},{"股票代號":"1808","股票名稱":"潤隆","市場產業":"上市建材營造業"},{"股票代號":"1809","股票名稱":"中釉","市場產業":"上市玻璃陶瓷"},{"股票代號":"1810","股票名稱":"和成","市場產業":"上市玻璃陶瓷"},{"股票代號":"1817","股票名稱":"凱撒衛","市場產業":"上市玻璃陶瓷"},{"股票代號":"1903","股票名稱":"士紙","市場產業":"上市造紙工業"},{"股票代號":"1904","股票名稱":"正隆","市場產業":"上市造紙工業"},{"股票代號":"1905","股票名稱":"華紙","市場產業":"上市造紙工業"},{"股票代號":"1906","股票名稱":"寶隆","市場產業":"上市造紙工業"},{"股票代號":"1907","股票名稱":"永豐餘","市場產業":"上市造紙工業"},{"股票代號":"1909","股票名稱":"榮成","市場產業":"上市造紙工業"},{"股票代號":"2002","股票名稱":"中鋼","市場產業":"上市鋼鐵工業"},{"股票代號":"2006","股票名稱":"東和鋼鐵","市場產業":"上市鋼鐵工業"},{"股票代號":"2007","股票名稱":"燁興","市場產業":"上市鋼鐵工業"},{"股票代號":"2008","股票名稱":"高興昌","市場產業":"上市鋼鐵工業"},{"股票代號":"2009","股票名稱":"第一銅","市場產業":"上市鋼鐵工業"},{"股票代號":"2010","股票名稱":"春源","市場產業":"上市鋼鐵工業"},{"股票代號":"2012","股票名稱":"春雨","市場產業":"上市鋼鐵工業"},{"股票代號":"2013","股票名稱":"中鋼構","市場產業":"上市鋼鐵工業"},{"股票代號":"2014","股票名稱":"中鴻","市場產業":"上市鋼鐵工業"},{"股票代號":"2015","股票名稱":"豐興","市場產業":"上市鋼鐵工業"},{"股票代號":"2017","股票名稱":"官田鋼","市場產業":"上市鋼鐵工業"},{"股票代號":"2020","股票名稱":"美亞","市場產業":"上市鋼鐵工業"},{"股票代號":"2022","股票名稱":"聚亨","市場產業":"上市鋼鐵工業"},{"股票代號":"2023","股票名稱":"燁輝","市場產業":"上市鋼鐵工業"},{"股票代號":"2024","股票名稱":"志聯","市場產業":"上市鋼鐵工業"},{"股票代號":"2025","股票名稱":"千興","市場產業":"上市鋼鐵工業"},{"股票代號":"2027","股票名稱":"大成鋼","市場產業":"上市鋼鐵工業"},{"股票代號":"2028","股票名稱":"威致","市場產業":"上市鋼鐵工業"},{"股票代號":"2029","股票名稱":"盛餘","市場產業":"上市鋼鐵工業"},{"股票代號":"2030","股票名稱":"彰源","市場產業":"上市鋼鐵工業"},{"股票代號":"2031","股票名稱":"新光鋼","市場產業":"上市鋼鐵工業"},{"股票代號":"2032","股票名稱":"新鋼","市場產業":"上市鋼鐵工業"}];

        // 建立查找對映
        const stockMap = {};
        const nameMap = {};
        
        stockData.forEach(stock => {
            stockMap[stock.股票代號] = stock;
            nameMap[stock.股票名稱] = stock;
        });

        // 填充 datalist
        const stockCodeList = document.getElementById('stockCodeList');
        const stockNameList = document.getElementById('stockNameList');
        
        stockData.forEach(stock => {
            const codeOption = document.createElement('option');
            codeOption.value = stock.股票代號;
            codeOption.textContent = `${stock.股票代號} - ${stock.股票名稱}`;
            stockCodeList.appendChild(codeOption);
            
            const nameOption = document.createElement('option');
            nameOption.value = stock.股票名稱;
            nameOption.textContent = `${stock.股票名稱} (${stock.股票代號})`;
            stockNameList.appendChild(nameOption);
        });

        // 股票代號輸入事件
        document.getElementById('stockCode').addEventListener('input', function(e) {
            const code = e.target.value.trim();
            if (stockMap[code]) {
                document.getElementById('stockName').value = stockMap[code].股票名稱;
                document.getElementById('industry').value = stockMap[code].市場產業;
            }
        });

        // 股票名稱輸入事件
        document.getElementById('stockName').addEventListener('input', function(e) {
            const name = e.target.value.trim();
            if (nameMap[name]) {
                document.getElementById('stockCode').value = nameMap[name].股票代號;
                document.getElementById('industry').value = nameMap[name].市場產業;
            }
        });

        let targetPrice = 0;
        let stopPrice = 0;
        let allRecords = [];

        window.addEventListener('load', function() {
            loadRecordsFromMemory();
            updateRecordCount();
            updateExportButton();
        });

        function loadRecordsFromMemory() {
            if (window.stockRecords) {
                allRecords = window.stockRecords;
            }
        }

        function updateRecordCount() {
            document.getElementById('count').textContent = allRecords.length;
        }

        function updateExportButton() {
            const exportBtn = document.querySelector('.export-btn');
            if (allRecords.length === 0) {
                exportBtn.disabled = true;
            } else {
                exportBtn.disabled = false;
            }
        }

        function changeValue(type, delta) {
            if (type === 'target') {
                targetPrice += delta;
                targetPrice = Math.max(0, targetPrice);
                document.getElementById('targetPrice').textContent = targetPrice.toFixed(2);
            } else if (type === 'stop') {
                stopPrice += delta;
                stopPrice = Math.max(0, stopPrice);
                document.getElementById('stopPrice').textContent = stopPrice.toFixed(2);
            }
        }

        function updateConfidence(value) {
            document.getElementById('confidenceValue').textContent = value;
        }

        function convertToCSV(records) {
            if (records.length === 0) return '';
            
            const headers = ['分析日期', '股票代號', '股票名稱', '市場產業', '目標價', '停損價', '信心度', 
                           '策略標籤', '市場情緒', '參考指標', '預判方向與進場理由', '分析內容', '額外備註'];
            
            let csv = '\uFEFF';
            csv += headers.join(',') + '\n';
            
            records.forEach(record => {
                const row = [
                    record.date,
                    record.stockCode,
                    record.stockName,
                    record.industry,
                    record.targetPrice,
                    record.stopPrice,
                    record.confidence,
                    record.strategy,
                    record.sentiment,
                    record.indicator,
                    `"${record.prediction.replace(/"/g, '""')}"`,
                    `"${record.analysis.replace(/"/g, '""')}"`,
                    `"${record.notes.replace(/"/g, '""')}"`
                ];
                csv += row.join(',') + '\n';
            });
            
            return csv;
        }

        function downloadCSV(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function exportToCSV() {
            if (allRecords.length === 0) {
                alert('⚠️ 沒有記錄可以匯出！');
                return;
            }

            const csv = convertToCSV(allRecords);
            
            const now = new Date();
            const filename = `股票分析記錄_${now.getFullYear()}${(now.getMonth()+1).toString().padStart(2,'0')}${now.getDate().toString().padStart(2,'0')}_${now.getHours()}${now.getMinutes()}.csv`;
            
            downloadCSV(csv, filename);
            
            alert('✅ CSV檔案已匯出！\n\n共匯出 ' + allRecords.length + ' 條記錄');
        }

        document.getElementById('analysisForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                date: document.getElementById('analysisDate').value,
                stockCode: document.getElementById('stockCode').value,
                stockName: document.getElementById('stockName').value,
                industry: document.getElementById('industry').value,
                targetPrice: targetPrice.toFixed(2),
                stopPrice: stopPrice.toFixed(2),
                confidence: document.getElementById('confidenceSlider').value,
                strategy: document.getElementById('strategy').value,
                sentiment: document.getElementById('sentiment').value,
                indicator: document.getElementById('indicator').value,
                prediction: document.getElementById('prediction').value,
                analysis: document.getElementById('analysis').value,
                notes: document.getElementById('notes').value
            };
            
            if (!formData.stockCode || !formData.stockName) {
                alert('⚠️ 請填寫股票代號和股票名稱！');
                return;
            }
            
            allRecords.push(formData);
            window.stockRecords = allRecords;
            
            updateRecordCount();
            updateExportButton();
            
            alert('✅ 記錄已新增！\n\n目前共有 ' + allRecords.length + ' 條記錄\n\n點擊「匯出CSV檔案」按鈕可以下載所有記錄');
            
            this.reset();
            targetPrice = 0;
            stopPrice = 0;
            document.getElementById('targetPrice').textContent = '0.00';
            document.getElementById('stopPrice').textContent = '0.00';
            document.getElementById('confidenceValue').textContent = '5';
            document.getElementById('confidenceSlider').value = 5;
            document.getElementById('industry').value = '';
            document.getElementById('analysisDate').value = '2025-09-30';
        });

        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
            });
        });
    </script>
</body>
</html>
