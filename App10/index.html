<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel å·¥ä½œè¡¨</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .toolbar {
            background: #f8f9fa;
            padding: 10px 15px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .toolbar h1 {
            margin: 0;
            font-size: 18px;
            color: #333;
        }
        
        .toolbar button {
            padding: 5px 12px;
            border: 1px solid #007bff;
            background: #007bff;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .toolbar button:hover {
            background: #0056b3;
        }
        
        .current-cell {
            margin-left: auto;
            font-weight: bold;
            color: #666;
        }
        
        .spreadsheet-container {
            overflow: auto;
            max-height: 600px;
            border: 1px solid #dee2e6;
        }
        
        .spreadsheet {
            display: table;
            border-collapse: collapse;
            background: white;
        }
        
        .row {
            display: table-row;
        }
        
        .cell, .header-cell {
            display: table-cell;
            border: 1px solid #dee2e6;
            min-width: 100px;
            height: 30px;
            position: relative;
            vertical-align: middle;
        }
        
        .header-cell {
            background: #f8f9fa;
            font-weight: bold;
            text-align: center;
            min-width: 80px;
            color: #666;
            user-select: none;
        }
        
        .row-header {
            min-width: 50px;
            background: #f8f9fa;
            font-weight: bold;
            text-align: center;
            color: #666;
            user-select: none;
        }
        
        .cell {
            cursor: cell;
            transition: background-color 0.1s;
        }
        
        .cell:hover {
            background-color: #f8f9fa;
        }
        
        .cell.selected {
            background-color: #e3f2fd;
            border: 2px solid #2196f3;
        }
        
        .cell-input {
            width: 100%;
            height: 100%;
            border: none;
            outline: none;
            padding: 5px;
            font-family: inherit;
            font-size: 14px;
            background: transparent;
        }
        
        .cell-content {
            padding: 5px;
            height: 20px;
            line-height: 20px;
            overflow: hidden;
            white-space: nowrap;
        }
        
        .status {
            padding: 10px 15px;
            background: #f8f9fa;
            border-top: 1px solid #dee2e6;
            font-size: 12px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="toolbar">
            <h1>ğŸ“Š Excel å·¥ä½œè¡¨</h1>
            <button onclick="saveData()">ğŸ’¾ å„²å­˜</button>
            <button onclick="clearAll()">ğŸ—‘ï¸ æ¸…é™¤å…¨éƒ¨</button>
            <button onclick="addRow()">â• æ–°å¢åˆ—</button>
            <button onclick="addColumn()">â• æ–°å¢æ¬„</button>
            <div class="current-cell" id="currentCell">A1</div>
        </div>
        
        <div class="spreadsheet-container">
            <div class="spreadsheet" id="spreadsheet">
                <!-- å·¥ä½œè¡¨å…§å®¹å°‡ç”± JavaScript ç”Ÿæˆ -->
            </div>
        </div>
        
        <div class="status" id="status">
            æº–å‚™å°±ç·’ - é»æ“Šä»»ä½•å„²å­˜æ ¼é–‹å§‹è¼¸å…¥æ•¸æ“š
        </div>
    </div>

    <script>
        // æ•¸æ“šå„²å­˜ç‰©ä»¶
        let spreadsheetData = {};
        let currentSelectedCell = null;
        let rows = 20;
        let cols = 10;

        // å°‡æ•¸å­—è½‰æ›ç‚ºå­—æ¯ (A, B, C...)
        function numberToLetter(num) {
            let result = '';
            while (num > 0) {
                num--;
                result = String.fromCharCode(65 + (num % 26)) + result;
                num = Math.floor(num / 26);
            }
            return result;
        }

        // ç”Ÿæˆå·¥ä½œè¡¨
        function generateSpreadsheet() {
            const spreadsheet = document.getElementById('spreadsheet');
            spreadsheet.innerHTML = '';

            // å»ºç«‹æ¨™é¡Œåˆ—
            const headerRow = document.createElement('div');
            headerRow.className = 'row';
            
            // å·¦ä¸Šè§’ç©ºç™½å„²å­˜æ ¼
            const cornerCell = document.createElement('div');
            cornerCell.className = 'header-cell row-header';
            headerRow.appendChild(cornerCell);

            // æ¬„æ¨™é¡Œ (A, B, C...)
            for (let col = 0; col < cols; col++) {
                const headerCell = document.createElement('div');
                headerCell.className = 'header-cell';
                headerCell.textContent = numberToLetter(col + 1);
                headerRow.appendChild(headerCell);
            }
            spreadsheet.appendChild(headerRow);

            // å»ºç«‹æ•¸æ“šåˆ—
            for (let row = 0; row < rows; row++) {
                const rowElement = document.createElement('div');
                rowElement.className = 'row';

                // åˆ—æ¨™é¡Œ (1, 2, 3...)
                const rowHeader = document.createElement('div');
                rowHeader.className = 'header-cell row-header';
                rowHeader.textContent = row + 1;
                rowElement.appendChild(rowHeader);

                // æ•¸æ“šå„²å­˜æ ¼
                for (let col = 0; col < cols; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    
                    const cellContent = document.createElement('div');
                    cellContent.className = 'cell-content';
                    cell.appendChild(cellContent);

                    // è¼‰å…¥å·²å„²å­˜çš„æ•¸æ“š
                    const cellKey = `${numberToLetter(col + 1)}${row + 1}`;
                    if (spreadsheetData[cellKey]) {
                        cellContent.textContent = spreadsheetData[cellKey];
                    }

                    cell.addEventListener('click', () => selectCell(cell));
                    cell.addEventListener('dblclick', () => editCell(cell));
                    
                    rowElement.appendChild(cell);
                }
                spreadsheet.appendChild(rowElement);
            }
        }

        // é¸æ“‡å„²å­˜æ ¼
        function selectCell(cell) {
            // ç§»é™¤ä¹‹å‰é¸æ“‡çš„å„²å­˜æ ¼æ¨£å¼
            if (currentSelectedCell) {
                currentSelectedCell.classList.remove('selected');
            }

            // é¸æ“‡æ–°çš„å„²å­˜æ ¼
            currentSelectedCell = cell;
            cell.classList.add('selected');

            // æ›´æ–°ç•¶å‰å„²å­˜æ ¼é¡¯ç¤º
            const row = parseInt(cell.dataset.row);
            const col = parseInt(cell.dataset.col);
            const cellName = `${numberToLetter(col + 1)}${row + 1}`;
            document.getElementById('currentCell').textContent = cellName;

            // æ›´æ–°ç‹€æ…‹åˆ—
            const content = cell.querySelector('.cell-content').textContent;
            document.getElementById('status').textContent = 
                `é¸æ“‡äº†å„²å­˜æ ¼ ${cellName}${content ? ': ' + content : ' (ç©ºç™½)'}`;
        }

        // ç·¨è¼¯å„²å­˜æ ¼
        function editCell(cell) {
            const cellContent = cell.querySelector('.cell-content');
            const currentValue = cellContent.textContent;

            // å»ºç«‹è¼¸å…¥æ¡†
            const input = document.createElement('input');
            input.className = 'cell-input';
            input.type = 'text';
            input.value = currentValue;

            // æ›¿æ›å…§å®¹
            cell.innerHTML = '';
            cell.appendChild(input);
            input.focus();
            input.select();

            // è™•ç†è¼¸å…¥å®Œæˆ
            function finishEdit() {
                const newValue = input.value;
                const row = parseInt(cell.dataset.row);
                const col = parseInt(cell.dataset.col);
                const cellKey = `${numberToLetter(col + 1)}${row + 1}`;

                // å„²å­˜æ•¸æ“š
                if (newValue.trim()) {
                    spreadsheetData[cellKey] = newValue;
                } else {
                    delete spreadsheetData[cellKey];
                }

                // æ¢å¾©é¡¯ç¤ºæ¨¡å¼
                cell.innerHTML = '';
                const newCellContent = document.createElement('div');
                newCellContent.className = 'cell-content';
                newCellContent.textContent = newValue;
                cell.appendChild(newCellContent);

                // é‡æ–°é¸æ“‡å„²å­˜æ ¼
                selectCell(cell);

                document.getElementById('status').textContent = 
                    `å·²æ›´æ–°å„²å­˜æ ¼ ${cellKey}: ${newValue || '(å·²æ¸…é™¤)'}`;
            }

            // äº‹ä»¶ç›£è½
            input.addEventListener('blur', finishEdit);
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    finishEdit();
                }
                if (e.key === 'Escape') {
                    // å–æ¶ˆç·¨è¼¯
                    cell.innerHTML = '';
                    const cellContent = document.createElement('div');
                    cellContent.className = 'cell-content';
                    cellContent.textContent = currentValue;
                    cell.appendChild(cellContent);
                    selectCell(cell);
                }
            });
        }

        // å„²å­˜æ•¸æ“šï¼ˆé¡¯ç¤ºå·²å„²å­˜çš„æ•¸æ“šï¼‰
        function saveData() {
            const dataCount = Object.keys(spreadsheetData).length;
            alert(`æ•¸æ“šå·²å„²å­˜ï¼\nå…±æœ‰ ${dataCount} å€‹å„²å­˜æ ¼åŒ…å«æ•¸æ“šã€‚\n\næ•¸æ“šå°‡åœ¨æ­¤æœƒè©±æœŸé–“ä¿æŒå¯ç”¨ã€‚`);
            document.getElementById('status').textContent = `å·²å„²å­˜ ${dataCount} å€‹å„²å­˜æ ¼çš„æ•¸æ“š`;
        }

        // æ¸…é™¤å…¨éƒ¨æ•¸æ“š
        function clearAll() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ•¸æ“šå—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
                spreadsheetData = {};
                generateSpreadsheet();
                document.getElementById('status').textContent = 'æ‰€æœ‰æ•¸æ“šå·²æ¸…é™¤';
            }
        }

        // æ–°å¢åˆ—
        function addRow() {
            rows += 5;
            generateSpreadsheet();
            document.getElementById('status').textContent = `å·²æ–°å¢ 5 åˆ—ï¼Œç›®å‰å…± ${rows} åˆ—`;
        }

        // æ–°å¢æ¬„
        function addColumn() {
            cols += 3;
            generateSpreadsheet();
            document.getElementById('status').textContent = `å·²æ–°å¢ 3 æ¬„ï¼Œç›®å‰å…± ${cols} æ¬„`;
        }

        // éµç›¤å¿«æ·éµ
        document.addEventListener('keydown', (e) => {
            if (!currentSelectedCell) return;

            const row = parseInt(currentSelectedCell.dataset.row);
            const col = parseInt(currentSelectedCell.dataset.col);

            let newRow = row;
            let newCol = col;

            switch(e.key) {
                case 'ArrowUp':
                    newRow = Math.max(0, row - 1);
                    e.preventDefault();
                    break;
                case 'ArrowDown':
                    newRow = Math.min(rows - 1, row + 1);
                    e.preventDefault();
                    break;
                case 'ArrowLeft':
                    newCol = Math.max(0, col - 1);
                    e.preventDefault();
                    break;
                case 'ArrowRight':
                    newCol = Math.min(cols - 1, col + 1);
                    e.preventDefault();
                    break;
                case 'Delete':
                    editCell(currentSelectedCell);
                    // æ¸…ç©ºè¼¸å…¥æ¡†
                    setTimeout(() => {
                        const input = currentSelectedCell.querySelector('.cell-input');
                        if (input) {
                            input.value = '';
                        }
                    }, 10);
                    e.preventDefault();
                    break;
                case 'F2':
                case 'Enter':
                    editCell(currentSelectedCell);
                    e.preventDefault();
                    break;
            }

            // ç§»å‹•åˆ°æ–°çš„å„²å­˜æ ¼
            if (newRow !== row || newCol !== col) {
                const newCell = document.querySelector(`[data-row="${newRow}"][data-col="${newCol}"]`);
                if (newCell) {
                    selectCell(newCell);
                }
            }
        });

        // åˆå§‹åŒ–å·¥ä½œè¡¨
        generateSpreadsheet();
        
        // é»˜èªé¸æ“‡ A1
        const firstCell = document.querySelector('[data-row="0"][data-col="0"]');
        if (firstCell) {
            selectCell(firstCell);
        }
    </script>
</body>
</html>
