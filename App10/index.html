<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel Â∑•‰ΩúË°®</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .toolbar {
            background: #f8f9fa;
            padding: 10px 15px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .toolbar h1 {
            margin: 0;
            font-size: 18px;
            color: #333;
        }
        
        .toolbar button {
            padding: 5px 12px;
            border: 1px solid #007bff;
            background: #007bff;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .toolbar button:hover {
            background: #0056b3;
        }
        
        .current-cell {
            margin-left: auto;
            font-weight: bold;
            color: #666;
        }
        
        .spreadsheet-container {
            overflow: auto;
            max-height: 600px;
            border: 1px solid #dee2e6;
        }
        
        .spreadsheet {
            display: table;
            border-collapse: collapse;
            background: white;
        }
        
        .row {
            display: table-row;
        }
        
        .cell, .header-cell {
            display: table-cell;
            border: 1px solid #dee2e6;
            min-width: 100px;
            height: 30px;
            position: relative;
            vertical-align: middle;
        }
        
        .header-cell {
            background: #f8f9fa;
            font-weight: bold;
            text-align: center;
            min-width: 80px;
            color: #666;
            user-select: none;
        }
        
        .row-header {
            min-width: 50px;
            background: #f8f9fa;
            font-weight: bold;
            text-align: center;
            color: #666;
            user-select: none;
        }
        
        .cell {
            cursor: cell;
            transition: background-color 0.1s;
        }
        
        .cell:hover {
            background-color: #f8f9fa;
        }
        
        .cell.selected {
            background-color: #e3f2fd;
            border: 2px solid #2196f3;
        }
        
        .cell-input {
            width: 100%;
            height: 100%;
            border: none;
            outline: none;
            padding: 5px;
            font-family: inherit;
            font-size: 14px;
            background: transparent;
        }
        
        .cell-content {
            padding: 5px;
            height: 20px;
            line-height: 20px;
            overflow: hidden;
            white-space: nowrap;
        }
        
        .status {
            padding: 10px 15px;
            background: #f8f9fa;
            border-top: 1px solid #dee2e6;
            font-size: 12px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="toolbar">
            <h1>üìä Excel Â∑•‰ΩúË°®</h1>
            <button onclick="saveData()">üíæ ÂÑ≤Â≠ò</button>
            <button onclick="clearAll()">üóëÔ∏è Ê∏ÖÈô§ÂÖ®ÈÉ®</button>
            <button onclick="addRow()">‚ûï Êñ∞Â¢ûÂàó</button>
            <button onclick="addColumn()">‚ûï Êñ∞Â¢ûÊ¨Ñ</button>
            <div class="current-cell" id="currentCell">A1</div>
        </div>
        
        <div class="spreadsheet-container">
            <div class="spreadsheet" id="spreadsheet">
                <!-- Â∑•‰ΩúË°®ÂÖßÂÆπÂ∞áÁî± JavaScript ÁîüÊàê -->
            </div>
        </div>
        
        <div class="status" id="status">
            Ê∫ñÂÇôÂ∞±Á∑í - ÈªûÊìä‰ªª‰ΩïÂÑ≤Â≠òÊ†ºÈñãÂßãËº∏ÂÖ•Êï∏Êìö
        </div>
    </div>

    <script>
        // Êï∏ÊìöÂÑ≤Â≠òÁâ©‰ª∂
        let spreadsheetData = {};
        let currentSelectedCell = null;
        let rows = 20;
        let cols = 10;

        // Â∞áÊï∏Â≠óËΩâÊèõÁÇ∫Â≠óÊØç (A, B, C...)
        function numberToLetter(num) {
            let result = '';
            while (num > 0) {
                num--;
                result = String.fromCharCode(65 + (num % 26)) + result;
                num = Math.floor(num / 26);
            }
            return result;
        }

        // ÁîüÊàêÂ∑•‰ΩúË°®
        function generateSpreadsheet() {
            const spreadsheet = document.getElementById('spreadsheet');
            spreadsheet.innerHTML = '';

            // Âª∫Á´ãÊ®ôÈ°åÂàó
            const headerRow = document.createElement('div');
            headerRow.className = 'row';
            
            // Â∑¶‰∏äËßíÁ©∫ÁôΩÂÑ≤Â≠òÊ†º
            const cornerCell = document.createElement('div');
            cornerCell.className = 'header-cell row-header';
            headerRow.appendChild(cornerCell);

            // Ê¨ÑÊ®ôÈ°å (A, B, C...)
            for (let col = 0; col < cols; col++) {
                const headerCell = document.createElement('div');
                headerCell.className = 'header-cell';
                headerCell.textContent = numberToLetter(col + 1);
                headerRow.appendChild(headerCell);
            }
            spreadsheet.appendChild(headerRow);

            // Âª∫Á´ãÊï∏ÊìöÂàó
            for (let row = 0; row < rows; row++) {
                const rowElement = document.createElement('div');
                rowElement.className = 'row';

                // ÂàóÊ®ôÈ°å (1, 2, 3...)
                const rowHeader = document.createElement('div');
                rowHeader.className = 'header-cell row-header';
                rowHeader.textContent = row + 1;
                rowElement.appendChild(rowHeader);

                // Êï∏ÊìöÂÑ≤Â≠òÊ†º
                for (let col = 0; col < cols; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    
                    const cellContent = document.createElement('div');
                    cellContent.className = 'cell-content';
                    cell.appendChild(cellContent);

                    // ËºâÂÖ•Â∑≤ÂÑ≤Â≠òÁöÑÊï∏Êìö
                    const cellKey = `${numberToLetter(col + 1)}${row + 1}`;
                    if (spreadsheetData[cellKey]) {
                        cellContent.textContent = spreadsheetData[cellKey];
                    }

                    cell.addEventListener('click', () => selectCell(cell));
                    cell.addEventListener('dblclick', () => editCell(cell));
                    
                    rowElement.appendChild(cell);
                }
                spreadsheet.appendChild(rowElement);
            }
        }

        // ÈÅ∏ÊìáÂÑ≤Â≠òÊ†º
        function selectCell(cell) {
            // ÁßªÈô§‰πãÂâçÈÅ∏ÊìáÁöÑÂÑ≤Â≠òÊ†ºÊ®£Âºè
            if (currentSelectedCell) {
                currentSelectedCell.classList.remove('selected');
            }

            // ÈÅ∏ÊìáÊñ∞ÁöÑÂÑ≤Â≠òÊ†º
            currentSelectedCell = cell;
            cell.classList.add('selected');

            // Êõ¥Êñ∞Áï∂ÂâçÂÑ≤Â≠òÊ†ºÈ°ØÁ§∫
            const row = parseInt(cell.dataset.row);
            const col = parseInt(cell.dataset.col);
            const cellName = `${numberToLetter(col + 1)}${row + 1}`;
            document.getElementById('currentCell').textContent = cellName;

            // Êõ¥Êñ∞ÁãÄÊÖãÂàó
            const content = cell.querySelector('.cell-content').textContent;
            document.getElementById('status').textContent = 
                `ÈÅ∏Êìá‰∫ÜÂÑ≤Â≠òÊ†º ${cellName}${content ? ': ' + content : ' (Á©∫ÁôΩ)'}`;
        }

        // Á∑®ËºØÂÑ≤Â≠òÊ†º
        function editCell(cell) {
            const cellContent = cell.querySelector('.cell-content');
            const currentValue = cellContent.textContent;

            // Âª∫Á´ãËº∏ÂÖ•Ê°Ü
            const input = document.createElement('input');
            input.className = 'cell-input';
            input.type = 'text';
            input.value = currentValue;

            // ÊõøÊèõÂÖßÂÆπ
            cell.innerHTML = '';
            cell.appendChild(input);
            input.focus();
            input.select();

            // ËôïÁêÜËº∏ÂÖ•ÂÆåÊàê
            function finishEdit() {
                const newValue = input.value;
                const row = parseInt(cell.dataset.row);
                const col = parseInt(cell.dataset.col);
                const cellKey = `${numberToLetter(col + 1)}${row + 1}`;

                // ÂÑ≤Â≠òÊï∏Êìö
                if (newValue.trim()) {
                    spreadsheetData[cellKey] = newValue;
                } else {
                    delete spreadsheetData[cellKey];
                }

                // ÊÅ¢Âæ©È°ØÁ§∫Ê®°Âºè
                cell.innerHTML = '';
                const newCellContent = document.createElement('div');
                newCellContent.className = 'cell-content';
                newCellContent.textContent = newValue;
                cell.appendChild(newCellContent);

                // ÈáçÊñ∞ÈÅ∏ÊìáÂÑ≤Â≠òÊ†º
                selectCell(cell);

                document.getElementById('status').textContent = 
                    `Â∑≤Êõ¥Êñ∞ÂÑ≤Â≠òÊ†º ${cellKey}: ${newValue || '(Â∑≤Ê∏ÖÈô§)'}`;
            }

            // ‰∫ã‰ª∂Áõ£ËÅΩ
            input.addEventListener('blur', finishEdit);
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    finishEdit();
                }
                if (e.key === 'Escape') {
                    // ÂèñÊ∂àÁ∑®ËºØ
                    cell.innerHTML = '';
                    const cellContent = document.createElement('div');
                    cellContent.className = 'cell-content';
                    cellContent.textContent = currentValue;
                    cell.appendChild(cellContent);
                    selectCell(cell);
                }
            });
        }

        // ÂÑ≤Â≠òÊï∏ÊìöÔºàÈ°ØÁ§∫Â∑≤ÂÑ≤Â≠òÁöÑÊï∏ÊìöÔºâ
        function saveData() {
            const dataCount = Object.keys(spreadsheetData).length;
            alert(`Êï∏ÊìöÂ∑≤ÂÑ≤Â≠òÔºÅ\nÂÖ±Êúâ ${dataCount} ÂÄãÂÑ≤Â≠òÊ†ºÂåÖÂê´Êï∏Êìö„ÄÇ\n\nÊï∏ÊìöÂ∞áÂú®Ê≠§ÊúÉË©±ÊúüÈñì‰øùÊåÅÂèØÁî®„ÄÇ`);
            document.getElementById('status').textContent = `Â∑≤ÂÑ≤Â≠ò ${dataCount} ÂÄãÂÑ≤Â≠òÊ†ºÁöÑÊï∏Êìö`;
        }

        // Ê∏ÖÈô§ÂÖ®ÈÉ®Êï∏Êìö
        function clearAll() {
            if (confirm('Á¢∫ÂÆöË¶ÅÊ∏ÖÈô§ÊâÄÊúâÊï∏ÊìöÂóéÔºüÊ≠§Êìç‰ΩúÁÑ°Ê≥ïÂæ©Âéü„ÄÇ')) {
                spreadsheetData = {};
                generateSpreadsheet();
                document.getElementById('status').textContent = 'ÊâÄÊúâÊï∏ÊìöÂ∑≤Ê∏ÖÈô§';
            }
        }

        // Êñ∞Â¢ûÂàó
        function addRow() {
            rows += 5;
            generateSpreadsheet();
            document.getElementById('status').textContent = `Â∑≤Êñ∞Â¢û 5 ÂàóÔºåÁõÆÂâçÂÖ± ${rows} Âàó`;
        }

        // Êñ∞Â¢ûÊ¨Ñ
        function addColumn() {
            cols += 3;
            generateSpreadsheet();
            document.getElementById('status').textContent = `Â∑≤Êñ∞Â¢û 3 Ê¨ÑÔºåÁõÆÂâçÂÖ± ${cols} Ê¨Ñ`;
        }

        // ÈçµÁõ§Âø´Êç∑Èçµ
        document.addEventListener('keydown', (e) => {
            if (!currentSelectedCell) return;

            const row = parseInt(currentSelectedCell.dataset.row);
            const col = parseInt(currentSelectedCell.dataset.col);

            let newRow = row;
            let newCol = col;

            switch(e.key) {
                case 'ArrowUp':
                    newRow = Math.max(0, row - 1);
                    e.preventDefault();
                    break;
                case 'ArrowDown':
                    newRow = Math.min(rows - 1, row + 1);
                    e.preventDefault();
                    break;
                case 'ArrowLeft':
                    newCol = Math.max(0, col - 1);
                    e.preventDefault();
                    break;
                case 'ArrowRight':
                    newCol = Math.min(cols - 1, col + 1);
                    e.preventDefault();
                    break;
                case 'Delete':
                    editCell(currentSelectedCell);
                    // Ê∏ÖÁ©∫Ëº∏ÂÖ•Ê°Ü
                    setTimeout(() => {
                        const input = currentSelectedCell.querySelector('.cell-input');
                        if (input) {
                            input.value = '';
                        }
                    }, 10);
                    e.preventDefault();
                    break;
                case 'F2':
                case 'Enter':
                    editCell(currentSelectedCell);
                    e.preventDefault();
                    break;
            }

            // ÁßªÂãïÂà∞Êñ∞ÁöÑÂÑ≤Â≠òÊ†º
            if (newRow !== row || newCol !== col) {
                const newCell = document.querySelector(`[data-row="${newRow}"][data-col="${newCol}"]`);
                if (newCell) {
                    selectCell(newCell);
                }
            }
        });

        // ÂàùÂßãÂåñÂ∑•‰ΩúË°®
        generateSpreadsheet();
        
        // ÈªòË™çÈÅ∏Êìá A1
        const firstCell = document.querySelector('[data-row="0"][data-col="0"]');
        if (firstCell) {
            selectCell(firstCell);
        }
    </script>
</body>
</html>
