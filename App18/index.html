<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>調酒酒譜瀏覽</title>

    <!-- PapaParse 供 CSV 解析 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js" defer></script>

    <!-- 樣式 -->
    <link rel="stylesheet" href="style.css" />
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#667eea">
</head>

<body>
    <header class="topbar">
        <div class="brand">🍸 調酒酒譜 WebApp</div>
        <div class="actions">
            <button id="btnPickFolder" class="btn btn-accent" type="button">選擇資料夾</button>
            <button id="btnWriteCSV" class="btn btn-accent" type="button">寫入 recipes.csv</button>
            <button id="btnExport" class="btn btn-accent" type="button">匯出 CSV</button>
        </div>
    </header>

    <div class="container">
        <header>
            <h1>🍸 調酒酒譜瀏覽</h1>
            <p class="subtitle">探索經典與創意調酒，享受微醺時光</p>
            <nav class="nav-tabs">
                <button class="nav-btn active" data-page="browse" type="button">📖 瀏覽酒譜</button>
                <button class="nav-btn" data-page="add" type="button">➕ 新增酒譜</button>
            </nav>
        </header>

        <!-- 瀏覽區 -->
        <div class="page active" id="browsePage">
            <div class="filters">
                <div class="filter-row">
                    <input type="text" id="searchInput" placeholder="🔍 搜尋酒名、材料或標籤..." />
                    <select id="categorySelect">
                        <option value="">📋 全部分類</option>
                    </select>
                    <div class="view-toggle">
                        <button class="view-btn active" data-view="grid" type="button">網格</button>
                        <button class="view-btn" data-view="list" type="button">列表</button>
                    </div>
                </div>
            </div>

            <div class="stats" id="stats">載入中...</div>
            <div id="recipesContainer" class="recipes-grid">
                <div class="loading">正在載入酒譜資料</div>
            </div>
        </div>

        <!-- 新增區 -->
        <div class="page" id="addPage">
            <div class="add-recipe-form">
                <div class="success-message" id="successMessage">✅ 酒譜新增成功！</div>

                <form id="addRecipeForm">
                    <div class="form-section">
                        <h3>📝 基本資訊</h3>
                        <div class="form-group">
                            <label for="recipeTitle">酒名 *</label>
                            <input type="text" id="recipeTitle" required placeholder="例如：瑪格麗特" />
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="recipeCategory">分類</label>
                                <select id="recipeCategory">
                                    <option value="">選擇分類</option>
                                    <option value="Cocktail">Cocktail</option>
                                    <option value="Mocktail">Mocktail</option>
                                    <option value="Coffe">Coffe</option>
                                    <option value="Tea">Tea</option>
                                    <option value="Juice">Juice</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="recipeServings">份量</label>
                                <input type="number" id="recipeServings" min="1" placeholder="杯數" />
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="glass">杯款</label>
                                <input type="text" id="glass" placeholder="馬丁尼杯" />
                            </div>
                            <div class="form-group">
                                <label for="method">作法</label>
                                <input type="text" id="method" placeholder="攪拌法" />
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>🏷️ 標籤</h3>
                        <div class="tags-input">
                            <input type="text" id="tagsInput" placeholder="輸入標籤後按 Enter（例如：酸甜）" />
                            <div class="tags-display" id="tagsDisplay"></div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>🍶 材料</h3>
                        <div class="ingredients-list" id="ingredientsList">
                            <div class="ingredient-item">
                                <input type="text" placeholder="例如：龍舌蘭 45ml" required />
                                <button type="button" class="remove-btn"
                                    onclick="app.removeIngredient(this)">移除</button>
                            </div>
                        </div>
                        <button type="button" class="add-btn" onclick="app.addIngredient()">➕ 新增材料</button>
                    </div>

                    <div class="form-section">
                        <h3>🧊 調製步驟</h3>
                        <div class="steps-list" id="stepsList">
                            <div class="step-item">
                                <span style="font-weight: bold; min-width: 30px;">1.</span>
                                <input type="text" placeholder="詳細描述第一個步驟（例：搖盪 10 秒）" required />
                                <button type="button" class="remove-btn" onclick="app.removeStep(this)">移除</button>
                            </div>
                        </div>
                        <button type="button" class="add-btn" onclick="app.addStep()">➕ 新增步驟</button>
                    </div>

                    <div class="form-section">
                        <h3>🖼️ 上傳圖片（選填）</h3>
                        <div class="form-group">
                            <label for="recipeImageFile">選擇圖片檔案</label>
                            <input type="file" id="recipeImageFile" accept="image/*" />
                            <div id="addImagePreview" style="margin-top: 12px;"></div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="app.clearForm()">清空表單</button>
                        <button type="submit" class="btn btn-primary">💾 儲存酒譜</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 資料與功能 -->
    <script src="data.js" defer></script>
    <script src="app.js" defer></script>

    <!-- 編輯抽屜 -->
    <aside id="editDrawer" class="drawer hidden" aria-hidden="true">
        <div class="drawer-header">
            <h3>編輯酒譜</h3>
            <button id="closeDrawer" class="btn btn-secondary" type="button">關閉</button>
        </div>
        <form id="editForm" class="edit-form">
            <label>酒名</label>
            <input name="title" type="text" required>
            <label>分類</label>
            <input name="category" type="text">
            <label>標籤（分號分隔）</label>
            <input name="tags" type="text">
            <label>材料（每項以 | 分隔）</label>
            <textarea name="ingredients" rows="3"></textarea>
            <label>調製步驟（多行）</label>
            <textarea name="steps" rows="5"></textarea>
            <div class="grid-2">
                <div>
                    <label>杯款</label>
                    <input name="glass" type="text">
                </div>
                <div>
                    <label>作法</label>
                    <input name="method" type="text">
                </div>
            </div>
            <div class="grid-2">
                <div>
                    <label>份量（杯）</label>
                    <input name="servings" type="number" min="1">
                </div>
            </div>
            <label>圖片網址或上傳新圖片</label>
            <input name="image_url" type="text" placeholder="相對路徑 / 連結均可">
            <input id="imageFile" name="image_file" type="file" accept="image/*">
            <div id="imagePreview" style="margin:8px 0;"></div>
            <div class="drawer-actions">
                <button id="saveRecipe" class="btn" type="button">儲存</button>
                <button id="deleteRecipe" class="btn btn-danger" type="button">刪除</button>
            </div>
        </form>
    </aside>

    <script>
        (function () {
            function registerSW() {
                if ("serviceWorker" in navigator) {
                    navigator.serviceWorker.register("./sw.js").catch(console.error);
                }
            }
            function onceReady(fn) {
                if (document.readyState !== "loading") fn();
                else document.addEventListener("DOMContentLoaded", fn);
            }
            onceReady(registerSW);
        })();
    </script>
</body>

</html>