<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yahoo Finance è‚¡ç¥¨åˆ†æç³»ç»Ÿ (CORSè§£å†³æ–¹æ¡ˆ)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .cors-info {
            background: rgba(52, 152, 219, 0.1);
            border: 2px solid #3498db;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .cors-solutions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .solution-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .solution-card:hover {
            transform: translateY(-5px);
        }

        .solution-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .solution-description {
            color: #7f8c8d;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .solution-pros {
            background: #e8f5e8;
            color: #27ae60;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .solution-cons {
            background: #ffebee;
            color: #e74c3c;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
            text-decoration: none;
            text-align: center;
            color: white;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #229954);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }

        .btn-info {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .demo-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .proxy-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .proxy-option {
            padding: 15px;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .proxy-option:hover {
            border-color: #3498db;
            background: rgba(52, 152, 219, 0.1);
        }

        .proxy-option.active {
            border-color: #27ae60;
            background: rgba(39, 174, 96, 0.1);
        }

        .proxy-url {
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 0.9rem;
            margin-top: 8px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-connected { background: #27ae60; }
        .status-loading { background: #f39c12; }
        .status-error { background: #e74c3c; }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .control-item {
            display: flex;
            flex-direction: column;
        }

        .control-item label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }

        .control-item input,
        .control-item select {
            padding: 12px 15px;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .control-item input:focus,
        .control-item select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .metric-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .alert-error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
        }

        .alert-success {
            background: #e8f5e8;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
        }

        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            margin: 15px 0;
        }

        .tab-container {
            margin-bottom: 20px;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .tab-button {
            padding: 10px 20px;
            border: 2px solid #ecf0f1;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-button.active {
            border-color: #3498db;
            background: #3498db;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .cors-solutions {
                grid-template-columns: 1fr;
            }

            .proxy-selector {
                grid-template-columns: 1fr;
            }

            .controls {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <h1>ğŸ› ï¸ Yahoo Finance API - CORSè§£å†³æ–¹æ¡ˆ</h1>
            <p>è§£å†³è·¨åŸŸé™åˆ¶ï¼Œå®ç°ç¨³å®šçš„è‚¡ç¥¨æ•°æ®è·å–</p>
        </div>

        <!-- CORSé—®é¢˜è¯´æ˜ -->
        <div class="cors-info">
            <h3 style="color: #3498db; margin-bottom: 15px;">ğŸš« ä¸ºä»€ä¹ˆä¼šå‡ºç°"Failed to fetch"é”™è¯¯ï¼Ÿ</h3>
            <p style="margin-bottom: 10px;"><strong>CORS (è·¨åŸŸèµ„æºå…±äº«) é™åˆ¶:</strong> Yahoo Finance APIä¸å…è®¸ç›´æ¥ä»æµè§ˆå™¨ç«¯è·¨åŸŸè®¿é—®ï¼Œè¿™æ˜¯ä¸€ç§å®‰å…¨æœºåˆ¶ã€‚</p>
            <p><strong>è§£å†³æ–¹æ¡ˆ:</strong> éœ€è¦é€šè¿‡ä»£ç†æœåŠ¡å™¨æˆ–å…¶ä»–æ–¹å¼ç»•è¿‡CORSé™åˆ¶ã€‚</p>
        </div>

        <!-- è§£å†³æ–¹æ¡ˆé€‰é¡¹ -->
        <div class="cors-solutions">
            <div class="solution-card">
                <div class="solution-title">
                    ğŸŒ æ–¹æ¡ˆ1: å…è´¹CORSä»£ç†
                </div>
                <div class="solution-description">
                    ä½¿ç”¨å…¬å…±CORSä»£ç†æœåŠ¡ï¼Œæ— éœ€é…ç½®å³å¯ä½¿ç”¨
                </div>
                <div class="solution-pros">
                    âœ… å®Œå…¨å…è´¹<br>
                    âœ… æ— éœ€é…ç½®<br>
                    âœ… ç«‹å³å¯ç”¨
                </div>
                <div class="solution-cons">
                    âŒ ç¨³å®šæ€§ä¸€èˆ¬<br>
                    âŒ å¯èƒ½æœ‰é€Ÿåº¦é™åˆ¶<br>
                    âŒ ä¾èµ–ç¬¬ä¸‰æ–¹æœåŠ¡
                </div>
                <button class="btn btn-primary" onclick="switchToProxyMode()">ä½¿ç”¨ä»£ç†æ¨¡å¼</button>
            </div>

            <div class="solution-card">
                <div class="solution-title">
                    ğŸ”§ æ–¹æ¡ˆ2: æœ¬åœ°ä»£ç†æœåŠ¡å™¨
                </div>
                <div class="solution-description">
                    è¿è¡Œç®€å•çš„Node.jsä»£ç†æœåŠ¡å™¨
                </div>
                <div class="solution-pros">
                    âœ… å®Œå…¨æ§åˆ¶<br>
                    âœ… é«˜ç¨³å®šæ€§<br>
                    âœ… æ— é€Ÿåº¦é™åˆ¶
                </div>
                <div class="solution-cons">
                    âŒ éœ€è¦æŠ€æœ¯é…ç½®<br>
                    âŒ éœ€è¦è¿è¡ŒæœåŠ¡å™¨<br>
                    âŒ é€‚åˆå¼€å‘è€…
                </div>
                <button class="btn btn-success" onclick="showLocalSetup()">æŸ¥çœ‹é…ç½®</button>
            </div>

            <div class="solution-card">
                <div class="solution-title">
                    â˜ï¸ æ–¹æ¡ˆ3: äº‘ç«¯éƒ¨ç½²
                </div>
                <div class="solution-description">
                    éƒ¨ç½²åˆ°Vercelã€Netlifyç­‰äº‘å¹³å°
                </div>
                <div class="solution-pros">
                    âœ… ä¸“ä¸šç¨³å®š<br>
                    âœ… è‡ªåŠ¨æ‰©å±•<br>
                    âœ… å…¨çƒCDN
                </div>
                <div class="solution-cons">
                    âŒ éœ€è¦éƒ¨ç½²é…ç½®<br>
                    âŒ å¯èƒ½æœ‰è´¹ç”¨<br>
                    âŒ è¾ƒå¤æ‚
                </div>
                <button class="btn btn-warning" onclick="showCloudSetup()">æŸ¥çœ‹éƒ¨ç½²</button>
            </div>

            <div class="solution-card">
                <div class="solution-title">
                    ğŸ”„ æ–¹æ¡ˆ4: æ›¿ä»£API
                </div>
                <div class="solution-description">
                    ä½¿ç”¨å…¶ä»–æ”¯æŒCORSçš„è‚¡ç¥¨API
                </div>
                <div class="solution-pros">
                    âœ… åŸç”Ÿæ”¯æŒCORS<br>
                    âœ… ä¸“ä¸šæ•°æ®æº<br>
                    âœ… æ–‡æ¡£å®Œå–„
                </div>
                <div class="solution-cons">
                    âŒ å¯èƒ½éœ€è¦APIå¯†é’¥<br>
                    âŒ å¯èƒ½æœ‰è´¹ç”¨<br>
                    âŒ åŠŸèƒ½é™åˆ¶
                </div>
                <button class="btn btn-info" onclick="showAlternativeAPIs()">æŸ¥çœ‹æ›¿ä»£</button>
            </div>
        </div>

        <!-- ä»£ç†æ¨¡å¼æ¼”ç¤º -->
        <div class="demo-section">
            <h3 style="margin-bottom: 20px;">ğŸŒ CORSä»£ç†æ¨¡å¼æ¼”ç¤º</h3>
            
            <div class="status-indicator">
                <div class="status-dot status-error" id="statusDot"></div>
                <span id="statusText">é€‰æ‹©ä»£ç†æœåŠ¡å™¨</span>
            </div>

            <div class="proxy-selector">
                <div class="proxy-option" onclick="selectProxy('cors-anywhere')">
                    <strong>CORS Anywhere</strong>
                    <div class="proxy-url">cors-anywhere.herokuapp.com</div>
                    <small>éœ€è¦æ¿€æ´»è®¿é—®æƒé™</small>
                </div>
                <div class="proxy-option" onclick="selectProxy('allorigins')">
                    <strong>AllOrigins</strong>
                    <div class="proxy-url">api.allorigins.win</div>
                    <small>ç¨³å®šæ€§è¾ƒå¥½</small>
                </div>
                <div class="proxy-option" onclick="selectProxy('corsproxy')">
                    <strong>CORS Proxy</strong>
                    <div class="proxy-url">corsproxy.io</div>
                    <small>é€Ÿåº¦è¾ƒå¿«</small>
                </div>
                <div class="proxy-option" onclick="selectProxy('thingproxy')">
                    <strong>ThingProxy</strong>
                    <div class="proxy-url">thingproxy.freeboard.io</div>
                    <small>ç®€å•æ˜“ç”¨</small>
                </div>
            </div>

            <div class="controls">
                <div class="control-item">
                    <label>è‚¡ç¥¨ä»£ç </label>
                    <input type="text" id="symbolInput" placeholder="ä¾‹å¦‚: AAPL, TSLA" value="AAPL">
                </div>
                <div class="control-item">
                    <label>æ—¶é—´èŒƒå›´</label>
                    <select id="periodSelect">
                        <option value="1d">1å¤©</option>
                        <option value="5d">5å¤©</option>
                        <option value="1mo">1ä¸ªæœˆ</option>
                    </select>
                </div>
            </div>

            <button class="btn btn-primary" id="testBtn" onclick="testProxyConnection()" disabled>
                ğŸ” æµ‹è¯•è¿æ¥
            </button>

            <div class="alert alert-error" id="errorAlert">
                <strong>âŒ é”™è¯¯:</strong> <span id="errorMessage"></span>
            </div>
            <div class="alert alert-success" id="successAlert">
                <strong>âœ… æˆåŠŸ:</strong> <span id="successMessage"></span>
            </div>

            <div class="metrics-grid" id="metricsGrid" style="display: none;">
                <div class="metric-card">
                    <div class="metric-value" id="currentPrice">--</div>
                    <div class="metric-label">å½“å‰ä»·æ ¼</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="priceChange">--</div>
                    <div class="metric-label">æ¶¨è·Œå¹…</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="volume">--</div>
                    <div class="metric-label">æˆäº¤é‡</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="responseTime">--</div>
                    <div class="metric-label">å“åº”æ—¶é—´</div>
                </div>
            </div>

            <div class="chart-container" id="chartContainer" style="display: none;">
                <h4>ä»·æ ¼èµ°åŠ¿å›¾</h4>
                <div class="chart-wrapper">
                    <canvas id="priceChart"></canvas>
                </div>
            </div>
        </div>

        <!-- æŠ€æœ¯æ–¹æ¡ˆè¯¦è§£ -->
        <div class="demo-section">
            <div class="tab-container">
                <div class="tab-buttons">
                    <button class="tab-button active" onclick="showTab('proxy-setup')">ä»£ç†è®¾ç½®</button>
                    <button class="tab-button" onclick="showTab('local-server')">æœ¬åœ°æœåŠ¡å™¨</button>
                    <button class="tab-button" onclick="showTab('cloud-deploy')">äº‘ç«¯éƒ¨ç½²</button>
                    <button class="tab-button" onclick="showTab('alternative-apis')">æ›¿ä»£API</button>
                </div>

                <div class="tab-content active" id="proxy-setup">
                    <h4>ğŸŒ ä½¿ç”¨CORSä»£ç†çš„å®Œæ•´ä»£ç </h4>
                    <div class="code-block">
// ä½¿ç”¨AllOriginsä»£ç†çš„ç¤ºä¾‹
async function fetchWithProxy(symbol) {
    const yahooUrl = `https://query1.finance.yahoo.com/v8/finance/chart/${symbol}`;
    const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(yahooUrl)}`;
    
    try {
        const response = await fetch(proxyUrl);
        const data = await response.json();
        const yahooData = JSON.parse(data.contents);
        return yahooData;
    } catch (error) {
        console.error('ä»£ç†è¯·æ±‚å¤±è´¥:', error);
        throw error;
    }
}

// ä½¿ç”¨ç¤ºä¾‹
fetchWithProxy('AAPL').then(data => {
    console.log('è‚¡ç¥¨æ•°æ®:', data);
});
                    </div>
                    <p><strong>ä¼˜ç‚¹:</strong> æ— éœ€é¢å¤–é…ç½®ï¼Œç›´æ¥åœ¨å‰ç«¯ä½¿ç”¨</p>
                    <p><strong>ç¼ºç‚¹:</strong> ä¾èµ–ç¬¬ä¸‰æ–¹æœåŠ¡ï¼Œå¯èƒ½ä¸ç¨³å®š</p>
                </div>

                <div class="tab-content" id="local-server">
                    <h4>ğŸ”§ Node.jsæœ¬åœ°ä»£ç†æœåŠ¡å™¨</h4>
                    <div class="code-block">
// proxy-server.js
const express = require('express');
const cors = require('cors');
const fetch = require('node-fetch');

const app = express();
app.use(cors());

app.get('/api/yahoo/:symbol', async (req, res) => {
    const { symbol } = req.params;
    const { period1, period2, interval } = req.query;
    
    const yahooUrl = `https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?period1=${period1}&period2=${period2}&interval=${interval}`;
    
    try {
        const response = await fetch(yahooUrl);
        const data = await response.json();
        res.json(data);
    } catch (error) {
        res.status(500).json({ error: error.message });
    }
});

app.listen(3001, () => {
    console.log('ä»£ç†æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3001');
});
                    </div>
                    <p><strong>å®‰è£…:</strong> <code>npm install express cors node-fetch</code></p>
                    <p><strong>è¿è¡Œ:</strong> <code>node proxy-server.js</code></p>
                    <p><strong>å‰ç«¯è°ƒç”¨:</strong> <code>fetch('http://localhost:3001/api/yahoo/AAPL')</code></p>
                </div>

                <div class="tab-content" id="cloud-deploy">
                    <h4>â˜ï¸ Verceläº‘ç«¯éƒ¨ç½²</h4>
                    <div class="code-block">
// api/yahoo/[symbol].js (Vercel API Routes)
export default async function handler(req, res) {
    const { symbol } = req.query;
    const { period1, period2, interval } = req.query;
    
    // å¯ç”¨CORS
    res.setHeader('Access-Control-Allow-Origin', '*');
    res.setHeader('Access-Control-Allow-Methods', 'GET');
    
    const yahooUrl = `https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?period1=${period1}&period2=${period2}&interval=${interval}`;
    
    try {
        const response = await fetch(yahooUrl);
        const data = await response.json();
        res.json(data);
    } catch (error) {
        res.status(500).json({ error: error.message });
    }
}
                    </div>
                    <p><strong>éƒ¨ç½²:</strong> ç›´æ¥æ¨é€åˆ°GitHubï¼Œè¿æ¥Vercelè‡ªåŠ¨éƒ¨ç½²</p>
                    <p><strong>è®¿é—®:</strong> <code>https://your-app.vercel.app/api/yahoo/AAPL</code></p>
                </div>

                <div class="tab-content" id="alternative-apis">
                    <h4>ğŸ”„ æ”¯æŒCORSçš„æ›¿ä»£API</h4>
                    <div class="code-block">
// 1. Alpha Vantage (å…è´¹ï¼Œéœ€è¦APIå¯†é’¥)
const apiKey = 'YOUR_API_KEY';
const url = `https://www.alphavantage.co/query?function=TIME_SERIES_INTRADAY&symbol=AAPL&interval=5min&apikey=${apiKey}`;

// 2. Finnhub (å…è´¹tierï¼ŒåŸç”Ÿæ”¯æŒCORS)
const finnhubToken = 'YOUR_TOKEN';
const url = `https://finnhub.io/api/v1/quote?symbol=AAPL&token=${finnhubToken}`;

// 3. IEX Cloud (ä»˜è´¹ï¼Œä¸“ä¸šæ•°æ®)
const iexToken = 'YOUR_TOKEN';
const url = `https://cloud.iexapis.com/stable/stock/AAPL/chart/1d?token=${iexToken}`;

// 4. Polygon.io (å…è´¹tierå¯ç”¨)
const polygonKey = 'YOUR_KEY';
const url = `https://api.polygon.io/v2/aggs/ticker/AAPL/range/1/minute/2023-01-01/2023-01-02?apikey=${polygonKey}`;
                    </div>
                    <p><strong>æ¨è:</strong> Finnhubæä¾›è‰¯å¥½çš„å…è´¹æœåŠ¡å’ŒCORSæ”¯æŒ</p>
                    <p><strong>æ³¨æ„:</strong> å¤§å¤šæ•°ä¸“ä¸šAPIéœ€è¦æ³¨å†Œè·å–å¯†é’¥</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let selectedProxy = null;
        let chart = null;

        // ä»£ç†é…ç½®
        const proxyConfigs = {
            'cors-anywhere': {
                name: 'CORS Anywhere',
                url: 'https://cors-anywhere.herokuapp.com/',
                note: 'éœ€è¦å…ˆè®¿é—® https://cors-anywhere.herokuapp.com/corsdemo æ¿€æ´»'
            },
            'allorigins': {
                name: 'AllOrigins',
                url: 'https://api.allorigins.win/get?url=',
                parseResponse: (data) => JSON.parse(data.contents)
            },
            'corsproxy': {
                name: 'CORS Proxy',
                url: 'https://corsproxy.io/?',
                note: 'åœ¨URLå‰æ·»åŠ ä»£ç†å‰ç¼€'
            },
            'thingproxy': {
                name: 'ThingProxy',
                url: 'https://thingproxy.freeboard.io/fetch/',
                note: 'ç®€å•çš„ä»£ç†æœåŠ¡'
            }
        };

        function selectProxy(proxyType) {
            // ç§»é™¤æ‰€æœ‰activeç±»
            document.querySelectorAll('.proxy-option').forEach(option => {
                option.classList.remove('active');
            });
            
            // æ·»åŠ activeç±»åˆ°é€‰ä¸­çš„ä»£ç†
            event.target.closest('.proxy-option').classList.add('active');
            
            selectedProxy = proxyType;
            document.getElementById('testBtn').disabled = false;
            
            updateStatus('ready', `å·²é€‰æ‹© ${proxyConfigs[proxyType].name}`);
            
            if (proxyConfigs[proxyType].note) {
                showAlert('success', proxyConfigs[proxyType].note);
            }
        }

        async function testProxyConnection() {
            if (!selectedProxy) {
                showAlert('error', 'è¯·å…ˆé€‰æ‹©ä¸€ä¸ªä»£ç†æœåŠ¡å™¨');
                return;
            }

            const symbol = document.getElementById('symbolInput').value.trim().toUpperCase();
            if (!symbol) {
                showAlert('error', 'è¯·è¾“å…¥è‚¡ç¥¨ä»£ç ');
                return;
            }

            updateStatus('loading', 'æ­£åœ¨æµ‹è¯•è¿æ¥...');
            const startTime = Date.now();

            try {
                const data = await fetchWithSelectedProxy(symbol);
                const endTime = Date.now();
                const responseTime = endTime - startTime;

                if (data && data.chart && data.chart.result && data.chart.result[0]) {
                    const result = data.chart.result[0];
                    const meta = result.meta;
                    const quote = result.indicators.quote[0];
                    
                    updateStatus('connected', 'è¿æ¥æˆåŠŸ');
                    showAlert('success', `æˆåŠŸè·å– ${symbol} æ•°æ®ï¼Œå“åº”æ—¶é—´: ${responseTime}ms`);
                    
                    displayStockData(result, responseTime);
                } else {
                    throw new Error('æ•°æ®æ ¼å¼é”™è¯¯æˆ–æ— æ•°æ®');
                }
            } catch (error) {
                updateStatus('error', 'è¿æ¥å¤±è´¥');
                showAlert('error', `æµ‹è¯•å¤±è´¥: ${error.message}`);
                console.error('ä»£ç†æµ‹è¯•å¤±è´¥:', error);
            }
        }

        async function fetchWithSelectedProxy(symbol) {
            const config = proxyConfigs[selectedProxy];
            const period = document.getElementById('periodSelect').value;
            
            // è®¡ç®—æ—¶é—´èŒƒå›´
            const now = Math.floor(Date.now() / 1000);
            let period1, period2, interval;
            
            switch(period) {
                case '1d':
                    period1 = now - (24 * 60 * 60);
                    period2 = now;
                    interval = '5m';
                    break;
                case '5d':
                    period1 = now - (5 * 24 * 60 * 60);
                    period2 = now;
                    interval = '15m';
                    break;
                case '1mo':
                    period1 = now - (30 * 24 * 60 * 60);
                    period2 = now;
                    interval = '1h';
                    break;
            }

            const yahooUrl = `https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?period1=${period1}&period2=${period2}&interval=${interval}`;
            
            let requestUrl;
            
            switch(selectedProxy) {
                case 'cors-anywhere':
                    requestUrl = config.url + yahooUrl;
                    break;
                case 'allorigins':
                    requestUrl = config.url + encodeURIComponent(yahooUrl);
                    break;
                case 'corsproxy':
                    requestUrl = config.url + yahooUrl;
                    break;
                case 'thingproxy':
                    requestUrl = config.url + yahooUrl;
                    break;
                default:
                    throw new Error('æœªçŸ¥çš„ä»£ç†ç±»å‹');
            }

            const response = await fetch(requestUrl);
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }

            const data = await response.json();
            
            // æ ¹æ®ä»£ç†ç±»å‹è§£æå“åº”
            if (config.parseResponse) {
                return config.parseResponse(data);
            }
            
            return data;
        }

        function displayStockData(result, responseTime) {
            const meta = result.meta;
            const timestamps = result.timestamp;
            const quote = result.indicators.quote[0];
            
            if (!timestamps || !quote || !quote.close) {
                throw new Error('æ•°æ®ä¸å®Œæ•´');
            }

            const closes = quote.close.filter(price => price !== null);
            const volumes = quote.volume.filter(vol => vol !== null);
            const opens = quote.open.filter(price => price !== null);
            const highs = quote.high.filter(price => price !== null);
            const lows = quote.low.filter(price => price !== null);

            if (closes.length === 0) {
                throw new Error('æ— æœ‰æ•ˆä»·æ ¼æ•°æ®');
            }

            // æ›´æ–°æŒ‡æ ‡
            const currentPrice = closes[closes.length - 1];
            const previousPrice = closes.length > 1 ? closes[closes.length - 2] : currentPrice;
            const priceChange = ((currentPrice - previousPrice) / previousPrice * 100);
            const totalVolume = volumes.reduce((sum, vol) => sum + vol, 0);

            document.getElementById('currentPrice').textContent = `${currentPrice.toFixed(2)}`;
            document.getElementById('priceChange').textContent = `${priceChange >= 0 ? '+' : ''}${priceChange.toFixed(2)}%`;
            document.getElementById('priceChange').style.color = priceChange >= 0 ? '#27ae60' : '#e74c3c';
            document.getElementById('volume').textContent = `${(totalVolume / 1000000).toFixed(1)}M`;
            document.getElementById('responseTime').textContent = `${responseTime}ms`;

            document.getElementById('metricsGrid').style.display = 'grid';

            // åˆ›å»ºå›¾è¡¨
            createChart(timestamps, closes, meta.symbol);
        }

        function createChart(timestamps, prices, symbol) {
            const ctx = document.getElementById('priceChart').getContext('2d');
            
            if (chart) {
                chart.destroy();
            }

            const labels = timestamps.map(timestamp => {
                const date = new Date(timestamp * 1000);
                return date.toLocaleTimeString('zh-CN', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
            });

            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `${symbol} è‚¡ä»·`,
                        data: prices,
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top'
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff'
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        }
                    }
                }
            });

            document.getElementById('chartContainer').style.display = 'block';
        }

        function updateStatus(type, message) {
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            
            statusDot.className = `status-dot status-${type}`;
            statusText.textContent = message;
        }

        function showAlert(type, message) {
            // éšè—æ‰€æœ‰è­¦å‘Š
            document.getElementById('errorAlert').style.display = 'none';
            document.getElementById('successAlert').style.display = 'none';
            
            const alertElement = document.getElementById(`${type}Alert`);
            const messageElement = document.getElementById(`${type}Message`);
            
            messageElement.textContent = message;
            alertElement.style.display = 'block';
            
            setTimeout(() => {
                alertElement.style.display = 'none';
            }, 5000);
        }

        function switchToProxyMode() {
            document.querySelector('.demo-section').scrollIntoView({ 
                behavior: 'smooth' 
            });
            showAlert('success', 'è¯·é€‰æ‹©ä¸€ä¸ªä»£ç†æœåŠ¡å™¨å¼€å§‹æµ‹è¯•');
        }

        function showLocalSetup() {
            showTab('local-server');
            document.querySelector('.tab-container').scrollIntoView({ 
                behavior: 'smooth' 
            });
        }

        function showCloudSetup() {
            showTab('cloud-deploy');
            document.querySelector('.tab-container').scrollIntoView({ 
                behavior: 'smooth' 
            });
        }

        function showAlternativeAPIs() {
            showTab('alternative-apis');
            document.querySelector('.tab-container').scrollIntoView({ 
                behavior: 'smooth' 
            });
        }

        function showTab(tabId) {
            // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„activeç±»
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾å†…å®¹
            document.getElementById(tabId).classList.add('active');
            
            // æ¿€æ´»å¯¹åº”çš„æŒ‰é’®
            event.target.classList.add('active');
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            updateStatus('error', 'è¯·é€‰æ‹©ä»£ç†æœåŠ¡å™¨');
        });
    </script>

    <!-- é¢å¤–çš„è§£å†³æ–¹æ¡ˆä¿¡æ¯ -->
    <div style="margin-top: 40px; padding: 20px; background: rgba(255, 255, 255, 0.9); border-radius: 15px;">
        <h3 style="color: #2c3e50; margin-bottom: 15px;">ğŸ“‹ å¿«é€Ÿè§£å†³æ–¹æ¡ˆæ€»ç»“</h3>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
            <div style="padding: 15px; background: #e8f5e8; border-radius: 10px;">
                <h4 style="color: #27ae60;">ğŸŸ¢ ç«‹å³å¯ç”¨</h4>
                <p>ä½¿ç”¨CORSä»£ç†æœåŠ¡ï¼Œç‚¹å‡»ä¸Šæ–¹"ä½¿ç”¨ä»£ç†æ¨¡å¼"æŒ‰é’®</p>
            </div>
            
            <div style="padding: 15px; background: #fff3cd; border-radius: 10px;">
                <h4 style="color: #856404;">ğŸŸ¡ æ¨èæ–¹æ¡ˆ</h4>
                <p>éƒ¨ç½²è‡ªå·±çš„ä»£ç†æœåŠ¡å™¨ï¼Œè·å¾—æ›´å¥½çš„ç¨³å®šæ€§</p>
            </div>
            
            <div style="padding: 15px; background: #f8d7da; border-radius: 10px;">
                <h4 style="color: #721c24;">ğŸ”´ æ³¨æ„äº‹é¡¹</h4>
                <p>CORSé™åˆ¶æ˜¯æµè§ˆå™¨å®‰å…¨æœºåˆ¶ï¼Œéœ€è¦æœåŠ¡ç«¯é…åˆè§£å†³</p>
            </div>
            
            <div style="padding: 15px; background: #d1ecf1; border-radius: 10px;">
                <h4 style="color: #0c5460;">ğŸ’¡ æ›¿ä»£æ–¹æ¡ˆ</h4>
                <p>è€ƒè™‘ä½¿ç”¨åŸç”Ÿæ”¯æŒCORSçš„è‚¡ç¥¨APIæœåŠ¡</p>
            </div>
        </div>
        
        <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
            <h4 style="color: #495057;">ğŸ› ï¸ å¼€å‘è€…å»ºè®®</h4>
            <ul style="color: #6c757d; margin-left: 20px;">
                <li>ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨è‡ªå»ºä»£ç†æœåŠ¡å™¨</li>
                <li>å¯ä»¥è€ƒè™‘ä»˜è´¹APIè·å¾—æ›´å¥½çš„æ•°æ®è´¨é‡</li>
                <li>å®ç°ç¼“å­˜æœºåˆ¶å‡å°‘APIè°ƒç”¨é¢‘ç‡</li>
                <li>æ·»åŠ é”™è¯¯é‡è¯•å’Œé™çº§æœºåˆ¶</li>
            </ul>
        </div>
    </div>
</body>
</html>
