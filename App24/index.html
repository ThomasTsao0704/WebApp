<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yahoo Finance 股票分析系统 (CORS解决方案)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .cors-info {
            background: rgba(52, 152, 219, 0.1);
            border: 2px solid #3498db;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .cors-solutions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .solution-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .solution-card:hover {
            transform: translateY(-5px);
        }

        .solution-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .solution-description {
            color: #7f8c8d;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .solution-pros {
            background: #e8f5e8;
            color: #27ae60;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .solution-cons {
            background: #ffebee;
            color: #e74c3c;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
            text-decoration: none;
            text-align: center;
            color: white;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #229954);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }

        .btn-info {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .demo-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .proxy-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .proxy-option {
            padding: 15px;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .proxy-option:hover {
            border-color: #3498db;
            background: rgba(52, 152, 219, 0.1);
        }

        .proxy-option.active {
            border-color: #27ae60;
            background: rgba(39, 174, 96, 0.1);
        }

        .proxy-url {
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 0.9rem;
            margin-top: 8px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-connected { background: #27ae60; }
        .status-loading { background: #f39c12; }
        .status-error { background: #e74c3c; }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .control-item {
            display: flex;
            flex-direction: column;
        }

        .control-item label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }

        .control-item input,
        .control-item select {
            padding: 12px 15px;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .control-item input:focus,
        .control-item select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .metric-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .alert-error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
        }

        .alert-success {
            background: #e8f5e8;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
        }

        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            margin: 15px 0;
        }

        .tab-container {
            margin-bottom: 20px;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .tab-button {
            padding: 10px 20px;
            border: 2px solid #ecf0f1;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-button.active {
            border-color: #3498db;
            background: #3498db;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .cors-solutions {
                grid-template-columns: 1fr;
            }

            .proxy-selector {
                grid-template-columns: 1fr;
            }

            .controls {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 头部 -->
        <div class="header">
            <h1>🛠️ Yahoo Finance API - CORS解决方案</h1>
            <p>解决跨域限制，实现稳定的股票数据获取</p>
        </div>

        <!-- CORS问题说明 -->
        <div class="cors-info">
            <h3 style="color: #3498db; margin-bottom: 15px;">🚫 为什么会出现"Failed to fetch"错误？</h3>
            <p style="margin-bottom: 10px;"><strong>CORS (跨域资源共享) 限制:</strong> Yahoo Finance API不允许直接从浏览器端跨域访问，这是一种安全机制。</p>
            <p><strong>解决方案:</strong> 需要通过代理服务器或其他方式绕过CORS限制。</p>
        </div>

        <!-- 解决方案选项 -->
        <div class="cors-solutions">
            <div class="solution-card">
                <div class="solution-title">
                    🌐 方案1: 免费CORS代理
                </div>
                <div class="solution-description">
                    使用公共CORS代理服务，无需配置即可使用
                </div>
                <div class="solution-pros">
                    ✅ 完全免费<br>
                    ✅ 无需配置<br>
                    ✅ 立即可用
                </div>
                <div class="solution-cons">
                    ❌ 稳定性一般<br>
                    ❌ 可能有速度限制<br>
                    ❌ 依赖第三方服务
                </div>
                <button class="btn btn-primary" onclick="switchToProxyMode()">使用代理模式</button>
            </div>

            <div class="solution-card">
                <div class="solution-title">
                    🔧 方案2: 本地代理服务器
                </div>
                <div class="solution-description">
                    运行简单的Node.js代理服务器
                </div>
                <div class="solution-pros">
                    ✅ 完全控制<br>
                    ✅ 高稳定性<br>
                    ✅ 无速度限制
                </div>
                <div class="solution-cons">
                    ❌ 需要技术配置<br>
                    ❌ 需要运行服务器<br>
                    ❌ 适合开发者
                </div>
                <button class="btn btn-success" onclick="showLocalSetup()">查看配置</button>
            </div>

            <div class="solution-card">
                <div class="solution-title">
                    ☁️ 方案3: 云端部署
                </div>
                <div class="solution-description">
                    部署到Vercel、Netlify等云平台
                </div>
                <div class="solution-pros">
                    ✅ 专业稳定<br>
                    ✅ 自动扩展<br>
                    ✅ 全球CDN
                </div>
                <div class="solution-cons">
                    ❌ 需要部署配置<br>
                    ❌ 可能有费用<br>
                    ❌ 较复杂
                </div>
                <button class="btn btn-warning" onclick="showCloudSetup()">查看部署</button>
            </div>

            <div class="solution-card">
                <div class="solution-title">
                    🔄 方案4: 替代API
                </div>
                <div class="solution-description">
                    使用其他支持CORS的股票API
                </div>
                <div class="solution-pros">
                    ✅ 原生支持CORS<br>
                    ✅ 专业数据源<br>
                    ✅ 文档完善
                </div>
                <div class="solution-cons">
                    ❌ 可能需要API密钥<br>
                    ❌ 可能有费用<br>
                    ❌ 功能限制
                </div>
                <button class="btn btn-info" onclick="showAlternativeAPIs()">查看替代</button>
            </div>
        </div>

        <!-- 代理模式演示 -->
        <div class="demo-section">
            <h3 style="margin-bottom: 20px;">🌐 CORS代理模式演示</h3>
            
            <div class="status-indicator">
                <div class="status-dot status-error" id="statusDot"></div>
                <span id="statusText">选择代理服务器</span>
            </div>

            <div class="proxy-selector">
                <div class="proxy-option" onclick="selectProxy('cors-anywhere')">
                    <strong>CORS Anywhere</strong>
                    <div class="proxy-url">cors-anywhere.herokuapp.com</div>
                    <small>需要激活访问权限</small>
                </div>
                <div class="proxy-option" onclick="selectProxy('allorigins')">
                    <strong>AllOrigins</strong>
                    <div class="proxy-url">api.allorigins.win</div>
                    <small>稳定性较好</small>
                </div>
                <div class="proxy-option" onclick="selectProxy('corsproxy')">
                    <strong>CORS Proxy</strong>
                    <div class="proxy-url">corsproxy.io</div>
                    <small>速度较快</small>
                </div>
                <div class="proxy-option" onclick="selectProxy('thingproxy')">
                    <strong>ThingProxy</strong>
                    <div class="proxy-url">thingproxy.freeboard.io</div>
                    <small>简单易用</small>
                </div>
            </div>

            <div class="controls">
                <div class="control-item">
                    <label>股票代码</label>
                    <input type="text" id="symbolInput" placeholder="例如: AAPL, TSLA" value="AAPL">
                </div>
                <div class="control-item">
                    <label>时间范围</label>
                    <select id="periodSelect">
                        <option value="1d">1天</option>
                        <option value="5d">5天</option>
                        <option value="1mo">1个月</option>
                    </select>
                </div>
            </div>

            <button class="btn btn-primary" id="testBtn" onclick="testProxyConnection()" disabled>
                🔍 测试连接
            </button>

            <div class="alert alert-error" id="errorAlert">
                <strong>❌ 错误:</strong> <span id="errorMessage"></span>
            </div>
            <div class="alert alert-success" id="successAlert">
                <strong>✅ 成功:</strong> <span id="successMessage"></span>
            </div>

            <div class="metrics-grid" id="metricsGrid" style="display: none;">
                <div class="metric-card">
                    <div class="metric-value" id="currentPrice">--</div>
                    <div class="metric-label">当前价格</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="priceChange">--</div>
                    <div class="metric-label">涨跌幅</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="volume">--</div>
                    <div class="metric-label">成交量</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="responseTime">--</div>
                    <div class="metric-label">响应时间</div>
                </div>
            </div>

            <div class="chart-container" id="chartContainer" style="display: none;">
                <h4>价格走势图</h4>
                <div class="chart-wrapper">
                    <canvas id="priceChart"></canvas>
                </div>
            </div>
        </div>

        <!-- 技术方案详解 -->
        <div class="demo-section">
            <div class="tab-container">
                <div class="tab-buttons">
                    <button class="tab-button active" onclick="showTab('proxy-setup')">代理设置</button>
                    <button class="tab-button" onclick="showTab('local-server')">本地服务器</button>
                    <button class="tab-button" onclick="showTab('cloud-deploy')">云端部署</button>
                    <button class="tab-button" onclick="showTab('alternative-apis')">替代API</button>
                </div>

                <div class="tab-content active" id="proxy-setup">
                    <h4>🌐 使用CORS代理的完整代码</h4>
                    <div class="code-block">
// 使用AllOrigins代理的示例
async function fetchWithProxy(symbol) {
    const yahooUrl = `https://query1.finance.yahoo.com/v8/finance/chart/${symbol}`;
    const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(yahooUrl)}`;
    
    try {
        const response = await fetch(proxyUrl);
        const data = await response.json();
        const yahooData = JSON.parse(data.contents);
        return yahooData;
    } catch (error) {
        console.error('代理请求失败:', error);
        throw error;
    }
}

// 使用示例
fetchWithProxy('AAPL').then(data => {
    console.log('股票数据:', data);
});
                    </div>
                    <p><strong>优点:</strong> 无需额外配置，直接在前端使用</p>
                    <p><strong>缺点:</strong> 依赖第三方服务，可能不稳定</p>
                </div>

                <div class="tab-content" id="local-server">
                    <h4>🔧 Node.js本地代理服务器</h4>
                    <div class="code-block">
// proxy-server.js
const express = require('express');
const cors = require('cors');
const fetch = require('node-fetch');

const app = express();
app.use(cors());

app.get('/api/yahoo/:symbol', async (req, res) => {
    const { symbol } = req.params;
    const { period1, period2, interval } = req.query;
    
    const yahooUrl = `https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?period1=${period1}&period2=${period2}&interval=${interval}`;
    
    try {
        const response = await fetch(yahooUrl);
        const data = await response.json();
        res.json(data);
    } catch (error) {
        res.status(500).json({ error: error.message });
    }
});

app.listen(3001, () => {
    console.log('代理服务器运行在 http://localhost:3001');
});
                    </div>
                    <p><strong>安装:</strong> <code>npm install express cors node-fetch</code></p>
                    <p><strong>运行:</strong> <code>node proxy-server.js</code></p>
                    <p><strong>前端调用:</strong> <code>fetch('http://localhost:3001/api/yahoo/AAPL')</code></p>
                </div>

                <div class="tab-content" id="cloud-deploy">
                    <h4>☁️ Vercel云端部署</h4>
                    <div class="code-block">
// api/yahoo/[symbol].js (Vercel API Routes)
export default async function handler(req, res) {
    const { symbol } = req.query;
    const { period1, period2, interval } = req.query;
    
    // 启用CORS
    res.setHeader('Access-Control-Allow-Origin', '*');
    res.setHeader('Access-Control-Allow-Methods', 'GET');
    
    const yahooUrl = `https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?period1=${period1}&period2=${period2}&interval=${interval}`;
    
    try {
        const response = await fetch(yahooUrl);
        const data = await response.json();
        res.json(data);
    } catch (error) {
        res.status(500).json({ error: error.message });
    }
}
                    </div>
                    <p><strong>部署:</strong> 直接推送到GitHub，连接Vercel自动部署</p>
                    <p><strong>访问:</strong> <code>https://your-app.vercel.app/api/yahoo/AAPL</code></p>
                </div>

                <div class="tab-content" id="alternative-apis">
                    <h4>🔄 支持CORS的替代API</h4>
                    <div class="code-block">
// 1. Alpha Vantage (免费，需要API密钥)
const apiKey = 'YOUR_API_KEY';
const url = `https://www.alphavantage.co/query?function=TIME_SERIES_INTRADAY&symbol=AAPL&interval=5min&apikey=${apiKey}`;

// 2. Finnhub (免费tier，原生支持CORS)
const finnhubToken = 'YOUR_TOKEN';
const url = `https://finnhub.io/api/v1/quote?symbol=AAPL&token=${finnhubToken}`;

// 3. IEX Cloud (付费，专业数据)
const iexToken = 'YOUR_TOKEN';
const url = `https://cloud.iexapis.com/stable/stock/AAPL/chart/1d?token=${iexToken}`;

// 4. Polygon.io (免费tier可用)
const polygonKey = 'YOUR_KEY';
const url = `https://api.polygon.io/v2/aggs/ticker/AAPL/range/1/minute/2023-01-01/2023-01-02?apikey=${polygonKey}`;
                    </div>
                    <p><strong>推荐:</strong> Finnhub提供良好的免费服务和CORS支持</p>
                    <p><strong>注意:</strong> 大多数专业API需要注册获取密钥</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let selectedProxy = null;
        let chart = null;

        // 代理配置
        const proxyConfigs = {
            'cors-anywhere': {
                name: 'CORS Anywhere',
                url: 'https://cors-anywhere.herokuapp.com/',
                note: '需要先访问 https://cors-anywhere.herokuapp.com/corsdemo 激活'
            },
            'allorigins': {
                name: 'AllOrigins',
                url: 'https://api.allorigins.win/get?url=',
                parseResponse: (data) => JSON.parse(data.contents)
            },
            'corsproxy': {
                name: 'CORS Proxy',
                url: 'https://corsproxy.io/?',
                note: '在URL前添加代理前缀'
            },
            'thingproxy': {
                name: 'ThingProxy',
                url: 'https://thingproxy.freeboard.io/fetch/',
                note: '简单的代理服务'
            }
        };

        function selectProxy(proxyType) {
            // 移除所有active类
            document.querySelectorAll('.proxy-option').forEach(option => {
                option.classList.remove('active');
            });
            
            // 添加active类到选中的代理
            event.target.closest('.proxy-option').classList.add('active');
            
            selectedProxy = proxyType;
            document.getElementById('testBtn').disabled = false;
            
            updateStatus('ready', `已选择 ${proxyConfigs[proxyType].name}`);
            
            if (proxyConfigs[proxyType].note) {
                showAlert('success', proxyConfigs[proxyType].note);
            }
        }

        async function testProxyConnection() {
            if (!selectedProxy) {
                showAlert('error', '请先选择一个代理服务器');
                return;
            }

            const symbol = document.getElementById('symbolInput').value.trim().toUpperCase();
            if (!symbol) {
                showAlert('error', '请输入股票代码');
                return;
            }

            updateStatus('loading', '正在测试连接...');
            const startTime = Date.now();

            try {
                const data = await fetchWithSelectedProxy(symbol);
                const endTime = Date.now();
                const responseTime = endTime - startTime;

                if (data && data.chart && data.chart.result && data.chart.result[0]) {
                    const result = data.chart.result[0];
                    const meta = result.meta;
                    const quote = result.indicators.quote[0];
                    
                    updateStatus('connected', '连接成功');
                    showAlert('success', `成功获取 ${symbol} 数据，响应时间: ${responseTime}ms`);
                    
                    displayStockData(result, responseTime);
                } else {
                    throw new Error('数据格式错误或无数据');
                }
            } catch (error) {
                updateStatus('error', '连接失败');
                showAlert('error', `测试失败: ${error.message}`);
                console.error('代理测试失败:', error);
            }
        }

        async function fetchWithSelectedProxy(symbol) {
            const config = proxyConfigs[selectedProxy];
            const period = document.getElementById('periodSelect').value;
            
            // 计算时间范围
            const now = Math.floor(Date.now() / 1000);
            let period1, period2, interval;
            
            switch(period) {
                case '1d':
                    period1 = now - (24 * 60 * 60);
                    period2 = now;
                    interval = '5m';
                    break;
                case '5d':
                    period1 = now - (5 * 24 * 60 * 60);
                    period2 = now;
                    interval = '15m';
                    break;
                case '1mo':
                    period1 = now - (30 * 24 * 60 * 60);
                    period2 = now;
                    interval = '1h';
                    break;
            }

            const yahooUrl = `https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?period1=${period1}&period2=${period2}&interval=${interval}`;
            
            let requestUrl;
            
            switch(selectedProxy) {
                case 'cors-anywhere':
                    requestUrl = config.url + yahooUrl;
                    break;
                case 'allorigins':
                    requestUrl = config.url + encodeURIComponent(yahooUrl);
                    break;
                case 'corsproxy':
                    requestUrl = config.url + yahooUrl;
                    break;
                case 'thingproxy':
                    requestUrl = config.url + yahooUrl;
                    break;
                default:
                    throw new Error('未知的代理类型');
            }

            const response = await fetch(requestUrl);
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }

            const data = await response.json();
            
            // 根据代理类型解析响应
            if (config.parseResponse) {
                return config.parseResponse(data);
            }
            
            return data;
        }

        function displayStockData(result, responseTime) {
            const meta = result.meta;
            const timestamps = result.timestamp;
            const quote = result.indicators.quote[0];
            
            if (!timestamps || !quote || !quote.close) {
                throw new Error('数据不完整');
            }

            const closes = quote.close.filter(price => price !== null);
            const volumes = quote.volume.filter(vol => vol !== null);
            const opens = quote.open.filter(price => price !== null);
            const highs = quote.high.filter(price => price !== null);
            const lows = quote.low.filter(price => price !== null);

            if (closes.length === 0) {
                throw new Error('无有效价格数据');
            }

            // 更新指标
            const currentPrice = closes[closes.length - 1];
            const previousPrice = closes.length > 1 ? closes[closes.length - 2] : currentPrice;
            const priceChange = ((currentPrice - previousPrice) / previousPrice * 100);
            const totalVolume = volumes.reduce((sum, vol) => sum + vol, 0);

            document.getElementById('currentPrice').textContent = `${currentPrice.toFixed(2)}`;
            document.getElementById('priceChange').textContent = `${priceChange >= 0 ? '+' : ''}${priceChange.toFixed(2)}%`;
            document.getElementById('priceChange').style.color = priceChange >= 0 ? '#27ae60' : '#e74c3c';
            document.getElementById('volume').textContent = `${(totalVolume / 1000000).toFixed(1)}M`;
            document.getElementById('responseTime').textContent = `${responseTime}ms`;

            document.getElementById('metricsGrid').style.display = 'grid';

            // 创建图表
            createChart(timestamps, closes, meta.symbol);
        }

        function createChart(timestamps, prices, symbol) {
            const ctx = document.getElementById('priceChart').getContext('2d');
            
            if (chart) {
                chart.destroy();
            }

            const labels = timestamps.map(timestamp => {
                const date = new Date(timestamp * 1000);
                return date.toLocaleTimeString('zh-CN', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
            });

            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `${symbol} 股价`,
                        data: prices,
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top'
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff'
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        }
                    }
                }
            });

            document.getElementById('chartContainer').style.display = 'block';
        }

        function updateStatus(type, message) {
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            
            statusDot.className = `status-dot status-${type}`;
            statusText.textContent = message;
        }

        function showAlert(type, message) {
            // 隐藏所有警告
            document.getElementById('errorAlert').style.display = 'none';
            document.getElementById('successAlert').style.display = 'none';
            
            const alertElement = document.getElementById(`${type}Alert`);
            const messageElement = document.getElementById(`${type}Message`);
            
            messageElement.textContent = message;
            alertElement.style.display = 'block';
            
            setTimeout(() => {
                alertElement.style.display = 'none';
            }, 5000);
        }

        function switchToProxyMode() {
            document.querySelector('.demo-section').scrollIntoView({ 
                behavior: 'smooth' 
            });
            showAlert('success', '请选择一个代理服务器开始测试');
        }

        function showLocalSetup() {
            showTab('local-server');
            document.querySelector('.tab-container').scrollIntoView({ 
                behavior: 'smooth' 
            });
        }

        function showCloudSetup() {
            showTab('cloud-deploy');
            document.querySelector('.tab-container').scrollIntoView({ 
                behavior: 'smooth' 
            });
        }

        function showAlternativeAPIs() {
            showTab('alternative-apis');
            document.querySelector('.tab-container').scrollIntoView({ 
                behavior: 'smooth' 
            });
        }

        function showTab(tabId) {
            // 隐藏所有标签内容
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // 移除所有按钮的active类
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // 显示选中的标签内容
            document.getElementById(tabId).classList.add('active');
            
            // 激活对应的按钮
            event.target.classList.add('active');
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            updateStatus('error', '请选择代理服务器');
        });
    </script>

    <!-- 额外的解决方案信息 -->
    <div style="margin-top: 40px; padding: 20px; background: rgba(255, 255, 255, 0.9); border-radius: 15px;">
        <h3 style="color: #2c3e50; margin-bottom: 15px;">📋 快速解决方案总结</h3>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
            <div style="padding: 15px; background: #e8f5e8; border-radius: 10px;">
                <h4 style="color: #27ae60;">🟢 立即可用</h4>
                <p>使用CORS代理服务，点击上方"使用代理模式"按钮</p>
            </div>
            
            <div style="padding: 15px; background: #fff3cd; border-radius: 10px;">
                <h4 style="color: #856404;">🟡 推荐方案</h4>
                <p>部署自己的代理服务器，获得更好的稳定性</p>
            </div>
            
            <div style="padding: 15px; background: #f8d7da; border-radius: 10px;">
                <h4 style="color: #721c24;">🔴 注意事项</h4>
                <p>CORS限制是浏览器安全机制，需要服务端配合解决</p>
            </div>
            
            <div style="padding: 15px; background: #d1ecf1; border-radius: 10px;">
                <h4 style="color: #0c5460;">💡 替代方案</h4>
                <p>考虑使用原生支持CORS的股票API服务</p>
            </div>
        </div>
        
        <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
            <h4 style="color: #495057;">🛠️ 开发者建议</h4>
            <ul style="color: #6c757d; margin-left: 20px;">
                <li>生产环境建议使用自建代理服务器</li>
                <li>可以考虑付费API获得更好的数据质量</li>
                <li>实现缓存机制减少API调用频率</li>
                <li>添加错误重试和降级机制</li>
            </ul>
        </div>
    </div>
</body>
</html>
